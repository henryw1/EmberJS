/*!
 * froala_editor v2.3.2 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2016 Froala Labs
 */
! function(n) {
  "function" == typeof define && define.amd ? define(["jquery"], n) : "object" == typeof module && module.exports ? module.exports = function(t, i) {
    return void 0 === i && (i = "undefined" != typeof window ? require("jquery") : require("jquery")(t)), n(i), i
  } : n(jQuery)
}(function(n) {
  "use strict";
  var t = function(i, r) {
    var u, f;
    this.id = ++n.FE.ID;
    this.opts = n.extend(!0, {}, n.extend({}, t.DEFAULTS, "object" == typeof r && r));
    u = JSON.stringify(this.opts);
    n.FE.OPTS_MAPPING[u] = n.FE.OPTS_MAPPING[u] || this.id;
    this.sid = n.FE.OPTS_MAPPING[u];
    n.FE.SHARED[this.sid] = n.FE.SHARED[this.sid] || {};
    this.shared = n.FE.SHARED[this.sid];
    this.shared.count = (this.shared.count || 0) + 1;
    this.$oel = n(i);
    this.$oel.data("froala.editor", this);
    this.o_doc = i.ownerDocument;
    this.o_win = "defaultView" in this.o_doc ? this.o_doc.defaultView : this.o_doc.parentWindow;
    f = n(this.o_win).scrollTop();
    this.$oel.on("froala.doInit", n.proxy(function() {
      this.$oel.off("froala.doInit");
      this.doc = this.$el.get(0).ownerDocument;
      this.win = "defaultView" in this.doc ? this.doc.defaultView : this.doc.parentWindow;
      this.$doc = n(this.doc);
      this.$win = n(this.win);
      this.opts.pluginsEnabled || (this.opts.pluginsEnabled = Object.keys(n.FE.PLUGINS));
      this.opts.initOnClick ? (this.load(n.FE.MODULES), this.$el.on("touchstart.init", function() {
        n(this).data("touched", !0)
      }), this.$el.on("touchmove.init", function() {
        n(this).removeData("touched")
      }), this.$el.on("mousedown.init touchend.init dragenter.init focus.init", n.proxy(function(t) {
        if ("touchend" == t.type && !this.$el.data("touched")) return !0;
        if (1 === t.which || 0 === t.which) {
          this.$el.off("mousedown.init touchstart.init touchmove.init touchend.init dragenter.init focus.init");
          this.load(n.FE.MODULES);
          this.load(n.FE.PLUGINS);
          var i = t.originalEvent && t.originalEvent.originalTarget;
          i && "IMG" == i.tagName && n(i).trigger("mousedown");
          "undefined" == typeof this.ul && this.destroy();
          "touchend" == t.type && this.image && t.originalEvent && t.originalEvent.target && n(t.originalEvent.target).is("img") && setTimeout(n.proxy(function() {
            this.image.edit(n(t.originalEvent.target))
          }, this), 100);
          this.events.trigger("initialized")
        }
      }, this))) : (this.load(n.FE.MODULES), this.load(n.FE.PLUGINS), n(this.o_win).scrollTop(f), "undefined" == typeof this.ul && this.destroy(), this.events.trigger("initialized"))
    }, this));
    this._init()
  };
  t.DEFAULTS = {
    initOnClick: !1,
    pluginsEnabled: null
  };
  t.MODULES = {};
  t.PLUGINS = {};
  t.VERSION = "2.3.2";
  t.INSTANCES = [];
  t.OPTS_MAPPING = {};
  t.SHARED = {};
  t.ID = 0;
  t.prototype._init = function() {
    var t = this.$oel.prop("tagName"),
      i = n.proxy(function() {
        this._original_html = this._original_html || this.$oel.html();
        this.$box = this.$box || this.$oel;
        this.opts.fullPage && (this.opts.iframe = !0);
        this.opts.iframe ? (this.$iframe = n('<iframe src="about:blank" frameBorder="0">'), this.$wp = n("<div><\/div>"), this.$box.html(this.$wp), this.$wp.append(this.$iframe), this.$iframe.get(0).contentWindow.document.open(), this.$iframe.get(0).contentWindow.document.write("<!DOCTYPE html>"), this.$iframe.get(0).contentWindow.document.write("<html><head><\/head><body><\/body><\/html>"), this.$iframe.get(0).contentWindow.document.close(), this.$el = this.$iframe.contents().find("body"), this.$head = this.$iframe.contents().find("head"), this.$html = this.$iframe.contents().find("html"), this.iframe_document = this.$iframe.get(0).contentWindow.document, this.$oel.trigger("froala.doInit")) : (this.$el = n("<div><\/div>"), this.$wp = n("<div><\/div>").append(this.$el), this.$box.html(this.$wp), this.$oel.trigger("froala.doInit"))
      }, this),
      u = n.proxy(function() {
        this.$box = n("<div>");
        this.$oel.before(this.$box).hide();
        this._original_html = this.$oel.val();
        this.$oel.parents("form").on("submit." + this.id, n.proxy(function() {
          this.events.trigger("form.submit")
        }, this));
        this.$oel.parents("form").on("reset." + this.id, n.proxy(function() {
          this.events.trigger("form.reset")
        }, this));
        i()
      }, this),
      f = n.proxy(function() {
        this.$el = this.$oel;
        this.$el.attr("contenteditable", !0).css("outline", "none").css("display", "inline-block");
        this.opts.multiLine = !1;
        this.opts.toolbarInline = !1;
        this.$oel.trigger("froala.doInit")
      }, this),
      e = n.proxy(function() {
        this.$el = this.$oel;
        this.opts.toolbarInline = !1;
        this.$oel.trigger("froala.doInit")
      }, this),
      r = n.proxy(function() {
        this.$el = this.$oel;
        this.opts.toolbarInline = !1;
        this.$oel.on("click.popup", function(n) {
          n.preventDefault()
        });
        this.$oel.trigger("froala.doInit")
      }, this);
    this.opts.editInPopup ? r() : "TEXTAREA" == t ? u() : "A" == t ? f() : "IMG" == t ? e() : "BUTTON" == t || "INPUT" == t ? (this.opts.editInPopup = !0, this.opts.toolbarInline = !1, r()) : i()
  };
  t.prototype.load = function(t) {
    for (var i in t)
      if (t.hasOwnProperty(i)) {
        if (this[i]) continue;
        if (n.FE.PLUGINS[i] && this.opts.pluginsEnabled.indexOf(i) < 0) continue;
        if (this[i] = new t[i](this), this[i]._init && (this[i]._init(), this.opts.initOnClick && "core" == i)) return !1
      }
  };
  t.prototype.destroy = function() {
    var i, t;
    if (this.shared.count--, this.events.$off(), i = this.html.get(), this.events.trigger("destroy", [], !0), this.events.trigger("shared.destroy", void 0, !0), 0 === this.shared.count) {
      for (t in this.shared) this.shared.hasOwnProperty(t) && (null == this.shared[t], n.FE.SHARED[this.sid][t] = null);
      n.FE.SHARED[this.sid] = {}
    }
    this.$oel.parents("form").off("." + this.id);
    this.$oel.off("click.popup");
    this.$oel.removeData("froala.editor");
    this.core.destroy(i);
    n.FE.INSTANCES.splice(n.FE.INSTANCES.indexOf(this), 1)
  };
  n.fn.froalaEditor = function(i) {
    for (var r, f = [], u = 0; u < arguments.length; u++) f.push(arguments[u]);
    return "string" == typeof i ? (r = [], this.each(function() {
      var s = n(this),
        t = s.data("froala.editor"),
        u, e, o;
      if (t) {
        if (i.indexOf(".") > 0 && t[i.split(".")[0]] ? (t[i.split(".")[0]] && (u = t[i.split(".")[0]]), e = i.split(".")[1]) : (u = t, e = i.split(".")[0]), !u[e]) return n.error("Method " + i + " does not exist in Froala Editor.");
        o = u[e].apply(t, f.slice(1));
        void 0 === o ? r.push(this) : 0 === r.length && r.push(o)
      }
    }), 1 == r.length ? r[0] : r) : "object" != typeof i && i ? void 0 : this.each(function() {
      var u = n(this).data("froala.editor"),
        r;
      u || (r = this, new t(r, i))
    })
  };
  n.fn.froalaEditor.Constructor = t;
  n.FroalaEditor = t;
  n.FE = t;
  n.FE.MODULES.node = function(t) {
    function r(t) {
      return t && "IFRAME" != t.tagName ? n(t).contents() : []
    }

    function i(t) {
      return t ? t.nodeType != Node.ELEMENT_NODE ? !1 : n.FE.BLOCK_TAGS.indexOf(t.tagName.toLowerCase()) >= 0 : !1
    }

    function h(u, f) {
      var e, h, s, o;
      if (n(u).find("table").length > 0 || u.querySelectorAll(n.FE.VOID_ELEMENTS.join(",")).length - u.querySelectorAll("br").length || u.querySelectorAll(t.opts.htmlAllowedEmptyTags.join(":not(.fr-marker),") + ":not(.fr-marker)").length || u.querySelectorAll(n.FE.BLOCK_TAGS.join(",")).length > 1 || u.querySelectorAll(t.opts.htmlDoNotWrapTags.join(":not(.fr-marker),") + ":not(.fr-marker)").length) return !1;
      for (e = r(u), 1 == e.length && i(e[0]) && (e = r(e[0])), h = !1, s = 0; s < e.length; s++)
        if (o = e[s], !(f && n(o).hasClass("fr-marker") || o.nodeType == Node.TEXT_NODE && 0 == o.textContent.length)) {
          if ("BR" != o.tagName && (o.textContent || "").replace(/\u200B/gi, "").replace(/\n/g, "").length > 0 || h) return !1;
          "BR" == o.tagName && (h = !0)
        }
      return !0
    }

    function c(r) {
      for (; r && r.parentNode !== t.$el.get(0) && (!r.parentNode || !n(r.parentNode).hasClass("fr-inner"));)
        if (r = r.parentNode, i(r)) return r;
      return null
    }

    function l(r, u, f) {
      if ("undefined" == typeof u && (u = []), "undefined" == typeof f && (f = !0), u.push(t.$el.get(0)), u.indexOf(r.parentNode) >= 0 || r.parentNode && n(r.parentNode).hasClass("fr-inner") || r.parentNode && n.FE.SIMPLE_ENTER_TAGS.indexOf(r.parentNode.tagName) >= 0 && f) return null;
      for (; u.indexOf(r.parentNode) < 0 && r.parentNode && !n(r.parentNode).hasClass("fr-inner") && (n.FE.SIMPLE_ENTER_TAGS.indexOf(r.parentNode.tagName) < 0 || !f) && (!i(r) || !i(r.parentNode) || !f);) r = r.parentNode;
      return r
    }

    function u(n) {
      var u = {},
        i = n.attributes,
        t, r;
      if (i)
        for (t = 0; t < i.length; t++) r = i[t], u[r.nodeName] = r.value;
      return u
    }

    function f(n) {
      for (var t, i, f = "", e = u(n), o = Object.keys(e).sort(), r = 0; r < o.length; r++) t = o[r], i = e[t], f += i.indexOf('"') < 0 ? " " + t + '="' + i + '"' : " " + t + "='" + i + "'";
      return f
    }

    function a(n) {
      for (var r, i = n.attributes, t = 0; t < i.length; t++) r = i[t], n.removeAttribute(r.nodeName)
    }

    function v(n) {
      return "<" + n.tagName.toLowerCase() + f(n) + ">"
    }

    function y(n) {
      return "<\/" + n.tagName.toLowerCase() + ">"
    }

    function e(t, i) {
      "undefined" == typeof i && (i = !0);
      for (var r = t.previousSibling; r && i && n(r).hasClass("fr-marker");) r = r.previousSibling;
      return r ? r.nodeType == Node.TEXT_NODE && "" === r.textContent ? e(r) : !1 : !0
    }

    function o(t, i) {
      "undefined" == typeof i && (i = !0);
      for (var r = t.nextSibling; r && i && n(r).hasClass("fr-marker");) r = r.nextSibling;
      return r ? r.nodeType == Node.TEXT_NODE && "" === r.textContent ? o(r) : !1 : !0
    }

    function p(t) {
      return t && t.nodeType == Node.ELEMENT_NODE && n.FE.VOID_ELEMENTS.indexOf((t.tagName || "").toLowerCase()) >= 0
    }

    function w(n) {
      return n ? ["UL", "OL"].indexOf(n.tagName) >= 0 : !1
    }

    function s(n) {
      return n === t.$el.get(0)
    }

    function b(n) {
      return n && n.className && (n.className || "").indexOf("fr-deletable") >= 0
    }

    function k(n) {
      return n === t.doc.activeElement && (!t.doc.hasFocus || t.doc.hasFocus()) && !!(s(n) || n.type || n.href || ~n.tabIndex)
    }

    function d(n) {
      return (!n.getAttribute || "false" != n.getAttribute("contenteditable")) && ["STYLE", "SCRIPT"].indexOf(n.tagName) < 0
    }
    return {
      isBlock: i,
      isEmpty: h,
      blockParent: c,
      deepestParent: l,
      rawAttributes: u,
      attributes: f,
      clearAttributes: a,
      openTagString: v,
      closeTagString: y,
      isFirstSibling: e,
      isLastSibling: o,
      isList: w,
      isElement: s,
      contents: r,
      isVoid: p,
      hasFocus: k,
      isEditable: d,
      isDeletable: b
    }
  };
  n.extend(n.FE.DEFAULTS, {
    htmlAllowedTags: ["a", "abbr", "address", "area", "article", "aside", "audio", "b", "base", "bdi", "bdo", "blockquote", "br", "button", "canvas", "caption", "cite", "code", "col", "colgroup", "datalist", "dd", "del", "details", "dfn", "dialog", "div", "dl", "dt", "em", "embed", "fieldset", "figcaption", "figure", "footer", "form", "h1", "h2", "h3", "h4", "h5", "h6", "header", "hgroup", "hr", "i", "iframe", "img", "input", "ins", "kbd", "keygen", "label", "legend", "li", "link", "main", "map", "mark", "menu", "menuitem", "meter", "nav", "noscript", "object", "ol", "optgroup", "option", "output", "p", "param", "pre", "progress", "queue", "rp", "rt", "ruby", "s", "samp", "script", "style", "section", "select", "small", "source", "span", "strike", "strong", "sub", "summary", "sup", "table", "tbody", "td", "textarea", "tfoot", "th", "thead", "time", "tr", "track", "u", "ul", "var", "video", "wbr"],
    htmlRemoveTags: ["script", "style"],
    htmlAllowedAttrs: ["accept", "accept-charset", "accesskey", "action", "align", "allowfullscreen", "allowtransparency", "alt", "async", "autocomplete", "autofocus", "autoplay", "autosave", "background", "bgcolor", "border", "charset", "cellpadding", "cellspacing", "checked", "cite", "class", "color", "cols", "colspan", "content", "contenteditable", "contextmenu", "controls", "coords", "data", "data-.*", "datetime", "default", "defer", "dir", "dirname", "disabled", "download", "draggable", "dropzone", "enctype", "for", "form", "formaction", "frameborder", "headers", "height", "hidden", "high", "href", "hreflang", "http-equiv", "icon", "id", "ismap", "itemprop", "keytype", "kind", "label", "lang", "language", "list", "loop", "low", "max", "maxlength", "media", "method", "min", "mozallowfullscreen", "multiple", "name", "novalidate", "open", "optimum", "pattern", "ping", "placeholder", "poster", "preload", "pubdate", "radiogroup", "readonly", "rel", "required", "reversed", "rows", "rowspan", "sandbox", "scope", "scoped", "scrolling", "seamless", "selected", "shape", "size", "sizes", "span", "src", "srcdoc", "srclang", "srcset", "start", "step", "summary", "spellcheck", "style", "tabindex", "target", "title", "type", "translate", "usemap", "value", "valign", "webkitallowfullscreen", "width", "wrap"],
    htmlAllowComments: !0,
    fullPage: !1
  });
  n.FE.HTML5Map = {
    B: "STRONG",
    I: "EM",
    STRIKE: "S"
  };
  n.FE.MODULES.clean = function(t) {
    function f(n) {
      if (n.className && n.className.indexOf("fr-marker") >= 0) return !1;
      for (var r = t.node.contents(n), u = [], i = 0; i < r.length; i++) r[i].nodeType != Node.ELEMENT_NODE || t.node.isVoid(r[i]) ? r[i].nodeType == Node.TEXT_NODE && (r[i].textContent = r[i].textContent.replace(/\u200b/g, "")) : r[i].textContent.replace(/\u200b/g, "").length != r[i].textContent.length && f(r[i]);
      if (n.nodeType == Node.ELEMENT_NODE && !t.node.isVoid(n) && (n.normalize(), r = t.node.contents(n), u = n.querySelectorAll(".fr-marker"), r.length - u.length == 0)) {
        for (i = 0; i < r.length; i++)
          if ((r[i].className || "").indexOf("fr-marker") < 0) return !1;
        for (i = 0; i < u.length; i++) n.parentNode.insertBefore(u[i].cloneNode(!0), n);
        return n.parentNode.removeChild(n), !1
      }
    }

    function e(n) {
      var i, u, r;
      if (n.nodeType == Node.COMMENT_NODE) return "<!--" + n.nodeValue + "-->";
      if (n.nodeType == Node.TEXT_NODE) return n.textContent.replace(/\</g, "&lt;").replace(/\>/g, "&gt;").replace(/\u00A0/g, "&nbsp;");
      if (n.nodeType != Node.ELEMENT_NODE || n.nodeType == Node.ELEMENT_NODE && ["STYLE", "SCRIPT"].indexOf(n.tagName) >= 0 || "IFRAME" == n.tagName || (i = n.childNodes, 0 === i.length)) return n.outerHTML;
      for (u = "", r = 0; r < i.length; r++) u += e(i[r]);
      return t.node.openTagString(n) + u + t.node.closeTagString(n)
    }

    function a(n) {
      return i = [], n = n.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, function(n) {
        return i.push(n), "[FROALA.EDITOR.SCRIPT " + (i.length - 1) + "]"
      }), n = n.replace(/<img((?:[\w\W]*?)) src="/g, '<img$1 data-fr-src="')
    }

    function v(n) {
      return n = n.replace(/\[FROALA\.EDITOR\.SCRIPT ([\d]*)\]/gi, function(n, r) {
        return t.opts.htmlRemoveTags.indexOf("script") >= 0 ? "" : i[parseInt(r, 10)]
      }), n = n.replace(/<img((?:[\w\W]*?)) data-fr-src="/g, '<img$1 src="')
    }

    function r(n) {
      for (var t in n) n.hasOwnProperty(t) && (t.match(u) || delete n[t]);
      for (var r = "", f = Object.keys(n).sort(), i = 0; i < f.length; i++) t = f[i], r += n[t].indexOf('"') < 0 ? " " + t + '="' + n[t] + '"' : " " + t + "='" + n[t] + "'";
      return r
    }

    function y(n, i, u) {
      var f, e, o, s;
      return t.opts.fullPage ? (f = t.html.extractDoctype(u), e = r(t.html.extractNodeAttrs(u, "html")), i = null == i ? t.html.extractNode(u, "head") || "<title><\/title>" : i, o = r(t.html.extractNodeAttrs(u, "head")), s = r(t.html.extractNodeAttrs(u, "body")), f + "<html" + e + "><head" + o + ">" + i + "<\/head><body" + s + ">" + n + "<\/body><\/html>") : n
    }

    function o(i, r) {
      var o = n("<div>" + i + "<\/div>"),
        s = "",
        f, u;
      if (o) {
        for (f = t.node.contents(o.get(0)), u = 0; u < f.length; u++) r(f[u]);
        for (f = t.node.contents(o.get(0)), u = 0; u < f.length; u++) s += e(f[u])
      }
      return s
    }

    function s(n, i, r) {
      var u, f, e;
      return n = a(n), f = n, u = null, t.opts.fullPage && (f = t.html.extractNode(n, "body") || (n.indexOf("<body") >= 0 ? "" : n), r && (u = t.html.extractNode(n, "head") || "")), f = o(f, i), u && (u = o(u, i)), e = y(f, u, n), v(e)
    }

    function p(n) {
      return n.replace(/\u200b/g, "").length == n.length ? n : t.clean.exec(n, f)
    }

    function w() {
      var r = t.$el.get(0).querySelectorAll(Object.keys(n.FE.HTML5Map).join(",")),
        i;
      if (r.length) {
        for (t.selection.save(), i = 0; i < r.length; i++) "" === t.node.attributes(r[i]) && n(r[i]).replaceWith("<" + n.FE.HTML5Map[r[i].tagName] + ">" + r[i].innerHTML + "<\/" + n.FE.HTML5Map[r[i].tagName] + ">");
        t.selection.restore()
      }
    }

    function b(i) {
      var e, s, r, f, o;
      if ("SPAN" == i.tagName && (i.className || "").indexOf("fr-marker") >= 0) return !1;
      if ("PRE" == i.tagName && k(i), i.nodeType == Node.ELEMENT_NODE && (i.getAttribute("data-fr-src") && i.setAttribute("data-fr-src", t.helpers.sanitizeURL(i.getAttribute("data-fr-src"))), i.getAttribute("href") && i.setAttribute("href", t.helpers.sanitizeURL(i.getAttribute("href"))), ["TABLE", "TBODY", "TFOOT", "TR"].indexOf(i.tagName) >= 0 && (i.innerHTML = i.innerHTML.trim())), !t.opts.pasteAllowLocalImages && i.nodeType == Node.ELEMENT_NODE && "IMG" == i.tagName && i.getAttribute("data-fr-src") && 0 == i.getAttribute("data-fr-src").indexOf("file://")) return i.parentNode.removeChild(i), !1;
      if (i.nodeType == Node.ELEMENT_NODE && n.FE.HTML5Map[i.tagName] && "" === t.node.attributes(i) && (e = n.FE.HTML5Map[i.tagName], s = "<" + e + ">" + i.innerHTML + "<\/" + e + ">", i.insertAdjacentHTML("beforebegin", s), i = i.previousSibling, i.parentNode.removeChild(i.nextSibling)), t.opts.htmlAllowComments || i.nodeType != Node.COMMENT_NODE) {
        if (i.tagName && i.tagName.match(l)) i.parentNode.removeChild(i);
        else if (i.tagName && !i.tagName.match(c)) i.outerHTML = i.innerHTML;
        else if (r = i.attributes, r)
          for (f = r.length - 1; f >= 0; f--) o = r[f], o.nodeName.match(u) || i.removeAttribute(o.nodeName)
      } else 0 !== i.data.indexOf("[FROALA.EDITOR") && i.parentNode.removeChild(i)
    }

    function h(n) {
      for (var r = t.node.contents(n), i = 0; i < r.length; i++) r[i].nodeType != Node.TEXT_NODE && h(r[i]);
      b(n)
    }

    function k(n) {
      var t = n.innerHTML;
      t.indexOf("\n") >= 0 && (n.innerHTML = t.replace(/\n/g, "<br>"))
    }

    function d(i, r, f, e) {
      var o, v, a;
      for ("undefined" == typeof r && (r = []), "undefined" == typeof f && (f = []), "undefined" == typeof e && (e = !1), i = i.replace(/\u0009/g, ""), v = n.merge([], t.opts.htmlAllowedTags), o = 0; o < r.length; o++) v.indexOf(r[o]) >= 0 && v.splice(v.indexOf(r[o]), 1);
      for (a = n.merge([], t.opts.htmlAllowedAttrs), o = 0; o < f.length; o++) a.indexOf(f[o]) >= 0 && a.splice(a.indexOf(f[o]), 1);
      return a.push("data-fr-.*"), a.push("fr-.*"), c = new RegExp("^" + v.join("$|^") + "$", "gi"), u = new RegExp("^" + a.join("$|^") + "$", "gi"), l = new RegExp("^" + t.opts.htmlRemoveTags.join("$|^") + "$", "gi"), i = s(i, h, !0)
    }

    function g() {
      for (var i, u = t.$el.get(0).querySelectorAll("blockquote + blockquote"), r = 0; r < u.length; r++) i = u[r], t.node.attributes(i) == t.node.attributes(i.previousSibling) && (n(i).prev().append(n(i).html()), n(i).remove())
    }

    function nt() {
      for (var n, u, r = t.$el.get(0).querySelectorAll("tr"), i = 0; i < r.length; i++) {
        for (var f = r[i].children, o = !0, e = 0; e < f.length; e++)
          if ("TH" != f[e].tagName) {
            o = !1;
            break
          }
        if (0 != o && 0 != f.length) {
          for (n = r[i]; n && "TABLE" != n.tagName && "THEAD" != n.tagName;) n = n.parentNode;
          u = n;
          "THEAD" != u.tagName && (u = t.doc.createElement("THEAD"), n.insertBefore(u, n.firstChild));
          u.appendChild(r[i])
        }
      }
    }

    function tt() {
      for (var i, u = t.$el.get(0).querySelectorAll("table"), r = 0; r < u.length; r++) {
        for (i = u[r].previousSibling; i && i.nodeType == Node.TEXT_NODE && 0 == i.textContent.length;) i = i.previousSibling;
        !i || t.node.isBlock(i) || "BR" == i.tagName || i.nodeType != Node.TEXT_NODE && i.nodeType != Node.ELEMENT_NODE || n(i).is(t.opts.htmlDoNotWrapTags.join(",")) || u[r].parentNode.insertBefore(t.doc.createElement("br"), u[r])
      }
    }

    function it() {
      var u = t.html.defaultTag(),
        r, i;
      if (u)
        for (r = t.$el.get(0).querySelectorAll("td > " + u + ", th > " + u), i = 0; i < r.length; i++) "" === t.node.attributes(r[i]) && n(r[i]).replaceWith(r[i].innerHTML + "<br>")
    }

    function rt() {
      nt();
      tt();
      it()
    }

    function ut() {
      var i = [],
        o = function(n) {
          return !t.node.isList(n.parentNode)
        },
        n, f, e, u, r;
      do {
        if (i.length) {
          n = i[0];
          f = t.doc.createElement("ul");
          n.parentNode.insertBefore(f, n);
          do e = n, n = n.nextSibling, f.appendChild(e); while (n && "LI" == n.tagName)
        }
        for (i = [], u = t.$el.get(0).querySelectorAll("li"), r = 0; r < u.length; r++) o(u[r]) && i.push(u[r])
      } while (i.length > 0)
    }

    function ft() {
      for (var n, f, r, u = t.$el.get(0).querySelectorAll("ol + ol, ul + ul"), i = 0; i < u.length; i++)
        if (n = u[i], t.node.isList(n.previousSibling) && t.node.openTagString(n) == t.node.openTagString(n.previousSibling)) {
          for (f = t.node.contents(n), r = 0; r < f.length; r++) n.previousSibling.appendChild(f[r]);
          n.parentNode.removeChild(n)
        }
    }

    function et() {
      var r, f = function(n) {
          0 === n.querySelectorAll("LI").length && (r = !0, n.parentNode.removeChild(n))
        },
        i, u, n;
      do {
        for (r = !1, i = t.$el.get(0).querySelectorAll("li:empty"), n = 0; n < i.length; n++) i[n].parentNode.removeChild(i[n]);
        for (u = t.$el.get(0).querySelectorAll("ul, ol"), n = 0; n < u.length; n++) f(u[n])
      } while (r === !0)
    }

    function ot() {
      for (var r, u, f = t.$el.get(0).querySelectorAll("ul > ul, ol > ol, ul > ol, ol > ul"), i = 0; i < f.length; i++) r = f[i], u = r.previousSibling, u && ("LI" == u.tagName ? u.appendChild(r) : n(r).wrap("<li><\/li>"))
    }

    function st() {
      for (var u, i, e, o, f = t.$el.get(0).querySelectorAll("li > ul, li > ol"), r = 0; r < f.length; r++)
        if (u = f[r], u.nextSibling) {
          i = u.nextSibling;
          e = n("<li>");
          n(u.parentNode).after(e);
          do o = i, i = i.nextSibling, e.append(o); while (i)
        }
    }

    function ht() {
      for (var i, r, f = t.$el.get(0).querySelectorAll("li > ul, li > ol"), u = 0; u < f.length; u++)
        if (i = f[u], t.node.isFirstSibling(i)) n(i).before("<br/>");
        else if (i.previousSibling && "BR" == i.previousSibling.tagName) {
        for (r = i.previousSibling.previousSibling; r && n(r).hasClass("fr-marker");) r = r.previousSibling;
        r && "BR" != r.tagName && n(i.previousSibling).remove()
      }
    }

    function ct() {
      for (var r = t.$el.get(0).querySelectorAll("li:empty"), i = 0; i < r.length; i++) n(r[i]).remove()
    }

    function lt() {
      for (var e = t.$el.get(0).querySelectorAll("ul, ol"), u = 0; u < e.length; u++)
        for (var f = t.node.contents(e[u]), i = null, r = f.length - 1; r >= 0; r--) "LI" != f[r].tagName ? (i || (i = n("<li>"), i.insertBefore(f[r])), i.append(f[r])) : i = null
    }

    function at() {
      ut();
      ft();
      et();
      ot();
      st();
      ht();
      lt();
      ct()
    }

    function vt() {
      t.opts.fullPage && n.merge(t.opts.htmlAllowedTags, ["head", "title", "style", "link", "base", "body", "html"])
    }
    var c, l, u, i = [],
      i = [];
    return {
      _init: vt,
      html: d,
      toHTML5: w,
      tables: rt,
      lists: at,
      quotes: g,
      invisibleSpaces: p,
      exec: s
    }
  };
  n.FE.XS = 0;
  n.FE.SM = 1;
  n.FE.MD = 2;
  n.FE.LG = 3;
  n.FE.MODULES.helpers = function(t) {
    function c() {
      var n, t, i = -1;
      return "Microsoft Internet Explorer" == navigator.appName ? (n = navigator.userAgent, t = new RegExp("MSIE ([0-9]{1,}[\\.0-9]{0,})"), null !== t.exec(n) && (i = parseFloat(RegExp.$1))) : "Netscape" == navigator.appName && (n = navigator.userAgent, t = new RegExp("Trident/.*rv:([0-9]{1,}[\\.0-9]{0,})"), null !== t.exec(n) && (i = parseFloat(RegExp.$1))), i
    }

    function l() {
      var n = {},
        r = c();
      if (r > 0) n.msie = !0;
      else {
        var t = navigator.userAgent.toLowerCase(),
          i = /(edge)[ \/]([\w.]+)/.exec(t) || /(chrome)[ \/]([\w.]+)/.exec(t) || /(webkit)[ \/]([\w.]+)/.exec(t) || /(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t) || /(msie) ([\w.]+)/.exec(t) || t.indexOf("compatible") < 0 && /(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t) || [],
          u = {
            browser: i[1] || "",
            version: i[2] || "0"
          };
        i[1] && (n[u.browser] = !0);
        n.chrome ? n.webkit = !0 : n.webkit && (n.safari = !0)
      }
      return n.msie && (n.version = r), n
    }

    function e() {
      return /(iPad|iPhone|iPod)/g.test(navigator.userAgent) && !i()
    }

    function o() {
      return /(Android)/g.test(navigator.userAgent) && !i()
    }

    function s() {
      return /(Blackberry)/g.test(navigator.userAgent)
    }

    function i() {
      return /(Windows Phone)/gi.test(navigator.userAgent)
    }

    function a() {
      return o() || e() || s()
    }

    function v() {
      return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || function(n) {
        window.setTimeout(n, 1e3 / 60)
      }
    }

    function h(n) {
      return parseInt(n, 10) || 0
    }

    function y() {
      var t = n('<div class="fr-visibility-helper"><\/div>').appendTo("body"),
        i = h(t.css("margin-left"));
      return t.remove(), i
    }

    function p() {
      return "ontouchstart" in window || window.DocumentTouch && document instanceof DocumentTouch
    }

    function r(n) {
      if (!/^(https?:|ftps?:|)\/\//i.test(n)) return !1;
      n = String(n).replace(/</g, "%3C").replace(/>/g, "%3E").replace(/"/g, "%22").replace(/ /g, "%20");
      return /(http|ftp|https):\/\/[a-z\u00a1-\uffff0-9]+(\.[a-z\u00a1-\uffff0-9]*)*([a-z\u00a1-\uffff0-9.,@?^=%&amp;:\/~+#-]*[a-z\u00a1-\uffff0-9@?^=%&amp;\/~+#-])?/gi.test(n)
    }

    function w(n) {
      if (/^(https?:|ftps?:|)\/\//i.test(n)) {
        if (!r(n) && !r("http:" + n)) return ""
      } else n = encodeURIComponent(n).replace(/%23/g, "#").replace(/%2F/g, "/").replace(/%25/g, "%").replace(/mailto%3A/gi, "mailto:").replace(/file%3A/gi, "file:").replace(/sms%3A/gi, "sms:").replace(/tel%3A/gi, "tel:").replace(/notes%3A/gi, "notes:").replace(/data%3Aimage/gi, "data:image").replace(/webkit-fake-url%3A/gi, "webkit-fake-url:").replace(/%3F/g, "?").replace(/%3D/g, "=").replace(/%26/g, "&").replace(/&amp;/g, "&").replace(/%2C/g, ",").replace(/%3B/g, ";").replace(/%2B/g, "+").replace(/%40/g, "@").replace(/%5B/g, "[").replace(/%5D/g, "]").replace(/%7B/g, "{").replace(/%7D/g, "}");
      return n
    }

    function b(n) {
      return n && !n.propertyIsEnumerable("length") && "object" == typeof n && "number" == typeof n.length
    }

    function k(n) {
      function t(n) {
        return ("0" + parseInt(n, 10).toString(16)).slice(-2)
      }
      try {
        return n && "transparent" !== n ? /^#[0-9A-F]{6}$/i.test(n) ? n : (n = n.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/), ("#" + t(n[1]) + t(n[2]) + t(n[3])).toUpperCase()) : ""
      } catch (i) {
        return null
      }
    }

    function d(n) {
      var t;
      return n = n.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i, function(n, t, i, r) {
        return t + t + i + i + r + r
      }), t = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n), t ? "rgb(" + parseInt(t[1], 16) + ", " + parseInt(t[2], 16) + ", " + parseInt(t[3], 16) + ")" : ""
    }

    function g(t) {
      var r = (t.css("text-align") || "").replace(/-(.*)-/g, ""),
        i, f, e;
      return ["left", "right", "justify", "center"].indexOf(r) < 0 && (u || (i = n('<div dir="auto" style="text-align: initial; position: fixed; left: -3000px;"><span id="s1">.<\/span><span id="s2">.<\/span><\/div>'), n("body").append(i), f = i.find("#s1").get(0).getBoundingClientRect().left, e = i.find("#s2").get(0).getBoundingClientRect().left, i.remove(), u = e > f ? "left" : "right"), r = u), r
    }

    function nt() {
      return null == f && (f = navigator.platform.toUpperCase().indexOf("MAC") >= 0), f
    }

    function tt() {
      t.browser = l()
    }
    var u, f = null;
    return {
      _init: tt,
      isIOS: e,
      isMac: nt,
      isAndroid: o,
      isBlackberry: s,
      isWindowsPhone: i,
      isMobile: a,
      requestAnimationFrame: v,
      getPX: h,
      screenSize: y,
      isTouch: p,
      sanitizeURL: w,
      isArray: b,
      RGBToHex: k,
      HEXtoRGB: d,
      isURL: r,
      getAlignment: g
    }
  };
  n.FE.MODULES.events = function(t) {
    function r(n, t, i) {
      e(n, t, i)
    }

    function y() {
      r(t.$el, "cut copy paste beforepaste", function(n) {
        i(n.type, [n])
      })
    }

    function p() {
      r(t.$el, "click mouseup mousedown touchstart touchend dragenter dragover dragleave dragend drop dragstart", function(n) {
        i(n.type, [n])
      });
      u("mousedown", function() {
        for (var i = 0; i < n.FE.INSTANCES.length; i++) n.FE.INSTANCES[i] != t && n.FE.INSTANCES[i].popups && n.FE.INSTANCES[i].popups.areVisible() && n.FE.INSTANCES[i].$el.find(".fr-marker").remove()
      })
    }

    function w() {
      r(t.$el, "keydown keypress keyup input", function(n) {
        i(n.type, [n])
      })
    }

    function b() {
      r(t.$win, t._mousedown, function(n) {
        i("window.mousedown", [n]);
        o()
      });
      r(t.$win, t._mouseup, function(n) {
        i("window.mouseup", [n])
      });
      r(t.$win, "keydown keyup touchmove touchend", function(n) {
        i("window." + n.type, [n])
      })
    }

    function k() {
      r(t.$doc, "dragend drop", function(n) {
        i("document." + n.type, [n])
      })
    }

    function a(i) {
      var u, e, r, f;
      if ("undefined" == typeof i && (i = !0), !t.$wp) return !1;
      if (t.helpers.isIOS() && t.$win.get(0).focus(), !t.core.hasFocus() && i) return u = t.$win.scrollTop(), t.$el.focus(), u != t.$win.scrollTop() && t.$win.scrollTop(u), !1;
      if (!t.core.hasFocus() || t.$el.find(".fr-marker").length > 0) return !1;
      e = t.selection.info(t.$el.get(0));
      e.atStart && t.selection.isCollapsed() && null != t.html.defaultTag() && (r = t.markers.insert(), r && !t.node.blockParent(r) ? (n(r).remove(), f = t.$el.find(t.html.blockTagsQuery()).get(0), f && (n(f).prepend(n.FE.MARKERS), t.selection.restore())) : r && n(r).remove())
    }

    function d() {
      r(t.$el, "focus", function(n) {
        h() && (a(!1), s === !1 && i(n.type, [n]))
      });
      r(t.$el, "blur", function(n) {
        h() && s === !0 && i(n.type, [n])
      });
      u("focus", function() {
        s = !0
      });
      u("blur", function() {
        s = !1
      })
    }

    function g() {
      t.helpers.isMobile() ? (t._mousedown = "touchstart", t._mouseup = "touchend", t._move = "touchmove", t._mousemove = "touchmove") : (t._mousedown = "mousedown", t._mouseup = "mouseup", t._move = "", t._mousemove = "mousemove")
    }

    function nt(i) {
      var r = n(i.currentTarget);
      return t.edit.isDisabled() || r.hasClass("fr-disabled") ? (i.preventDefault(), !1) : "mousedown" === i.type && 1 !== i.which ? !0 : (t.helpers.isMobile() || i.preventDefault(), (t.helpers.isAndroid() || t.helpers.isWindowsPhone()) && 0 === r.parents(".fr-dropdown-menu").length && (i.preventDefault(), i.stopPropagation()), r.addClass("fr-selected"), void t.events.trigger("commands.mousedown", [r]))
    }

    function tt(i, r) {
      var u = n(i.currentTarget),
        f;
      if (t.edit.isDisabled() || u.hasClass("fr-disabled")) return i.preventDefault(), !1;
      if ("mouseup" === i.type && 1 !== i.which || !u.hasClass("fr-selected")) return !0;
      if ("touchmove" != i.type) {
        if (i.stopPropagation(), i.stopImmediatePropagation(), i.preventDefault(), !u.hasClass("fr-selected")) return n(".fr-selected").removeClass("fr-selected"), !1;
        if (n(".fr-selected").removeClass("fr-selected"), u.data("dragging") || u.attr("disabled")) return u.removeData("dragging"), !1;
        f = u.data("timeout");
        f && (clearTimeout(f), u.removeData("timeout"));
        r.apply(t, [i])
      } else u.data("timeout") || u.data("timeout", setTimeout(function() {
        u.data("dragging", !0)
      }, 100))
    }

    function o() {
      c = !0
    }

    function it() {
      c = !1
    }

    function h() {
      return c
    }

    function rt(n, i, r) {
      e(n, t._mousedown, i, function(n) {
        t.edit.isDisabled() || nt(n)
      }, !0);
      e(n, t._mouseup + " " + t._move, i, function(n) {
        t.edit.isDisabled() || tt(n, r)
      }, !0);
      e(n, "mousedown click mouseup", i, function(n) {
        t.edit.isDisabled() || n.stopPropagation()
      }, !0);
      u("window.mouseup", function() {
        t.edit.isDisabled() || (n.find(i).removeClass("fr-selected"), o())
      })
    }

    function u(n, i, r) {
      var o = n.split(" "),
        e, s;
      if (o.length > 1) {
        for (e = 0; e < o.length; e++) u(o[e], i, r);
        return !0
      }
      "undefined" == typeof r && (r = !1);
      s = 0 != n.indexOf("shared.") ? f[n] = f[n] || [] : t.shared._events[n] = t.shared._events[n] || [];
      r ? s.unshift(i) : s.push(i)
    }

    function e(n, i, r, u, f) {
      "function" == typeof r && (f = u, u = r, r = !1);
      var o = f ? t.shared.$_events : l,
        e = f ? t.sid : t.id;
      r ? n.on(i.split(" ").join(".ed" + e + " ") + ".ed" + e, r, u) : n.on(i.split(" ").join(".ed" + e + " ") + ".ed" + e, u);
      o.indexOf(n.get(0)) < 0 && o.push(n.get(0))
    }

    function v(t, i) {
      for (var r = 0; r < t.length; r++) n(t[r]).off(".ed" + i)
    }

    function ut() {
      v(l, t.id);
      l = [];
      0 == t.shared.count && (v(t.shared.$_events, t.sid), t.shared.$_events = null)
    }

    function i(i, r, u) {
      var e, o, s;
      if (!t.edit.isDisabled() || u) {
        if (0 != i.indexOf("shared.")) e = f[i];
        else {
          if (t.shared.count > 0) return !1;
          e = t.shared._events[i]
        }
        if (e)
          for (s = 0; s < e.length; s++)
            if (o = e[s].apply(t, r), o === !1) return !1;
        return o = t.$oel.triggerHandler("froalaEditor." + i, n.merge([t], r || [])), o === !1 ? !1 : o
      }
    }

    function ft(i, r, u) {
      var o, e, s;
      if (!t.edit.isDisabled() || u) {
        if (0 != i.indexOf("shared.")) o = f[i];
        else {
          if (t.shared.count > 0) return !1;
          o = t.shared._events[i]
        }
        if (o)
          for (s = 0; s < o.length; s++) e = o[s].apply(t, [r]), "undefined" != typeof e && (r = e);
        return e = t.$oel.triggerHandler("froalaEditor." + i, n.merge([t], [r])), "undefined" != typeof e && (r = e), r
      }
    }

    function et() {
      for (var n in f) f.hasOwnProperty(n) && delete f[n]
    }

    function ot() {
      for (var n in t.shared._events) t.shared._events.hasOwnProperty(n) && delete t.shared._events[n]
    }

    function st() {
      t.shared.$_events = t.shared.$_events || [];
      t.shared._events = {};
      g();
      p();
      b();
      k();
      w();
      d();
      o();
      y();
      u("destroy", et);
      u("shared.destroy", ot)
    }
    var c, f = {},
      s = !1,
      l = [];
    return {
      _init: st,
      on: u,
      trigger: i,
      bindClick: rt,
      disableBlur: it,
      enableBlur: o,
      blurActive: h,
      focus: a,
      chainTrigger: ft,
      $on: e,
      $off: ut
    }
  };
  n.FE.INVISIBLE_SPACE = "&#8203;";
  n.FE.START_MARKER = '<span class="fr-marker" data-id="0" data-type="true" style="display: none; line-height: 0;">' + n.FE.INVISIBLE_SPACE + "<\/span>";
  n.FE.END_MARKER = '<span class="fr-marker" data-id="0" data-type="false" style="display: none; line-height: 0;">' + n.FE.INVISIBLE_SPACE + "<\/span>";
  n.FE.MARKERS = n.FE.START_MARKER + n.FE.END_MARKER;
  n.FE.MODULES.markers = function(t) {
    function u(i, r) {
      return n('<span class="fr-marker" data-id="' + r + '" data-type="' + i + '" style="display: ' + (t.browser.safari ? "none" : "inline-block") + '; line-height: 0;">' + n.FE.INVISIBLE_SPACE + "<\/span>", t.doc)[0]
    }

    function f(i, r, f) {
      var c, o, e, s, h;
      try {
        if (c = i.cloneRange(), c.collapse(r), c.insertNode(u(r, f)), r === !0 && i.collapsed)
          for (o = t.$el.find('span.fr-marker[data-type="true"][data-id="' + f + '"]'), e = o.get(0).nextSibling; e && e.nodeType === Node.TEXT_NODE && 0 === e.textContent.length;) n(e).remove(), e = o.nextSibling;
        if (r === !0 && !i.collapsed && (o = t.$el.find('span.fr-marker[data-type="true"][data-id="' + f + '"]').get(0), e = o.nextSibling, e && e.nodeType === Node.ELEMENT_NODE && t.node.isBlock(e))) {
          s = [e];
          do e = s[0], s = t.node.contents(e); while (s[0] && t.node.isBlock(s[0]));
          n(e).prepend(n(o))
        }
        if (r === !1 && !i.collapsed) {
          if (o = t.$el.find('span.fr-marker[data-type="false"][data-id="' + f + '"]').get(0), e = o.previousSibling, e && e.nodeType === Node.ELEMENT_NODE && t.node.isBlock(e)) {
            s = [e];
            do e = s[s.length - 1], s = t.node.contents(e); while (s[s.length - 1] && t.node.isBlock(s[s.length - 1]));
            n(e).append(n(o))
          }
          o.parentNode && ["TD", "TH"].indexOf(o.parentNode.tagName) >= 0 && o.parentNode.previousSibling && !o.previousSibling && n(o.parentNode.previousSibling).append(o)
        }
        return h = t.$el.find('span.fr-marker[data-type="' + r + '"][data-id="' + f + '"]').get(0), h && (h.style.display = "none"), h
      } catch (l) {
        return null
      }
    }

    function i() {
      var u, f, e, o, r, i;
      if (!t.$wp) return null;
      try {
        if (u = t.selection.ranges(0), f = u.commonAncestorContainer, f != t.$el.get(0) && 0 == t.$el.find(f).length) return null;
        if (e = u.cloneRange(), o = u.cloneRange(), e.collapse(!0), r = n('<span class="fr-marker" style="display: none; line-height: 0;">' + n.FE.INVISIBLE_SPACE + "<\/span>", t.doc)[0], e.insertNode(r), r = t.$el.find("span.fr-marker").get(0)) {
          for (i = r.nextSibling; i && i.nodeType === Node.TEXT_NODE && 0 === i.textContent.length;) n(i).remove(), i = t.$el.find("span.fr-marker").get(0).nextSibling;
          return t.selection.clear(), t.selection.get().addRange(o), r
        }
        return null
      } catch (s) {}
    }

    function e() {
      var u, r, e;
      if (t.selection.isCollapsed() || t.selection.remove(), u = t.$el.find(".fr-marker").get(0), null == u && (u = i()), null == u) return null;
      if (r = t.node.deepestParent(u))
        if (t.node.isBlock(r) && t.node.isEmpty(r)) n(r).replaceWith('<span class="fr-marker"><\/span>');
        else {
          var f = u,
            s = "",
            o = "";
          do f = f.parentNode, s += t.node.closeTagString(f), o = t.node.openTagString(f) + o; while (f != r);
          n(u).replaceWith('<span id="fr-break"><\/span>');
          e = t.node.openTagString(r) + n(r).html() + t.node.closeTagString(r);
          e = e.replace(/<span id="fr-break"><\/span>/g, s + '<span class="fr-marker"><\/span>' + o);
          n(r).replaceWith(e)
        }
      return t.$el.find(".fr-marker").get(0)
    }

    function o(n) {
      var e = n.clientX,
        o = n.clientY,
        f, u, s, h;
      if (r(), u = null, "undefined" != typeof t.doc.caretPositionFromPoint ? (f = t.doc.caretPositionFromPoint(e, o), u = t.doc.createRange(), u.setStart(f.offsetNode, f.offset), u.setEnd(f.offsetNode, f.offset)) : "undefined" != typeof t.doc.caretRangeFromPoint && (f = t.doc.caretRangeFromPoint(e, o), u = t.doc.createRange(), u.setStart(f.startContainer, f.startOffset), u.setEnd(f.startContainer, f.startOffset)), null !== u && "undefined" != typeof t.win.getSelection) s = t.win.getSelection(), s.removeAllRanges(), s.addRange(u);
      else if ("undefined" != typeof t.doc.body.createTextRange) try {
        u = t.doc.body.createTextRange();
        u.moveToPoint(e, o);
        h = u.duplicate();
        h.moveToPoint(e, o);
        u.setEndPoint("EndToEnd", h);
        u.select()
      } catch (c) {
        return !1
      }
      i()
    }

    function r() {
      t.$el.find(".fr-marker").remove()
    }
    return {
      place: f,
      insert: i,
      split: e,
      insertAtPoint: o,
      remove: r
    }
  };
  n.FE.MODULES.selection = function(t) {
    function i() {
      var n = "";
      return t.win.getSelection ? n = t.win.getSelection() : t.doc.getSelection ? n = t.doc.getSelection() : t.doc.selection && (n = t.doc.selection.createRange().text), n.toString()
    }

    function r() {
      return t.win.getSelection ? t.win.getSelection() : t.doc.getSelection ? t.doc.getSelection() : t.doc.selection.createRange()
    }

    function u(n) {
      var i = r(),
        u = [],
        f;
      if (i && i.getRangeAt && i.rangeCount)
        for (u = [], f = 0; f < i.rangeCount; f++) u.push(i.getRangeAt(f));
      else u = t.doc.createRange ? [t.doc.createRange()] : [];
      return "undefined" != typeof n ? u[n] : u
    }

    function h() {
      var n = r();
      try {
        n.removeAllRanges ? n.removeAllRanges() : n.empty ? n.empty() : n.clear && n.clear()
      } catch (t) {}
    }

    function b() {
      var c = r(),
        s, f, h, e, o;
      try {
        if (c.rangeCount) {
          if (s = u(0), f = s.startContainer, f.nodeType == Node.ELEMENT_NODE) {
            if (h = !1, f.childNodes.length > 0 && f.childNodes[s.startOffset]) {
              for (e = f.childNodes[s.startOffset]; e && e.nodeType == Node.TEXT_NODE && 0 == e.textContent.length;) e = e.nextSibling;
              e && e.textContent.replace(/\u200B/g, "") === i().replace(/\u200B/g, "") && (f = e, h = !0)
            } else !s.collapsed && f.nextSibling && f.nextSibling.nodeType == Node.ELEMENT_NODE && (e = f.nextSibling, e && e.textContent.replace(/\u200B/g, "") === i().replace(/\u200B/g, "") && (f = e, h = !0));
            !h && f.childNodes.length > 0 && n(f.childNodes[0]).text().replace(/\u200B/g, "") === i().replace(/\u200B/g, "") && ["BR", "IMG", "HR"].indexOf(f.childNodes[0].tagName) < 0 && (f = f.childNodes[0])
          }
          for (; f.nodeType != Node.ELEMENT_NODE && f.parentNode;) f = f.parentNode;
          for (o = f; o && "HTML" != o.tagName;) {
            if (o == t.$el.get(0)) return f;
            o = n(o).parent()[0]
          }
        }
      } catch (l) {}
      return t.$el.get(0)
    }

    function k() {
      var c = r(),
        e, f, h, o, s;
      try {
        if (c.rangeCount) {
          for (e = u(0), f = e.endContainer, f.nodeType == Node.ELEMENT_NODE && (h = !1, f.childNodes.length > 0 && f.childNodes[e.endOffset] && n(f.childNodes[e.endOffset]).text() === i() ? (f = f.childNodes[e.endOffset], h = !0) : !e.collapsed && f.previousSibling && f.previousSibling.nodeType == Node.ELEMENT_NODE ? (o = f.previousSibling, o && o.textContent.replace(/\u200B/g, "") === i().replace(/\u200B/g, "") && (f = o, h = !0)) : !e.collapsed && f.childNodes.length > 0 && f.childNodes[e.endOffset] && (o = f.childNodes[e.endOffset].previousSibling, o.nodeType == Node.ELEMENT_NODE && o && o.textContent.replace(/\u200B/g, "") === i().replace(/\u200B/g, "") && (f = o, h = !0)), !h && f.childNodes.length > 0 && n(f.childNodes[f.childNodes.length - 1]).text() === i() && ["BR", "IMG", "HR"].indexOf(f.childNodes[f.childNodes.length - 1].tagName) < 0 && (f = f.childNodes[f.childNodes.length - 1])), f.nodeType == Node.TEXT_NODE && 0 == e.endOffset && f.previousSibling && f.previousSibling.nodeType == Node.ELEMENT_NODE && (f = f.previousSibling); f.nodeType != Node.ELEMENT_NODE && f.parentNode;) f = f.parentNode;
          for (s = f; s && "HTML" != s.tagName;) {
            if (s == t.$el.get(0)) return f;
            s = n(s).parent()[0]
          }
        }
      } catch (l) {}
      return t.$el.get(0)
    }

    function e(n, t) {
      var i = n;
      return i.nodeType == Node.ELEMENT_NODE && i.childNodes.length > 0 && i.childNodes[t] && (i = i.childNodes[t]), i.nodeType == Node.TEXT_NODE && (i = i.parentNode), i
    }

    function d() {
      var f = [],
        p = r(),
        v, a, i, s, o;
      if (y() && p.rangeCount)
        for (v = u(), o = 0; o < v.length; o++) {
          var h = v[o],
            l = e(h.startContainer, h.startOffset),
            c = e(h.endContainer, h.endOffset);
          for (t.node.isBlock(l) && f.indexOf(l) < 0 && f.push(l), s = t.node.blockParent(l), s && f.indexOf(s) < 0 && f.push(s), a = [], i = l; i !== c && i !== t.$el.get(0);) a.indexOf(i) < 0 && i.children && i.children.length ? (a.push(i), i = i.children[0]) : i.nextSibling ? i = i.nextSibling : i.parentNode && (i = i.parentNode, a.push(i)), t.node.isBlock(i) && a.indexOf(i) < 0 && f.indexOf(i) < 0 && (i !== c || h.endOffset > 0) && f.push(i);
          t.node.isBlock(c) && f.indexOf(c) < 0 && h.endOffset > 0 && f.push(c);
          s = t.node.blockParent(c);
          s && f.indexOf(s) < 0 && f.push(s)
        }
      for (o = f.length - 1; o > 0; o--) n(f[o]).find(f).length && "LI" != f[o].tagName && f.splice(o, 1);
      return f
    }

    function c() {
      var i, n;
      if (t.$wp) {
        t.markers.remove();
        for (var f = u(), r = [], n = 0; n < f.length; n++)
          if (f[n].startContainer !== t.doc) {
            var i = f[n],
              e = i.collapsed,
              o = t.markers.place(i, !0, n),
              s = t.markers.place(i, !1, n);
            t.browser.safari && !e && (i = t.doc.createRange(), i.setStartAfter(o), i.setEndBefore(s), r.push(i))
          }
        if (t.browser.safari && r.length)
          for (t.selection.clear(), n = 0; n < r.length; n++) t.selection.get().addRange(r[n])
      }
    }

    function l() {
      var p = t.$el.get(0).querySelectorAll('.fr-marker[data-type="true"]'),
        nt, l, c, b, v, y, u, a, g, k, d, w;
      if (!t.$wp) return t.markers.remove(), !1;
      if (0 === p.length) return !1;
      if (t.browser.msie || t.browser.edge)
        for (l = 0; l < p.length; l++) p[l].style.display = "inline-block";
      for (t.core.hasFocus() || t.browser.msie || t.browser.webkit || t.$el.focus(), h(), nt = r(), l = 0; l < p.length; l++) {
        var it = n(p[l]).data("id"),
          o = p[l],
          s = t.doc.createRange(),
          e = t.$el.find('.fr-marker[data-type="false"][data-id="' + it + '"]');
        if ((t.browser.msie || t.browser.edge) && e.css("display", "inline-block"), c = null, e.length > 0) {
          e = e[0];
          try {
            for (b = !1, v = o.nextSibling; v && v.nodeType == Node.TEXT_NODE && 0 == v.textContent.length;) a = v, v = v.nextSibling, n(a).remove();
            for (y = e.nextSibling; y && y.nodeType == Node.TEXT_NODE && 0 == y.textContent.length;) a = y, y = y.nextSibling, n(a).remove();
            if (o.nextSibling == e || e.nextSibling == o) {
              for (var tt = o.nextSibling == e ? o : e, rt = tt == o ? e : o, i = tt.previousSibling; i && i.nodeType == Node.TEXT_NODE && 0 == i.length;) a = i, i = i.previousSibling, n(a).remove();
              if (i && i.nodeType == Node.TEXT_NODE)
                for (; i && i.previousSibling && i.previousSibling.nodeType == Node.TEXT_NODE;) i.previousSibling.textContent = i.previousSibling.textContent + i.textContent, i = i.previousSibling, n(i.nextSibling).remove();
              for (u = rt.nextSibling; u && u.nodeType == Node.TEXT_NODE && 0 == u.length;) a = u, u = u.nextSibling, n(a).remove();
              if (u && u.nodeType == Node.TEXT_NODE)
                for (; u && u.nextSibling && u.nextSibling.nodeType == Node.TEXT_NODE;) u.nextSibling.textContent = u.textContent + u.nextSibling.textContent, u = u.nextSibling, n(u.previousSibling).remove();
              (i && (t.node.isVoid(i) || t.node.isBlock(i)) && (i = null), u && (t.node.isVoid(u) || t.node.isBlock(u)) && (u = null), i && u && i.nodeType == Node.TEXT_NODE && u.nodeType == Node.TEXT_NODE) ? (n(o).remove(), n(e).remove(), g = i.textContent.length, i.textContent = i.textContent + u.textContent, n(u).remove(), t.spaces.normalize(i), s.setStart(i, g), s.setEnd(i, g), b = !0) : !i && u && u.nodeType == Node.TEXT_NODE ? (n(o).remove(), n(e).remove(), t.spaces.normalize(u), c = n(t.doc.createTextNode("\u200b")), n(u).before(c), s.setStart(u, 0), s.setEnd(u, 0), b = !0) : !u && i && i.nodeType == Node.TEXT_NODE && (n(o).remove(), n(e).remove(), t.spaces.normalize(i), c = n(t.doc.createTextNode("\u200b")), n(i).after(c), s.setStart(i, i.textContent.length), s.setEnd(i, i.textContent.length), b = !0)
            }
            b || (t.browser.chrome && o.nextSibling == e ? (k = f(e, s, !0) || s.setStartAfter(e), d = f(o, s, !1) || s.setEndBefore(o)) : (o.previousSibling == e && (o = e, e = o.nextSibling), e.nextSibling && "BR" === e.nextSibling.tagName || !e.nextSibling && t.node.isBlock(o.previousSibling) || o.previousSibling && "BR" == o.previousSibling.tagName || (o.style.display = "inline", e.style.display = "inline", c = n(t.doc.createTextNode("\u200b"))), w = o.previousSibling, w && w.style && "block" == t.win.getComputedStyle(w).display && !t.opts.enter == n.FE.ENTER_BR ? (s.setEndAfter(w), s.setStartAfter(w)) : (k = f(o, s, !0) || n(o).before(c) && s.setStartBefore(o), d = f(e, s, !1) || n(e).after(c) && s.setEndAfter(e))), "function" == typeof k && k(), "function" == typeof d && d())
          } catch (ut) {}
        }
        c && c.remove();
        try {
          nt.addRange(s)
        } catch (ut) {}
      }
      t.markers.remove()
    }

    function f(i, r, u) {
      var f = i.previousSibling,
        e = i.nextSibling,
        o;
      return f && e && f.nodeType == Node.TEXT_NODE && e.nodeType == Node.TEXT_NODE ? (o = f.textContent.length, u ? (e.textContent = f.textContent + e.textContent, n(f).remove(), n(i).remove(), t.spaces.normalize(e), function() {
        r.setStart(e, o)
      }) : (f.textContent = f.textContent + e.textContent, n(e).remove(), n(i).remove(), t.spaces.normalize(f), function() {
        r.setEnd(f, o)
      })) : f && !e && f.nodeType == Node.TEXT_NODE ? (o = f.textContent.length, u ? (t.spaces.normalize(f), function() {
        r.setStart(f, o)
      }) : (t.spaces.normalize(f), function() {
        r.setEnd(f, o)
      })) : e && !f && e.nodeType == Node.TEXT_NODE ? u ? (t.spaces.normalize(e), function() {
        r.setStart(e, 0)
      }) : (t.spaces.normalize(e), function() {
        r.setEnd(e, 0)
      }) : !1
    }

    function g() {
      return !0
    }

    function o() {
      for (var t = u(), n = 0; n < t.length; n++)
        if (!t[n].collapsed) return !1;
      return !0
    }

    function a(n) {
      var r, i, u = !1,
        f = !1,
        e;
      return t.win.getSelection ? (e = t.win.getSelection(), e.rangeCount && (r = e.getRangeAt(0), i = r.cloneRange(), i.selectNodeContents(n), i.setEnd(r.startContainer, r.startOffset), u = "" === i.toString(), i.selectNodeContents(n), i.setStart(r.endContainer, r.endOffset), f = "" === i.toString())) : t.doc.selection && "Control" != t.doc.selection.type && (r = t.doc.selection.createRange(), i = r.duplicate(), i.moveToElementText(n), i.setEndPoint("EndToStart", r), u = "" === i.text, i.moveToElementText(n), i.setEndPoint("StartToEnd", r), f = "" === i.text), {
        atStart: u,
        atEnd: f
      }
    }

    function nt() {
      if (o()) return !1;
      t.$el.find("td").prepend('<span class="fr-mk">' + n.FE.INVISIBLE_SPACE + "<\/span>");
      t.$el.find("img").append('<span class="fr-mk">' + n.FE.INVISIBLE_SPACE + "<\/span>");
      var i = !1,
        r = a(t.$el.get(0));
      return r.atStart && r.atEnd && (i = !0), t.$el.find(".fr-mk").remove(), i
    }

    function v(i, r) {
      var f, e, u;
      for ("undefined" == typeof r && (r = !0), f = n(i).html(), f && f.replace(/\u200b/g, "").length != f.length && n(i).html(f.replace(/\u200b/g, "")), e = t.node.contents(i), u = 0; u < e.length; u++) e[u].nodeType != Node.ELEMENT_NODE ? n(e[u]).remove() : (v(e[u], 0 == u), 0 == u && (r = !1));
      i.nodeType == Node.TEXT_NODE ? n(i).replaceWith('<span data-first="true" data-text="true"><\/span>') : r && n(i).attr("data-first", !0)
    }

    function s(i, r) {
      var e = t.node.contents(i.get(0)),
        f, u;
      for (["TD", "TH"].indexOf(i.get(0).tagName) >= 0 && 1 == i.find(".fr-marker").length && n(e[0]).hasClass("fr-marker") && i.attr("data-del-cell", !0), f = 0; f < e.length; f++) u = e[f], n(u).hasClass("fr-marker") ? r = (r + 1) % 2 : r ? n(u).find(".fr-marker").length > 0 ? r = s(n(u), r) : ["TD", "TH"].indexOf(u.tagName) < 0 && !n(u).hasClass("fr-inner") ? !t.opts.keepFormatOnDelete || t.$el.find("[data-first]").length > 0 ? n(u).remove() : v(u) : n(u).hasClass("fr-inner") ? 0 == n(u).find(".fr-inner").length ? n(u).html("<br>") : n(u).find(".fr-inner").filter(function() {
        return 0 == n(this).find("fr-inner").length
      }).html("<br>") : (n(u).empty(), n(u).attr("data-del-cell", !0)) : n(u).find(".fr-marker").length > 0 && (r = s(n(u), r));
      return r
    }

    function y() {
      try {
        if (!t.$wp) return !1;
        for (var i = u(0), n = i.commonAncestorContainer; n && !t.node.isElement(n);) n = n.parentNode;
        return t.node.isElement(n) ? !0 : !1
      } catch (r) {
        return !1
      }
    }

    function tt() {
      var a, w, u, v, p, f, i, nt, b;
      if (o()) return !0;
      c();
      for (var tt = function(t) {
          for (var r, i = t.previousSibling; i && i.nodeType == Node.TEXT_NODE && 0 == i.textContent.length;) r = i, i = i.previousSibling, n(r).remove();
          return i
        }, it = function(t) {
          for (var r, i = t.nextSibling; i && i.nodeType == Node.TEXT_NODE && 0 == i.textContent.length;) r = i, i = i.nextSibling, n(r).remove();
          return i
        }, p = t.$el.find('.fr-marker[data-type="true"]'), f = 0; f < p.length; f++)
        for (a = p[f]; !tt(a) && !t.node.isBlock(a.parentNode) && !t.$el.is(a.parentNode);) n(a.parentNode).before(a);
      for (w = t.$el.find('.fr-marker[data-type="false"]'), f = 0; f < w.length; f++) {
        for (u = w[f]; !it(u) && !t.node.isBlock(u.parentNode) && !t.$el.is(u.parentNode);) n(u.parentNode).after(u);
        u.parentNode && t.node.isBlock(u.parentNode) && t.node.isEmpty(u.parentNode) && !t.$el.is(u.parentNode) && n(u.parentNode).after(u)
      }
      if (g())
        if (s(t.$el, 0), v = t.$el.find('[data-first="true"]'), v.length) t.$el.find(".fr-marker").remove(), v.append(n.FE.INVISIBLE_SPACE + n.FE.MARKERS).removeAttr("data-first"), v.attr("data-text") && v.replaceWith(v.html());
        else
          for (t.$el.find("table").filter(function() {
              return n(this).find("[data-del-cell]").length > 0 && n(this).find("[data-del-cell]").length == n(this).find("td, th").length
            }).remove(), t.$el.find("[data-del-cell]").removeAttr("data-del-cell"), p = t.$el.find('.fr-marker[data-type="true"]'), f = 0; f < p.length; f++) {
            var h = p[f],
              i = h.nextSibling,
              y = t.$el.find('.fr-marker[data-type="false"][data-id="' + n(h).data("id") + '"]').get(0);
            if (y) {
              if ((!i || i != y) && h) {
                var e = t.node.blockParent(h),
                  r = t.node.blockParent(y),
                  k = !1,
                  d = !1;
                if (e && ["UL", "OL"].indexOf(e.tagName) >= 0 && (e = null, k = !0), r && ["UL", "OL"].indexOf(r.tagName) >= 0 && (r = null, d = !0), n(h).after(y), e != r)
                  if (null != e || k)
                    if (null != r || d || 0 != n(e).parentsUntil(t.$el, "table").length) e && r && 0 == n(e).parentsUntil(t.$el, "table").length && 0 == n(r).parentsUntil(t.$el, "table").length && (n(e).append(n(r).html()), n(r).remove());
                    else {
                      for (i = e; !i.nextSibling && i.parentNode != t.$el.get(0);) i = i.parentNode;
                      for (i = i.nextSibling; i && "BR" != i.tagName;) nt = i.nextSibling, n(e).append(i), i = nt;
                      i && "BR" == i.tagName && n(i).remove()
                    }
                else b = t.node.deepestParent(h), b ? (n(b).after(n(r).html()), n(r).remove()) : 0 == n(r).parentsUntil(t.$el, "table").length && (n(h).next().after(n(r).html()), n(r).remove())
              }
            } else y = n(h).clone().attr("data-type", !1), n(h).after(y)
          }
        t.opts.keepFormatOnDelete || t.html.fillEmptyBlocks();
      t.html.cleanEmptyTags(!0);
      t.clean.lists();
      t.spaces.normalize();
      l()
    }

    function p(i) {
      if (n(i).find(".fr-marker").length > 0) return !1;
      for (var r = t.node.contents(i); r.length && t.node.isBlock(r[0]);) i = r[0], r = t.node.contents(i);
      n(i).prepend(n.FE.MARKERS)
    }

    function w(i) {
      if (n(i).find(".fr-marker").length > 0) return !1;
      for (var r = t.node.contents(i); r.length && t.node.isBlock(r[r.length - 1]);) i = r[r.length - 1], r = t.node.contents(i);
      n(i).append(n.FE.MARKERS)
    }

    function it(i) {
      for (var r = i.previousSibling; r && r.nodeType == Node.TEXT_NODE && 0 == r.textContent.length;) r = r.previousSibling;
      return r ? (t.node.isBlock(r) ? w(r) : "BR" == r.tagName ? n(r).before(n.FE.MARKERS) : n(r).after(n.FE.MARKERS), !0) : !1
    }

    function rt(i) {
      for (var r = i.nextSibling; r && r.nodeType == Node.TEXT_NODE && 0 == r.textContent.length;) r = r.nextSibling;
      return r ? (t.node.isBlock(r) ? p(r) : n(r).before(n.FE.MARKERS), !0) : !1
    }
    return {
      text: i,
      get: r,
      ranges: u,
      clear: h,
      element: b,
      endElement: k,
      save: c,
      restore: l,
      isCollapsed: o,
      isFull: nt,
      inEditor: y,
      remove: tt,
      blocks: d,
      info: a,
      setAtEnd: w,
      setAtStart: p,
      setBefore: it,
      setAfter: rt,
      rangeElement: e
    }
  };
  n.FE.MODULES.spaces = function(t) {
    function i(n) {
      var t = n.nextSibling || n.parentNode;
      return n.parentNode.removeChild(n), t
    }

    function r(n, t) {
      return n && n.parentNode === t || "PRE" === t.nodeName ? t.nextSibling || t.parentNode : t.firstChild || t.nextSibling || t.parentNode
    }

    function f(n) {
      var e, s;
      if (n.firstChild && "PRE" !== n.nodeName && !(["STYLE", "SCRIPT"].indexOf(n.tagName) >= 0)) {
        for (var f = null, o = null, u = r(o, n); u !== n && "PRE" !== u.nodeName && ["STYLE", "SCRIPT"].indexOf(u.tagName) < 0;) {
          if (u.nodeType === Node.TEXT_NODE) {
            if (e = u.data.replace(/[ \r\n\t]+/g, " "), f && !/ $/.test(f.data) || " " !== e[0] || (e = e.substr(1)), !e || 0 == e.length) {
              u = i(u);
              continue
            }
            u.data = e;
            f = u
          } else u.nodeType === Node.ELEMENT_NODE && (t.node.isBlock(u) || t.node.isVoid(u) ? (f && f.data && (f.data = f.data.replace(/ $/, "")), f = null) : 0 == u.textContent.length && (f = u));
          s = r(o, u);
          o = u;
          u = s
        }
        f && f.data && (f.data = f.data.replace(/ $/, ""), f.data || i(f))
      }
    }

    function u(i, r) {
      var c, s, h, e, o;
      if ("undefined" != typeof i && i || (i = t.$el.get(0)), "undefined" == typeof r && (r = !1), r && f(i), !i.getAttribute || "false" != i.getAttribute("contenteditable"))
        if (i.nodeType == Node.ELEMENT_NODE && ["STYLE", "SCRIPT", "HEAD"].indexOf(i.tagName) < 0)
          for (c = t.node.contents(i), s = c.length - 1; s >= 0; s--)(c[s].tagName != Node.ELEMENT_NODE || (c[s].className || "").indexOf("fr-marker") < 0) && u(c[s]);
        else if (i.nodeType == Node.TEXT_NODE && i.textContent.length > 0) {
        for (h = (i.previousSibling, i.nextSibling, i.textContent), h = h.replace(new RegExp(n.FE.UNICODE_NBSP, "g"), " "), e = "", o = 0; o < h.length; o++) e += 32 != h.charCodeAt(o) || 0 !== o && 32 != e.charCodeAt(o - 1) ? h[o] : n.FE.UNICODE_NBSP;
        (!i.nextSibling || t.node.isBlock(i.nextSibling) || i.nextSibling.nodeType == Node.ELEMENT_NODE && t.win.getComputedStyle(i.nextSibling) && "block" == t.win.getComputedStyle(i.nextSibling).display) && (e = e.replace(/ $/, n.FE.UNICODE_NBSP));
        !i.previousSibling || t.node.isVoid(i.previousSibling) || t.node.isBlock(i.previousSibling) || (e = e.replace(/^\u00A0([^ $])/, " $1"));
        e = e.replace(/([^ \u00A0])\u00A0([^ \u00A0])/g, "$1 $2");
        i.textContent != e && (i.textContent = e)
      }
    }
    return {
      normalize: u
    }
  };
  n.FE.UNICODE_NBSP = String.fromCharCode(160);
  n.FE.VOID_ELEMENTS = ["area", "base", "br", "col", "embed", "hr", "img", "input", "keygen", "link", "menuitem", "meta", "param", "source", "track", "wbr"];
  n.FE.BLOCK_TAGS = ["address", "article", "aside", "audio", "blockquote", "canvas", "dd", "div", "dl", "dt", "fieldset", "figcaption", "figure", "footer", "form", "h1", "h2", "h3", "h4", "h5", "h6", "header", "hgroup", "hr", "li", "main", "nav", "noscript", "ol", "output", "p", "pre", "section", "table", "tbody", "td", "tfoot", "th", "thead", "tr", "ul", "video"];
  n.extend(n.FE.DEFAULTS, {
    htmlAllowedEmptyTags: ["textarea", "a", "iframe", "object", "video", "style", "script", ".fa", ".fr-emoticon"],
    htmlDoNotWrapTags: ["script", "style"],
    htmlSimpleAmpersand: !1
  });
  n.FE.MODULES.html = function(t) {
    function i() {
      return t.opts.enter == n.FE.ENTER_P ? "p" : t.opts.enter == n.FE.ENTER_DIV ? "div" : t.opts.enter == n.FE.ENTER_BR ? null : void 0
    }

    function l() {
      for (var o = [], u = t.$el.get(0).querySelectorAll(r()), i = 0; i < u.length; i++)
        if (!(u[i].querySelectorAll(n.FE.VOID_ELEMENTS.join(",")).length > 0 || u[i].querySelectorAll(t.opts.htmlAllowedEmptyTags.join(":not(.fr-marker),") + ":not(.fr-marker)").length > 0 || u[i].querySelectorAll(r()).length > 0)) {
          for (var e = t.node.contents(u[i]), s = !1, f = 0; f < e.length; f++)
            if (e[f].nodeType != Node.COMMENT_NODE && e[f].textContent && e[f].textContent.replace(/\u200B/g, "").replace(/\n/g, "").length > 0) {
              s = !0;
              break
            }
          s || o.push(u[i])
        }
      return o
    }

    function d() {
      return n.FE.BLOCK_TAGS.join(":empty, ") + ":empty"
    }

    function r() {
      return n.FE.BLOCK_TAGS.join(", ")
    }

    function a(i) {
      var u = n.merge([], n.FE.VOID_ELEMENTS),
        r, e, f;
      u = n.merge(u, t.opts.htmlAllowedEmptyTags);
      "undefined" == typeof i && (u = n.merge(u, n.FE.BLOCK_TAGS));
      do {
        for (e = !1, r = t.$el.get(0).querySelectorAll("*:empty:not(" + u.join("):not(") + "):not(.fr-marker)"), f = 0; f < r.length; f++)(0 === r[f].attributes.length || "undefined" != typeof r[f].getAttribute("href")) && (n(r[f]).remove(), e = !0);
        r = t.$el.get(0).querySelectorAll("*:empty:not(" + u.join("):not(") + "):not(.fr-marker)")
      } while (r.length && e)
    }

    function u(r, u) {
      var o = i(),
        f;
      if (u && (o = 'div class="fr-temp-div"'), o)
        for (var l = t.node.contents(r.get(0)), e = null, c = 0; c < l.length; c++)
          if (f = l[c], f.nodeType == Node.ELEMENT_NODE && (t.node.isBlock(f) || n(f).is(t.opts.htmlDoNotWrapTags.join(",")) && !n(f).hasClass("fr-marker"))) e = null;
          else if (f.nodeType != Node.ELEMENT_NODE && f.nodeType != Node.TEXT_NODE) e = null;
      else if (f.nodeType == Node.ELEMENT_NODE && "BR" == f.tagName)
        if (null == e) u ? n(f).replaceWith("<" + o + ' data-empty="true"><br><\/div>') : n(f).replaceWith("<" + o + "><br><\/" + o + ">");
        else {
          n(f).remove();
          for (var h = t.node.contents(e), a = !1, s = 0; s < h.length; s++)
            if (!n(h[s]).hasClass("fr-marker") && (h[s].nodeType != Node.TEXT_NODE || 0 !== h[s].textContent.replace(/ /g, "").length)) {
              a = !0;
              break
            }
          a === !1 && (e.append("<br>"), e.data("empty", !0));
          e = null
        }
      else f.nodeType == Node.TEXT_NODE && 0 == n(f).text().trim().length ? n(f).remove() : (null == e && (e = n("<" + o + ">"), n(f).before(e)), f.nodeType == Node.TEXT_NODE && n(f).text().trim().length > 0 ? (e.append(n(f).clone()), n(f).remove()) : e.append(n(f)))
    }

    function v(i, r, f, e) {
      return t.$wp ? ("undefined" == typeof i && (i = !1), "undefined" == typeof r && (r = !1), "undefined" == typeof f && (f = !1), "undefined" == typeof e && (e = !1), u(t.$el, i), e && t.$el.find(".fr-inner").each(function() {
        u(n(this), i)
      }), r && t.$el.find("td, th").each(function() {
        u(n(this), i)
      }), void(f && t.$el.find("blockquote").each(function() {
        u(n(this), i)
      }))) : !1
    }

    function g() {
      t.$el.find("div.fr-temp-div").each(function() {
        n(this).data("empty") || "LI" == this.parentNode.tagName ? n(this).replaceWith(n(this).html()) : n(this).replaceWith(n(this).html() + "<br>")
      });
      t.$el.find(".fr-temp-div").removeClass("fr-temp-div").filter(function() {
        return "" == n(this).attr("class")
      }).removeAttr("class")
    }

    function nt() {
      for (var i, u, f = l(), r = 0; r < f.length; r++) i = f[r], "false" == i.getAttribute("contenteditable") || 0 != i.querySelectorAll(t.opts.htmlAllowedEmptyTags.join(":not(.fr-marker),") + ":not(.fr-marker)").length || t.node.isVoid(i) || "TABLE" != i.tagName && i.appendChild(t.doc.createElement("br"));
      t.browser.msie && t.opts.enter == n.FE.ENTER_BR && (u = t.node.contents(t.$el.get(0)), u.length && u[u.length - 1].nodeType == Node.TEXT_NODE && t.$el.append("<br>"))
    }

    function tt() {
      return t.$el.find(r())
    }

    function e(n) {
      if ("undefined" == typeof n && (n = t.$el.get(0)), n && ["SCRIPT", "STYLE", "PRE"].indexOf(n.tagName) >= 0) return !1;
      for (var r = t.node.contents(n), i = r.length - 1; i >= 0; i--) r[i].nodeType == Node.TEXT_NODE ? (r[i].textContent = r[i].textContent.replace(/(?!^)( ){2,}(?!$)/g, " "), r[i].textContent = r[i].textContent.replace(/\n/g, " "), r[i].textContent = r[i].textContent.replace(/^[ ]{2,}/g, " "), r[i].textContent = r[i].textContent.replace(/[ ]{2,}$/g, " "), (t.node.isBlock(n) || t.node.isElement(n)) && (r[i].previousSibling || (r[i].textContent = r[i].textContent.replace(/^ */, "")), r[i].nextSibling || (r[i].textContent = r[i].textContent.replace(/ *$/, "")), r[i].previousSibling && r[i].nextSibling && " " == r[i].textContent && (r[i].textContent = r[i].previousSibling && r[i].nextSibling && t.node.isBlock(r[i].previousSibling) && t.node.isBlock(r[i].nextSibling) ? "" : "\n"))) : e(r[i])
    }

    function y(n) {
      return n && (t.node.isBlock(n) || ["STYLE", "SCRIPT", "HEAD", "BR", "HR"].indexOf(n.tagName) >= 0 || n.nodeType == Node.COMMENT_NODE)
    }

    function p(i) {
      var o, e, s, h, c, f, r, u;
      if ("undefined" == typeof i && (i = t.$el.get(0)), i.nodeType == Node.ELEMENT_NODE && ["STYLE", "SCRIPT", "HEAD"].indexOf(i.tagName) < 0) {
        for (o = t.node.contents(i), e = o.length - 1; e >= 0; e--)
          if (!n(o[e]).hasClass("fr-marker") && (s = p(o[e]), 1 == s)) return !0
      } else if (i.nodeType == Node.TEXT_NODE && i.textContent.length > 0) {
        if (h = i.previousSibling, c = i.nextSibling, y(h) && y(c) && 0 === i.textContent.trim().length) return !0;
        for (f = i.textContent, f = f.replace(new RegExp(n.FE.UNICODE_NBSP, "g"), " "), r = "", u = 0; u < f.length; u++) r += 32 != f.charCodeAt(u) || 0 !== u && 32 != r.charCodeAt(u - 1) ? f[u] : n.FE.UNICODE_NBSP;
        if (i.nextSibling || (r = r.replace(/ $/, n.FE.UNICODE_NBSP)), i.previousSibling && !t.node.isVoid(i.previousSibling) && (r = r.replace(/^\u00A0([^ $])/, " $1")), r = r.replace(/([^ \u00A0])\u00A0([^ \u00A0])/g, "$1 $2"), i.textContent != r) return !0
      }
      return !1
    }

    function o(n, t, i) {
      var u = new RegExp(t, "gi"),
        r = u.exec(n);
      return r ? r[i] : null
    }

    function it(n, t) {
      var i = n.match(/<!DOCTYPE ?([^ ]*) ?([^ ]*) ?"?([^"]*)"? ?"?([^"]*)"?>/i);
      return i ? t.implementation.createDocumentType(i[1], i[3], i[4]) : t.implementation.createDocumentType("html")
    }

    function s(n) {
      var t = n.doctype,
        i = "<!DOCTYPE html>";
      return t && (i = "<!DOCTYPE " + t.name + (t.publicId ? ' PUBLIC "' + t.publicId + '"' : "") + (!t.publicId && t.systemId ? " SYSTEM" : "") + (t.systemId ? ' "' + t.systemId + '"' : "") + ">"), i
    }

    function w() {
      v();
      e();
      a();
      t.spaces.normalize(null, !0);
      t.html.fillEmptyBlocks();
      t.clean.quotes();
      t.clean.lists();
      t.clean.tables();
      t.clean.toHTML5();
      t.selection.restore();
      h();
      t.placeholder.refresh()
    }

    function h() {
      t.core.isEmpty() && (null != i() ? 0 === t.$el.get(0).querySelectorAll(r()).length && 0 === t.$el.get(0).querySelectorAll(t.opts.htmlDoNotWrapTags.join(":not(.fr-marker),") + ":not(.fr-marker)").length && (t.core.hasFocus() ? (t.$el.html("<" + i() + ">" + n.FE.MARKERS + "<br/><\/" + i() + ">"), t.selection.restore()) : t.$el.html("<" + i() + "><br/><\/" + i() + ">")) : 0 === t.$el.get(0).querySelectorAll("*:not(.fr-marker):not(br)").length && (t.core.hasFocus() ? (t.$el.html(n.FE.MARKERS + "<br/>"), t.selection.restore()) : t.$el.html("<br/>")))
    }

    function c(n, t) {
      return o(n, "<" + t + "[^>]*?>([\\w\\W]*)<\/" + t + ">", 1)
    }

    function f(i, r) {
      var u = n("<div " + (o(i, "<" + r + "([^>]*?)>", 1) || "") + ">");
      return t.node.rawAttributes(u.get(0))
    }

    function b(n) {
      return o(n, "<!DOCTYPE([^>]*?)>", 0) || "<!DOCTYPE html>"
    }

    function rt(i) {
      var r = t.clean.html(i || "", [], [], t.opts.fullPage),
        e, o, s;
      if (t.opts.fullPage) {
        var h = c(r, "body") || (r.indexOf("<body") >= 0 ? "" : r),
          l = f(r, "body"),
          u = c(r, "head") || "<title><\/title>",
          a = f(r, "head"),
          v = n("<div>").append(u).find("base, link, meta, noscript, script, style, template, title").remove().end().html().trim();
        u = n("<div>").append(u).find("base, link, meta, noscript, script, style, template, title").map(function() {
          return this.outerHTML
        }).toArray().join("");
        e = b(r);
        o = f(r, "html");
        t.$el.html(v + "\n" + h);
        t.node.clearAttributes(t.$el.get(0));
        t.$el.attr(l);
        t.$head.html(u);
        t.node.clearAttributes(t.$head.get(0));
        t.$head.attr(a);
        t.node.clearAttributes(t.$html.get(0));
        t.$html.attr(o);
        t.iframe_document.doctype.parentNode.replaceChild(it(e, t.iframe_document), t.iframe_document.doctype)
      } else t.$el.html(r);
      s = t.edit.isDisabled();
      t.edit.on();
      t.core.injectStyle(t.opts.iframeStyle);
      w();
      t.opts.useClasses || (t.$el.find("[fr-original-class]").each(function() {
        this.setAttribute("class", this.getAttribute("fr-original-class"));
        this.removeAttribute("fr-original-class")
      }), t.$el.find("[fr-original-style]").each(function() {
        this.setAttribute("style", this.getAttribute("fr-original-style"));
        this.removeAttribute("fr-original-style")
      }));
      s && t.edit.off();
      t.events.trigger("html.set")
    }

    function ut(n, i) {
      var r, h, p, c, k, w, l, b;
      if (!t.$wp) return t.$oel.clone().removeClass("fr-view").removeAttr("contenteditable").get(0).outerHTML;
      r = "";
      t.events.trigger("html.beforeGet");
      var u, g = function(n) {
          var t;
          return ! function() {
            var t = /:not\(([^\)]*)\)/g;
            t.test(n) && (n = n.replace(t, "     $1 "))
          }(), t = 100 * (n.match(/(#[^\s\+>~\.\[:]+)/g) || []).length + 10 * (n.match(/(\[[^\]]+\])/g) || []).length + 10 * (n.match(/(\.[^\s\+>~\.\[:]+)/g) || []).length + 10 * (n.match(/(:[\w-]+\([^\)]*\))/gi) || []).length + 10 * (n.match(/(:[^\s\+>~\.\[:]+)/g) || []).length + (n.match(/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi) || []).length, n = n.replace(/[\*\s\+>~]/g, " "), n = n.replace(/[#\.]/g, " "), t + (n.match(/([^\s\+>~\.\[:]+)/g) || []).length
        },
        e = [],
        a = {};
      if (!t.opts.useClasses && !i) {
        for (u = 0; u < t.doc.styleSheets.length; u++) {
          p = 0;
          try {
            h = t.doc.styleSheets[u].cssRules;
            t.doc.styleSheets[u].ownerNode && "STYLE" == t.doc.styleSheets[u].ownerNode.nodeType && (p = 1)
          } catch (tt) {}
          if (h)
            for (c = 0, k = h.length; k > c; c++)
              if (w = t.opts.iframe ? "body " : ".fr-view ", h[c].selectorText && 0 === h[c].selectorText.indexOf(w) && h[c].style.cssText.length > 0)
                for (var nt = h[c].selectorText.replace(w, "").replace(/::/g, ":"), o = t.$el.get(0).querySelectorAll(nt), f = 0; f < o.length; f++) {
                  !o[f].getAttribute("fr-original-style") && o[f].getAttribute("style") ? (o[f].setAttribute("fr-original-style", o[f].getAttribute("style")), e.push(o[f])) : o[f].getAttribute("fr-original-style") || e.push(o[f]);
                  a[o[f]] || (a[o[f]] = {});
                  for (var d = 1e3 * p + g(h[c].selectorText), y = h[c].style.cssText.split(";"), v = 0; v < y.length; v++) l = y[v].trim().split(":")[0], a[o[f]][l] || (a[o[f]][l] = 0, (o[f].getAttribute("fr-original-style") || "").indexOf(l + ":") >= 0 && (a[o[f]][l] = 1e4)), d >= a[o[f]][l] && (a[o[f]][l] = d, y[v].trim().length && (o[f].style[l.trim()] = y[v].trim().split(":")[1].trim()))
                }
        }
        for (u = 0; u < e.length; u++) e[u].getAttribute("class") && (e[u].setAttribute("fr-original-class", e[u].getAttribute("class")), e[u].removeAttribute("class"))
      }
      if (t.core.isEmpty() ? t.opts.fullPage && (r = s(t.iframe_document), r += "<html" + t.node.attributes(t.$html.get(0)) + ">" + t.$html.find("head").get(0).outerHTML + "<body><\/body><\/html>") : ("undefined" == typeof n && (n = !1), t.opts.fullPage ? (r = s(t.iframe_document), r += "<html" + t.node.attributes(t.$html.get(0)) + ">" + t.$html.html() + "<\/html>") : r = t.$el.html()), !t.opts.useClasses && !i)
        for (u = 0; u < e.length; u++) e[u].getAttribute("fr-original-class") && (e[u].setAttribute("class", e[u].getAttribute("fr-original-class")), e[u].removeAttribute("fr-original-class")), e[u].getAttribute("fr-original-style") ? (e[u].setAttribute("style", e[u].getAttribute("fr-original-style")), e[u].removeAttribute("fr-original-style")) : e[u].removeAttribute("style");
      return t.opts.fullPage && (r = r.replace(/<style data-fr-style="true">(?:[\w\W]*?)<\/style>/g, ""), r = r.replace(/<link(?:[\w\W]*?)data-fr-style="true"(?:[\w\W]*?)>/g, ""), r = r.replace(/<style(?:[\w\W]*?)class="firebugResetStyles"(?:[\w\W]*?)>(?:[\w\W]*?)<\/style>/g, ""), r = r.replace(/<body((?:[\w\W]*?)) spellcheck="true"((?:[\w\W]*?))>((?:[\w\W]*?))<\/body>/g, "<body$1$2>$3<\/body>"), r = r.replace(/<body((?:[\w\W]*?)) contenteditable="(true|false)"((?:[\w\W]*?))>((?:[\w\W]*?))<\/body>/g, "<body$1$3>$4<\/body>"), r = r.replace(/<body((?:[\w\W]*?)) dir="([\w]*)"((?:[\w\W]*?))>((?:[\w\W]*?))<\/body>/g, "<body$1$3>$4<\/body>"), r = r.replace(/<body((?:[\w\W]*?))class="([\w\W]*?)(fr-rtl|fr-ltr)([\w\W]*?)"((?:[\w\W]*?))>((?:[\w\W]*?))<\/body>/g, '<body$1class="$2$4"$5>$6<\/body>'), r = r.replace(/<body((?:[\w\W]*?)) class=""((?:[\w\W]*?))>((?:[\w\W]*?))<\/body>/g, "<body$1$2>$3<\/body>")), t.opts.htmlSimpleAmpersand && (r = r.replace(/\&amp;/gi, "&")), t.events.trigger("html.afterGet"), n || (r = r.replace(/<span[^>]*? class\s*=\s*["']?fr-marker["']?[^>]+>\u200b<\/span>/gi, "")), r = t.clean.invisibleSpaces(r), b = t.events.chainTrigger("html.get", r), "string" == typeof b && (r = b), r = r.replace(/<pre(?:[\w\W]*?)>(?:[\w\W]*?)<\/pre>/g, function(n) {
        return n.replace(/<br>/g, "\n")
      })
    }

    function ft() {
      var e = function(i, r) {
          for (; r && (r.nodeType == Node.TEXT_NODE || !t.node.isBlock(r)) && !t.node.isElement(r);) r && r.nodeType != Node.TEXT_NODE && n(i).wrapInner(t.node.openTagString(r) + t.node.closeTagString(r)), r = r.parentNode;
          r && i.innerHTML == r.innerHTML && (i.innerHTML = r.outerHTML)
        },
        o = function() {
          var r, i = null;
          return t.win.getSelection ? (r = t.win.getSelection(), r && r.rangeCount && (i = r.getRangeAt(0).commonAncestorContainer, i.nodeType != Node.ELEMENT_NODE && (i = i.parentNode))) : (r = t.doc.selection) && "Control" != r.type && (i = r.createRange().parentElement()), null != i && (n.inArray(t.$el.get(0), n(i).parents()) >= 0 || i == t.$el.get(0)) ? i : null
        },
        u = "",
        f, r, i;
      if ("undefined" != typeof t.win.getSelection)
        for (t.browser.mozilla && (t.selection.save(), t.$el.find('.fr-marker[data-type="false"]').length > 1 && (t.$el.find('.fr-marker[data-type="false"][data-id="0"]').remove(), t.$el.find('.fr-marker[data-type="false"]:last').attr("data-id", "0"), t.$el.find(".fr-marker").not('[data-id="0"]').remove()), t.selection.restore()), f = t.selection.ranges(), r = 0; r < f.length; r++) i = document.createElement("div"), i.appendChild(f[r].cloneContents()), e(i, o()), n(i).find(".fr-element").length > 0 && (i = t.$el.get(0)), u += i.innerHTML;
      else "undefined" != typeof t.doc.selection && "Text" == t.doc.selection.type && (u = t.doc.selection.createRange().htmlText);
      return u
    }

    function et(t) {
      var i = n("<div>").html(t);
      return i.find(r()).length > 0
    }

    function ot(n) {
      var i = t.doc.createElement("div");
      return i.innerHTML = n, t.selection.setAtEnd(i), i.innerHTML
    }

    function st(n) {
      return n.replace(/</gi, "&lt;").replace(/>/gi, "&gt;").replace(/"/gi, "&quot;").replace(/'/gi, "&apos;")
    }

    function ht(i, r, u) {
      var f, o, e;
      if (t.selection.isCollapsed() || t.selection.remove(), f = r ? i : t.clean.html(i), f = f.replace(/\r|\n/g, " "), i.indexOf('class="fr-marker"') < 0 && (f = ot(f)), t.core.isEmpty()) t.$el.html(f);
      else if (e = t.markers.insert(), e)
        if ((et(f) || u) && (o = t.node.deepestParent(e))) {
          if (e = t.markers.split(), !e) return !1;
          n(e).replaceWith(f)
        } else n(e).replaceWith(f);
      else t.$el.append(f);
      w();
      t.events.trigger("html.inserted")
    }

    function k(i) {
      var s = null,
        f, e, u, r, o;
      "undefined" == typeof i && (s = t.selection.element());
      do
        for (e = !1, f = t.$el.get(0).querySelectorAll("*:not(.fr-marker)"), u = 0; u < f.length; u++) r = f[u], s != r && (o = r.textContent, 0 === r.children.length && 1 === o.length && 8203 == o.charCodeAt(0) && (n(r).remove(), e = !0)); while (e)
    }

    function ct() {
      var n = function() {
        k();
        t.placeholder && t.placeholder.refresh()
      };
      t.events.on("mouseup", n);
      t.events.on("keydown", n);
      t.events.on("contentChanged", h)
    }
    return {
      defaultTag: i,
      emptyBlocks: l,
      emptyBlockTagsQuery: d,
      blockTagsQuery: r,
      fillEmptyBlocks: nt,
      cleanEmptyTags: a,
      cleanWhiteTags: k,
      doNormalize: p,
      cleanBlankSpaces: e,
      blocks: tt,
      getDoctype: s,
      set: rt,
      get: ut,
      getSelected: ft,
      insert: ht,
      wrap: v,
      unwrap: g,
      escapeEntities: st,
      checkIfEmpty: h,
      extractNode: c,
      extractNodeAttrs: f,
      extractDoctype: b,
      _init: ct
    }
  };
  n.extend(n.FE.DEFAULTS, {
    height: null,
    heightMax: null,
    heightMin: null,
    width: null
  });
  n.FE.MODULES.size = function(n) {
    function t() {
      n.opts.height && n.$el.css("minHeight", n.opts.height - n.helpers.getPX(n.$el.css("padding-top")) - n.helpers.getPX(n.$el.css("padding-bottom")));
      n.$iframe.height(n.$el.outerHeight(!0))
    }

    function i() {
      n.opts.heightMin ? n.$el.css("minHeight", n.opts.heightMin) : n.$el.css("minHeight", "");
      n.opts.heightMax ? (n.$wp.css("maxHeight", n.opts.heightMax), n.$wp.css("overflow", "auto")) : (n.$wp.css("maxHeight", ""), n.$wp.css("overflow", ""));
      n.opts.height ? (n.$wp.height(n.opts.height), n.$el.css("minHeight", n.opts.height - n.helpers.getPX(n.$el.css("padding-top")) - n.helpers.getPX(n.$el.css("padding-bottom"))), n.$wp.css("overflow", "auto")) : (n.$wp.css("height", ""), n.opts.heightMin || n.$el.css("minHeight", ""), n.opts.heightMax || n.$wp.css("overflow", ""));
      n.opts.width && n.$box.width(n.opts.width)
    }

    function r() {
      return n.$wp ? (i(), void(n.opts.iframe && (n.events.on("keyup", t), n.events.on("commands.after", t), n.events.on("html.set", t), n.events.on("init", t), n.events.on("initialized", t)))) : !1
    }
    return {
      _init: r,
      syncIframe: t,
      refresh: i
    }
  };
  n.extend(n.FE.DEFAULTS, {
    language: null
  });
  n.FE.LANGUAGE = {};
  n.FE.MODULES.language = function(t) {
    function r(n) {
      return i && i.translation[n] ? i.translation[n] : n
    }

    function u() {
      n.FE.LANGUAGE && (i = n.FE.LANGUAGE[t.opts.language]);
      i && i.direction && (t.opts.direction = i.direction)
    }
    var i;
    return {
      _init: u,
      translate: r
    }
  };
  n.extend(n.FE.DEFAULTS, {
    placeholderText: "Type something"
  });
  n.FE.MODULES.placeholder = function(t) {
    function i() {
      var i;
      t.$placeholder || e();
      var u = 0,
        f = 0,
        o = 0,
        s = 0,
        r = t.node.contents(t.$el.get(0));
      r.length && r[0].nodeType == Node.ELEMENT_NODE ? (i = n(r[0]), t.opts.toolbarInline || (u = t.helpers.getPX(i.css("margin-top")), o = t.helpers.getPX(i.css("padding-top")), f = t.helpers.getPX(i.css("margin-left")), s = t.helpers.getPX(i.css("padding-left"))), t.$placeholder.css("font-size", i.css("font-size")), t.$placeholder.css("line-height", i.css("line-height"))) : (t.$placeholder.css("font-size", t.$el.css("font-size")), t.$placeholder.css("line-height", t.$el.css("line-height")));
      t.$wp.addClass("show-placeholder");
      t.$placeholder.css({
        marginTop: Math.max(t.helpers.getPX(t.$el.css("margin-top")), u),
        paddingTop: Math.max(t.helpers.getPX(t.$el.css("padding-top")), o),
        paddingLeft: Math.max(t.helpers.getPX(t.$el.css("padding-left")), s),
        marginLeft: Math.max(t.helpers.getPX(t.$el.css("margin-left")), f)
      }).text(t.language.translate(t.opts.placeholderText || t.$oel.attr("placeholder") || "")).css("width", t.$el.width());
      t.$placeholder.html(t.$placeholder.text().replace(/\n/g, "<br>"))
    }

    function r() {
      t.$wp.removeClass("show-placeholder")
    }

    function f() {
      return t.$wp ? t.$wp.hasClass("show-placeholder") : !0
    }

    function u() {
      return t.$wp ? void(t.core.isEmpty() ? i() : r()) : !1
    }

    function e() {
      t.$placeholder = n('<span class="fr-placeholder"><\/span>');
      t.$wp.append(t.$placeholder)
    }

    function o() {
      return t.$wp ? void t.events.on("init input keydown keyup contentChanged initialized", u) : !1
    }
    return {
      _init: o,
      show: i,
      hide: r,
      refresh: u,
      isVisible: f
    }
  };
  n.FE.MODULES.edit = function(n) {
    function i() {
      if (n.browser.mozilla) try {
        n.doc.execCommand("enableObjectResizing", !1, "false");
        n.doc.execCommand("enableInlineTableEditing", !1, "false")
      } catch (t) {}
      if (n.browser.msie) try {
        n.doc.body.addEventListener("mscontrolselect", function(n) {
          return n.preventDefault(), !1
        })
      } catch (t) {}
    }

    function r() {
      n.$wp ? (n.$el.attr("contenteditable", !0), n.$el.removeClass("fr-disabled"), n.$tb && n.$tb.removeClass("fr-disabled"), i()) : n.$el.is("a") && n.$el.attr("contenteditable", !0);
      t = !1
    }

    function u() {
      n.$wp ? (n.$el.attr("contenteditable", !1), n.$el.addClass("fr-disabled"), n.$tb && n.$tb.addClass("fr-disabled")) : n.$el.is("a") && n.$el.attr("contenteditable", !1);
      t = !0
    }

    function f() {
      return t
    }
    var t = !1;
    return {
      on: r,
      off: u,
      disableDesign: i,
      isDisabled: f
    }
  };
  n.extend(n.FE.DEFAULTS, {
    editorClass: null,
    typingTimer: 500,
    iframe: !1,
    requestWithCORS: !0,
    requestHeaders: {},
    useClasses: !0,
    spellcheck: !0,
    iframeStyle: 'html{margin: 0px;}body{padding:10px;background:transparent;color:#000000;position:relative;z-index: 2;-webkit-user-select:auto;margin:0px;overflow:hidden;min-height:20px;}body:after{content:"";display:block;clear:both;}',
    iframeStyleFiles: [],
    direction: "auto",
    zIndex: 1,
    disableRightClick: !1,
    scrollableContainer: "body",
    keepFormatOnDelete: !1,
    theme: null
  });
  n.FE.MODULES.core = function(t) {
    function i(n) {
      if (t.opts.iframe) {
        t.$head.find("style[data-fr-style], link[data-fr-style]").remove();
        t.$head.append('<style data-fr-style="true">' + n + "<\/style>");
        for (var i = 0; i < t.opts.iframeStyleFiles.length; i++) t.$head.append('<link data-fr-style="true" rel="stylesheet" href="' + t.opts.iframeStyleFiles[i] + '">')
      }
    }

    function r() {
      t.opts.iframe || t.$el.addClass("fr-element fr-view")
    }

    function u() {
      var u, n, i, f;
      if (t.$box.addClass("fr-box" + (t.opts.editorClass ? " " + t.opts.editorClass : "")), t.$wp.addClass("fr-wrapper"), r(), t.opts.iframe)
        for (t.$iframe.addClass("fr-iframe"), t.$html.find("body").addClass("fr-view"), u = 0; u < t.o_doc.styleSheets.length; u++) {
          try {
            n = t.o_doc.styleSheets[u].cssRules
          } catch (e) {}
          if (n)
            for (i = 0, f = n.length; f > i; i++) n[i].selectorText && (0 === n[i].selectorText.indexOf(".fr-view") || 0 === n[i].selectorText.indexOf(".fr-element")) && n[i].style.cssText.length > 0 && (t.opts.iframeStyle += 0 === n[i].selectorText.indexOf(".fr-view") ? n[i].selectorText.replace(/\.fr-view/g, "body") + "{" + n[i].style.cssText + "}" : n[i].selectorText.replace(/\.fr-element/g, "body") + "{" + n[i].style.cssText + "}")
        }
      "auto" != t.opts.direction && t.$box.removeClass("fr-ltr fr-rtl").addClass("fr-" + t.opts.direction);
      t.$el.attr("dir", t.opts.direction);
      t.$wp.attr("dir", t.opts.direction);
      t.opts.zIndex > 1 && t.$box.css("z-index", t.opts.zIndex);
      t.opts.theme && t.$box.addClass(t.opts.theme + "-theme")
    }

    function f() {
      return t.node.isEmpty(t.$el.get(0))
    }

    function e() {
      t.drag_support = {
        filereader: "undefined" != typeof FileReader,
        formdata: !!t.win.FormData,
        progress: "upload" in new XMLHttpRequest
      }
    }

    function o(n, i) {
      var r = new XMLHttpRequest,
        u;
      r.open(i, n, !0);
      t.opts.requestWithCORS && (r.withCredentials = !0);
      for (u in t.opts.requestHeaders) t.opts.requestHeaders.hasOwnProperty(u) && r.setRequestHeader(u, t.opts.requestHeaders[u]);
      return r
    }

    function s(n) {
      "TEXTAREA" == t.$oel.get(0).tagName && t.$oel.val(n);
      t.$wp && ("TEXTAREA" == t.$oel.get(0).tagName ? (t.$el.html(""), t.$wp.html(""), t.$box.replaceWith(t.$oel), t.$oel.show()) : (t.$wp.replaceWith(n), t.$el.html(""), t.$box.removeClass("fr-view fr-ltr fr-box " + (t.opts.editorClass || "")), t.opts.theme && t.$box.addClass(t.opts.theme + "-theme")));
      this.$wp = null;
      this.$el = null;
      this.$box = null
    }

    function h() {
      return t.browser.mozilla && t.helpers.isMobile() ? t.selection.inEditor() : t.node.hasFocus(t.$el.get(0)) || t.$el.find("*:focus").length > 0
    }

    function c(n) {
      if (!n) return !1;
      var i = n.data("instance");
      return i ? i.id == t.id : !1
    }

    function l() {
      if (n.FE.INSTANCES.push(t), e(), t.$wp) {
        u();
        t.html.set(t._original_html);
        t.$el.attr("spellcheck", t.opts.spellcheck);
        t.helpers.isMobile() && (t.$el.attr("autocomplete", t.opts.spellcheck ? "on" : "off"), t.$el.attr("autocorrect", t.opts.spellcheck ? "on" : "off"), t.$el.attr("autocapitalize", t.opts.spellcheck ? "on" : "off"));
        t.opts.disableRightClick && t.events.$on(t.$el, "contextmenu", function(n) {
          if (2 == n.button) return !1
        });
        try {
          t.doc.execCommand("styleWithCSS", !1, !1)
        } catch (i) {}
      }
      t.events.on("drop", function(n) {
        n.preventDefault();
        n.stopPropagation()
      });
      "TEXTAREA" == t.$oel.get(0).tagName && (t.events.on("contentChanged", function() {
        t.$oel.val(t.html.get())
      }), t.events.on("form.submit", function() {
        t.$oel.val(t.html.get())
      }), t.events.on("form.reset", function() {
        t.html.set(t._original_html)
      }), t.$oel.val(t.html.get()));
      t.helpers.isIOS() && t.events.$on(t.$doc, "selectionchange", function() {
        t.$doc.get(0).hasFocus() || t.$win.get(0).focus()
      });
      t.events.trigger("init")
    }
    return {
      _init: l,
      destroy: s,
      isEmpty: f,
      getXHR: o,
      injectStyle: i,
      hasFocus: h,
      sameInstance: c
    }
  };
  n.FE.MODULES.format = function(t) {
    function e(n, t) {
      var r = "<" + n;
      for (var i in t) t.hasOwnProperty(i) && (r += " " + i + '="' + t[i] + '"');
      return r + ">"
    }

    function l(n) {
      return "<\/" + n + ">"
    }

    function i(n, t) {
      var r = n;
      for (var i in t) t.hasOwnProperty(i) && (n += "id" == i ? "#" + t[i] : "class" == i ? "." + t[i] : "[" + i + '="' + t[i] + '"]');
      return r
    }

    function r(n, t) {
      return n && n.nodeType == Node.ELEMENT_NODE ? (n.matches || n.matchesSelector || n.msMatchesSelector || n.mozMatchesSelector || n.webkitMatchesSelector || n.oMatchesSelector).call(n, t) : !1
    }

    function u(i, r, f) {
      var h, o, l, s, c;
      if (i) {
        if (t.node.isBlock(i)) return u(i.firstChild, r, f), !1;
        for (h = n(e(r, f)).insertBefore(i), o = i; o && !n(o).is(".fr-marker") && 0 == n(o).find(".fr-marker").length;) l = o, o = o.nextSibling, h.append(l);
        if (o) n(o).find(".fr-marker").length && u(o.firstChild, r, f);
        else {
          for (s = h.get(0).parentNode; s && !s.nextSibling && !t.node.isElement(s);) s = s.parentNode;
          s && (c = s.nextSibling, c && (t.node.isBlock(c) ? u(c.firstChild, r, f) : u(c, r, f)))
        }
        h.is(":empty") && h.remove()
      }
    }

    function o(f, o) {
      var v, y, c, a, h, s;
      if ("undefined" == typeof o && (o = {}), o.style && delete o.style, t.selection.isCollapsed()) t.markers.insert(), v = t.$el.find(".fr-marker"), v.replaceWith(e(f, o) + n.FE.INVISIBLE_SPACE + n.FE.MARKERS + l(f)), t.selection.restore();
      else {
        t.selection.save();
        y = t.$el.find('.fr-marker[data-type="true"]').get(0).nextSibling;
        u(y, f, o);
        do c = t.$el.find(i(f, o) + " > " + i(f, o)), c.each(function() {
          n(this).replaceWith(this.innerHTML)
        }); while (c.length);
        for (t.$el.get(0).normalize(), a = t.$el.get(0).querySelectorAll(".fr-marker"), h = 0; h < a.length; h++) s = n(a[h]), 1 == s.data("type") ? r(s.get(0).nextSibling, i(f, o)) && s.next().prepend(s) : r(s.get(0).previousSibling, i(f, o)) && s.prev().append(s);
        t.selection.restore()
      }
    }

    function a(n, u, f, e) {
      var s, l, a;
      if (!e) {
        if (s = !1, n.data("type") === !0)
          for (; t.node.isFirstSibling(n.get(0)) && !n.parent().is(t.$el);) n.parent().before(n), s = !0;
        else if (n.data("type") === !1)
          for (; t.node.isLastSibling(n.get(0)) && !n.parent().is(t.$el);) n.parent().after(n), s = !0;
        if (s) return !0
      }
      if (n.parents(u).length || "undefined" == typeof u) {
        var c = "",
          h = "",
          o = n.parent();
        if (o.is(t.$el) || t.node.isBlock(o.get(0))) return !1;
        for (;
          "undefined" == typeof u && !t.node.isBlock(o.parent().get(0)) || "undefined" != typeof u && !r(o.get(0), i(u, f));) c += t.node.closeTagString(o.get(0)), h = t.node.openTagString(o.get(0)) + h, o = o.parent();
        return l = n.get(0).outerHTML, n.replaceWith('<span id="mark"><\/span>'), a = o.html().replace(/<span id="mark"><\/span>/, c + t.node.closeTagString(o.get(0)) + h + l + c + t.node.openTagString(o.get(0)) + h), o.replaceWith(t.node.openTagString(o.get(0)) + a + t.node.closeTagString(o.get(0))), !0
      }
      return !1
    }

    function f(u, e, o, s) {
      for (var h, l = t.node.contents(u.get(0)), c = 0; c < l.length; c++) h = l[c], n(h).hasClass("fr-marker") ? e = (e + 1) % 2 : e ? n(h).find(".fr-marker").length > 0 ? e = f(n(h), e, o, s) : (n(n(h).find(o || "*").get().reverse()).each(function() {
        t.node.isBlock(this) || t.node.isVoid(this) || n(this).replaceWith(this.innerHTML)
      }), ("undefined" == typeof o && h.nodeType == Node.ELEMENT_NODE && !t.node.isVoid(h) && !t.node.isBlock(h) || r(h, i(o, s))) && n(h).replaceWith(h.innerHTML)) : n(h).find(".fr-marker").length > 0 && (e = f(n(h), e, o, s));
      return e
    }

    function s(i, r) {
      var o, u, s, e;
      for ("undefined" == typeof r && (r = {}), r.style && delete r.style, o = t.selection.isCollapsed(), t.selection.save(), u = !0; u;)
        for (u = !1, s = t.$el.find(".fr-marker"), e = 0; e < s.length; e++)
          if (a(n(s[e]), i, r, o)) {
            u = !0;
            break
          }
      f(t.$el, 0, i, r);
      o && t.$el.find(".fr-marker").before(n.FE.INVISIBLE_SPACE).after(n.FE.INVISIBLE_SPACE);
      t.html.cleanEmptyTags();
      t.$el.get(0).normalize();
      t.selection.restore()
    }

    function v(n, t) {
      c(n, t) ? s(n, t) : o(n, t)
    }

    function y(t, i) {
      var r = n(t);
      r.css(i, "");
      "" === r.attr("style") && r.replaceWith(r.html())
    }

    function p(t, i) {
      return 0 === n(t).attr("style").indexOf(i + ":") || n(t).attr("style").indexOf(";" + i + ":") >= 0 || n(t).attr("style").indexOf("; " + i + ":") >= 0
    }

    function h(i, r) {
      var s, w, f, tt, b, o, k, d, e, c, ut, ft, a, v, l;
      if (t.selection.isCollapsed()) t.markers.insert(), f = t.$el.find(".fr-marker"), s = f.parent(), t.node.openTagString(s.get(0)) == '<span style="' + i + ": " + s.css(i) + ';">' && t.node.isEmpty(s.get(0)) ? s.replaceWith('<span style="' + i + ": " + r + ';">' + n.FE.INVISIBLE_SPACE + n.FE.MARKERS + "<\/span>") : t.node.isEmpty(s.get(0)) && s.is("span") ? (f.replaceWith(n.FE.MARKERS), s.css(i, r)) : f.replaceWith('<span style="' + i + ": " + r + ';">' + n.FE.INVISIBLE_SPACE + n.FE.MARKERS + "<\/span>"), t.selection.restore();
      else {
        if (t.selection.save(), null === r)
          for (w = t.$el.find(".fr-marker"), e = 0; e < w.length; e++)
            if (f = n(w[e]), f.data("type") === !0)
              for (; t.node.isFirstSibling(f.get(0)) && !f.parent().is(t.$el);) f.parent().before(f);
            else
              for (; t.node.isLastSibling(f.get(0)) && !f.parent().is(t.$el);) f.parent().after(f);
        for (tt = t.$el.find('.fr-marker[data-type="true"]').get(0).nextSibling, b = {
            "class": "fr-unprocessed"
          }, r && (b.style = i + ": " + r + ";"), u(tt, "span", b), t.$el.find(".fr-marker + .fr-unprocessed").each(function() {
            n(this).prepend(n(this).prev())
          }), t.$el.find(".fr-unprocessed + .fr-marker").each(function() {
            n(this).prev().append(this)
          }); t.$el.find("span.fr-unprocessed").length > 0;) {
          for (o = t.$el.find("span.fr-unprocessed:first").removeClass("fr-unprocessed"), (o.parent().get(0).normalize(), o.parent().is("span") && 1 == o.parent().get(0).childNodes.length) && (o.parent().css(i, r), k = o, o = o.parent(), k.replaceWith(k.html())), d = o.find("span"), e = d.length - 1; e >= 0; e--) y(d[e], i);
          if (c = o.parentsUntil(t.$el, "span[style]").filter(function() {
              return p(this, i)
            }), c.length) {
            var it = "",
              g = "",
              rt = "",
              nt = "",
              h = o.get(0);
            do h = h.parentNode, it += t.node.closeTagString(h), g = t.node.openTagString(n(h).clone().addClass("fr-split").get(0)) + g, c.get(0) != h && (rt += t.node.closeTagString(h), nt = t.node.openTagString(n(h).clone().addClass("fr-split").get(0)) + nt); while (c.get(0) != h);
            ut = it + t.node.openTagString(c.clone().css(i, r || "").get(0)) + nt + o.html() + rt + "<\/span>" + g;
            o.replaceWith('<span id="fr-break"><\/span>');
            ft = c.get(0).outerHTML;
            n(c.get(0)).replaceWith(ft.replace(/<span id="fr-break"><\/span>/g, ut))
          }
        }
        for (; t.$el.find(".fr-split:empty").length > 0;) t.$el.find(".fr-split:empty").remove();
        for (t.$el.find(".fr-split").removeClass("fr-split"), t.$el.find('span[style=""]').removeAttr("style"), t.$el.find('span[class=""]').removeAttr("class"), t.html.cleanEmptyTags(), t.$el.find("span").each(function() {
            this.attributes && 0 != this.attributes.length || n(this).replaceWith(this.innerHTML)
          }), t.$el.get(0).normalize(), a = t.$el.find("span[style] + span[style]"), e = 0; e < a.length; e++) v = n(a[e]), l = n(a[e]).prev(), v.get(0).previousSibling == l.get(0) && t.node.openTagString(v.get(0)) == t.node.openTagString(l.get(0)) && (v.prepend(l.html()), l.remove());
        t.$el.get(0).normalize();
        t.selection.restore()
      }
    }

    function w(n) {
      h(n, null)
    }

    function c(n, u) {
      var s, o, e, f;
      for ("undefined" == typeof u && (u = {}), u.style && delete u.style, s = t.selection.ranges(0), o = s.startContainer, o.nodeType == Node.ELEMENT_NODE && o.childNodes.length > 0 && o.childNodes[s.startOffset] && (o = o.childNodes[s.startOffset]), e = o; e && e.nodeType == Node.ELEMENT_NODE && !r(e, i(n, u));) e = e.firstChild;
      if (e && e.nodeType == Node.ELEMENT_NODE && r(e, i(n, u))) return !0;
      for (f = o, f && f.nodeType != Node.ELEMENT_NODE && (f = f.parentNode); f && f.nodeType == Node.ELEMENT_NODE && f != t.$el.get(0) && !r(f, i(n, u));) f = f.parentNode;
      return f && f.nodeType == Node.ELEMENT_NODE && f != t.$el.get(0) && r(f, i(n, u)) ? !0 : !1
    }
    return {
      is: c,
      toggle: v,
      apply: o,
      remove: s,
      applyStyle: h,
      removeStyle: w
    }
  };
  n.FE.COMMANDS = {
    bold: {
      title: "Bold",
      refresh: function(n) {
        n.toggleClass("fr-active", this.format.is("strong"))
      }
    },
    italic: {
      title: "Italic",
      refresh: function(n) {
        n.toggleClass("fr-active", this.format.is("em"))
      }
    },
    underline: {
      title: "Underline",
      refresh: function(n) {
        n.toggleClass("fr-active", this.format.is("u"))
      }
    },
    strikeThrough: {
      title: "Strikethrough",
      refresh: function(n) {
        n.toggleClass("fr-active", this.format.is("s"))
      }
    },
    subscript: {
      title: "Subscript",
      refresh: function(n) {
        n.toggleClass("fr-active", this.format.is("sub"))
      }
    },
    superscript: {
      title: "Superscript",
      refresh: function(n) {
        n.toggleClass("fr-active", this.format.is("sup"))
      }
    },
    outdent: {
      title: "Decrease Indent"
    },
    indent: {
      title: "Increase Indent"
    },
    undo: {
      title: "Undo",
      undo: !1,
      forcedRefresh: !0,
      disabled: !0
    },
    redo: {
      title: "Redo",
      undo: !1,
      forcedRefresh: !0,
      disabled: !0
    },
    insertHR: {
      title: "Insert Horizontal Line"
    },
    clearFormatting: {
      title: "Clear Formatting"
    },
    selectAll: {
      title: "Select All",
      undo: !1
    }
  };
  n.FE.RegisterCommand = function(t, i) {
    n.FE.COMMANDS[t] = i
  };
  n.FE.MODULES.commands = function(t) {
    function f(i, u) {
      if (t.events.trigger("commands.before", n.merge([i], u || [])) !== !1) {
        var f = n.FE.COMMANDS[i] && n.FE.COMMANDS[i].callback || r[i],
          e = !0;
        n.FE.COMMANDS[i] && "undefined" != typeof n.FE.COMMANDS[i].focus && (e = n.FE.COMMANDS[i].focus);
        t.core.hasFocus() || !e || t.popups.areVisible() || t.events.focus(!0);
        n.FE.COMMANDS[i] && n.FE.COMMANDS[i].undo !== !1 && t.undo.saveStep();
        f && f.apply(t, n.merge([i], u || []));
        t.events.trigger("commands.after", n.merge([i], u || []));
        n.FE.COMMANDS[i] && n.FE.COMMANDS[i].undo !== !1 && t.undo.saveStep()
      }
    }

    function i(n, i) {
      t.format.toggle(i)
    }

    function e(i) {
      var u, r;
      for (t.selection.save(), t.html.wrap(!0, !0, !0, !0), t.selection.restore(), u = t.selection.blocks(), r = 0; r < u.length; r++)
        if ("LI" != u[r].tagName && "LI" != u[r].parentNode.tagName) {
          var f = n(u[r]),
            e = "rtl" == t.opts.direction || "rtl" == f.css("direction") ? "margin-right" : "margin-left",
            o = t.helpers.getPX(f.css(e));
          f.css(e, Math.max(o + 20 * i, 0) || "");
          f.removeClass("fr-temp-div")
        }
      t.selection.save();
      t.html.unwrap();
      t.selection.restore()
    }

    function s(n) {
      return function() {
        f(n)
      }
    }

    function h() {
      t.events.on("keydown", function(n) {
        var i = t.selection.element();
        if (i && "HR" == i.tagName) return (n.preventDefault(), !1)
      });
      t.events.on("mousedown", function(n) {
        if (n.target && "HR" == n.target.tagName) return (n.preventDefault(), n.stopPropagation(), !1)
      });
      t.events.on("mouseup", function() {
        var n = t.selection.element(),
          i = t.selection.endElement();
        n == i && n && "HR" == n.tagName && t.selection.clear()
      })
    }
    var r = {
        bold: function() {
          i("bold", "strong")
        },
        subscript: function() {
          i("subscript", "sub")
        },
        superscript: function() {
          i("superscript", "sup")
        },
        italic: function() {
          i("italic", "em")
        },
        strikeThrough: function() {
          i("strikeThrough", "s")
        },
        underline: function() {
          i("underline", "u")
        },
        undo: function() {
          t.undo.run()
        },
        redo: function() {
          t.undo.redo()
        },
        indent: function() {
          e(1)
        },
        outdent: function() {
          e(-1)
        },
        show: function() {
          t.opts.toolbarInline && t.toolbar.showInline(null, !0)
        },
        insertHR: function() {
          var n, i;
          t.selection.remove();
          n = "";
          t.core.isEmpty() && (n = "<br>", t.html.defaultTag() && (n = "<" + t.html.defaultTag() + ">" + n + "<\/" + t.html.defaultTag() + ">"));
          t.html.insert('<hr id="fr-just">' + n);
          i = t.$el.find("hr#fr-just");
          i.removeAttr("id");
          t.selection.setAfter(i.get(0)) || t.selection.setBefore(i.get(0));
          t.selection.restore()
        },
        clearFormatting: function() {
          t.format.remove()
        },
        selectAll: function() {
          t.doc.execCommand("selectAll", !1, !1)
        }
      },
      o = {};
    for (var u in r) r.hasOwnProperty(u) && (o[u] = s(u));
    return n.extend(o, {
      exec: f,
      _init: h
    })
  };
  n.FE.MODULES.cursorLists = function(t) {
    function i(n) {
      for (var t = n;
        "LI" != t.tagName;) t = t.parentNode;
      return t
    }

    function r(n) {
      for (var i = n; !t.node.isList(i);) i = i.parentNode;
      return i
    }

    function u(u) {
      var e, o = i(u),
        v = o.nextSibling,
        y = o.previousSibling,
        s = t.html.defaultTag(),
        a, l;
      if (t.node.isEmpty(o, !0) && v) {
        for (var h = "", c = "", f = u.parentNode; !t.node.isList(f) && f.parentNode && "LI" !== f.parentNode.tagName;) h = t.node.openTagString(f) + h, c += t.node.closeTagString(f), f = f.parentNode;
        for (h = t.node.openTagString(f) + h, c += t.node.closeTagString(f), a = "", a = f.parentNode && "LI" == f.parentNode.tagName ? c + "<li>" + n.FE.MARKERS + "<br>" + h : s ? c + "<" + s + ">" + n.FE.MARKERS + "<br><\/" + s + ">" + h : c + n.FE.MARKERS + "<br>" + h, n(o).html('<span id="fr-break"><\/span>');
          ["UL", "OL"].indexOf(f.tagName) < 0 || f.parentNode && "LI" === f.parentNode.tagName;) f = f.parentNode;
        l = t.node.openTagString(f) + n(f).html() + t.node.closeTagString(f);
        l = l.replace(/<span id="fr-break"><\/span>/g, a);
        n(f).replaceWith(l);
        t.$el.find("li:empty").remove()
      } else y && v || !t.node.isEmpty(o, !0) ? (n(o).before("<li><br><\/li>"), n(u).remove()) : y ? (e = r(o), e.parentNode && "LI" == e.parentNode.tagName ? n(e.parentNode).after("<li>" + n.FE.MARKERS + "<br><\/li>") : s ? n(e).after("<" + s + ">" + n.FE.MARKERS + "<br><\/" + s + ">") : n(e).after(n.FE.MARKERS + "<br>"), n(o).remove()) : (e = r(o), e.parentNode && "LI" == e.parentNode.tagName ? n(e.parentNode).before("<li>" + n.FE.MARKERS + "<br><\/li>") : s ? n(e).before("<" + s + ">" + n.FE.MARKERS + "<br><\/" + s + ">") : n(e).before(n.FE.MARKERS + "<br>"), n(o).remove())
    }

    function f(r) {
      for (var c, e, f = i(r), o = "", u = r, s = "", h = ""; u != f;) u = u.parentNode, c = "A" == u.tagName && t.cursor.isAtEnd(r, u) ? "fr-to-remove" : "", s = t.node.openTagString(n(u).clone().addClass(c).get(0)) + s, h = t.node.closeTagString(u) + h;
      o = h + o + s + n.FE.MARKERS;
      n(r).replaceWith('<span id="fr-break"><\/span>');
      e = t.node.openTagString(f) + n(f).html() + t.node.closeTagString(f);
      e = e.replace(/<span id="fr-break"><\/span>/g, o);
      n(f).replaceWith(e)
    }

    function e(r) {
      for (var h, c, e = i(r), o = n.FE.MARKERS, f = "", u = r, s = !1; u != e;) u = u.parentNode, h = "A" == u.tagName && t.cursor.isAtEnd(r, u) ? "fr-to-remove" : "", s || u == e || t.node.isBlock(u) || (s = !0, f += n.FE.INVISIBLE_SPACE), f = t.node.openTagString(n(u).clone().addClass(h).get(0)) + f, o += t.node.closeTagString(u);
      c = f + o;
      n(r).remove();
      n(e).after(c)
    }

    function o(u) {
      var f = i(u),
        s = f.previousSibling,
        h, c, e, o, a, l;
      if (s) {
        for (s = n(s).find(t.html.blockTagsQuery()).get(-1) || s, n(u).replaceWith(n.FE.MARKERS), h = t.node.contents(s), h.length && "BR" == h[h.length - 1].tagName && n(h[h.length - 1]).remove(), n(f).find(t.html.blockTagsQuery()).not("ol, ul, table").each(function() {
            this.parentNode == f && n(this).replaceWith(n(this).html() + (t.node.isEmpty(this) ? "" : "<br>"))
          }), e = t.node.contents(f)[0]; e && !t.node.isList(e);) c = e.nextSibling, n(s).append(e), e = c;
        for (s = f.previousSibling; e;) c = e.nextSibling, n(s).append(e), e = c;
        n(f).remove()
      } else o = r(f), (n(u).replaceWith(n.FE.MARKERS), o.parentNode && "LI" == o.parentNode.tagName) ? (a = o.previousSibling, t.node.isBlock(a) ? (n(f).find(t.html.blockTagsQuery()).not("ol, ul, table").each(function() {
        this.parentNode == f && n(this).replaceWith(n(this).html() + (t.node.isEmpty(this) ? "" : "<br>"))
      }), n(a).append(n(f).html())) : n(o).before(n(f).html())) : (l = t.html.defaultTag(), l && 0 === n(f).find(t.html.blockTagsQuery()).length ? n(o).before("<" + l + ">" + n(f).html() + "<\/" + l + ">") : n(o).before(n(f).html())), n(f).remove(), 0 === n(o).find("li").length && n(o).remove()
    }

    function s(r) {
      var f, o = i(r),
        s = o.nextSibling,
        h, c, e, u;
      if (s) {
        for (f = t.node.contents(s), f.length && "BR" == f[0].tagName && n(f[0]).remove(), n(s).find(t.html.blockTagsQuery()).not("ol, ul, table").each(function() {
            this.parentNode == s && n(this).replaceWith(n(this).html() + (t.node.isEmpty(this) ? "" : "<br>"))
          }), c = r, e = t.node.contents(s)[0]; e && !t.node.isList(e);) h = e.nextSibling, n(c).after(e), c = e, e = h;
        for (; e;) h = e.nextSibling, n(o).append(e), e = h;
        n(r).replaceWith(n.FE.MARKERS);
        n(s).remove()
      } else {
        for (u = o; !u.nextSibling && u != t.$el.get(0);) u = u.parentNode;
        if (u == t.$el.get(0)) return !1;
        if (u = u.nextSibling, t.node.isBlock(u)) n.FE.NO_DELETE_TAGS.indexOf(u.tagName) < 0 && (n(r).replaceWith(n.FE.MARKERS), f = t.node.contents(o), f.length && "BR" == f[f.length - 1].tagName && n(f[f.length - 1]).remove(), n(o).append(n(u).html()), n(u).remove());
        else
          for (f = t.node.contents(o), f.length && "BR" == f[f.length - 1].tagName && n(f[f.length - 1]).remove(), n(r).replaceWith(n.FE.MARKERS); u && !t.node.isBlock(u) && "BR" != u.tagName;) n(o).append(n(u)), u = u.nextSibling
      }
    }
    return {
      _startEnter: u,
      _middleEnter: f,
      _endEnter: e,
      _backspace: o,
      _del: s
    }
  };
  n.FE.NO_DELETE_TAGS = ["TH", "TD", "TABLE", "FORM"];
  n.FE.SIMPLE_ENTER_TAGS = ["TH", "TD", "LI", "DL", "DT", "FORM"];
  n.FE.MODULES.cursor = function(t) {
    function u(n) {
      return n ? t.node.isBlock(n) ? !0 : n.nextSibling ? !1 : u(n.parentNode) : !1
    }

    function f(n) {
      return n ? t.node.isBlock(n) ? !0 : n.previousSibling ? !1 : f(n.parentNode) : !1
    }

    function e(n, i) {
      return n ? n == t.$wp.get(0) ? !1 : n.previousSibling ? !1 : n.parentNode == i ? !0 : e(n.parentNode, i) : !1
    }

    function i(n, r) {
      return n ? n == t.$wp.get(0) ? !1 : n.nextSibling ? !1 : n.parentNode == r ? !0 : i(n.parentNode, r) : !1
    }

    function r(i) {
      return n(i).parentsUntil(t.$el, "LI").length > 0 && 0 === n(i).parentsUntil("LI", "TABLE").length
    }

    function l(i) {
      var o = n(i).parentsUntil(t.$el, "BLOCKQUOTE").length > 0,
        u = t.node.deepestParent(i, [], !o),
        e, f, r;
      if (u && "BLOCKQUOTE" == u.tagName && (e = t.node.deepestParent(i, [n(i).parentsUntil(t.$el, "BLOCKQUOTE").get(0)]), e && e.previousSibling && (u = e)), null !== u && (r = u.previousSibling, t.node.isBlock(u) && t.node.isEditable(u) && r && n.FE.NO_DELETE_TAGS.indexOf(r.tagName) < 0))
        if (t.node.isDeletable(r)) n(r).remove(), n(i).replaceWith(n.FE.MARKERS);
        else if (t.node.isEditable(r))
        if (t.node.isBlock(r))
          if (t.node.isEmpty(r) && !t.node.isList(r)) n(r).remove();
          else {
            if (t.node.isList(r) && (r = n(r).find("li:last").get(0)), f = t.node.contents(r), f.length && "BR" == f[f.length - 1].tagName && n(f[f.length - 1]).remove(), "BLOCKQUOTE" == r.tagName && "BLOCKQUOTE" != u.tagName)
              for (f = t.node.contents(r); f.length && t.node.isBlock(f[f.length - 1]);) r = f[f.length - 1], f = t.node.contents(r);
            else if ("BLOCKQUOTE" != r.tagName && "BLOCKQUOTE" == u.tagName)
              for (f = t.node.contents(u); f.length && t.node.isBlock(f[0]);) u = f[0], f = t.node.contents(u);
            n(i).replaceWith(n.FE.MARKERS);
            n(r).append(t.node.isEmpty(u) ? n.FE.MARKERS : u.innerHTML);
            n(u).remove()
          }
      else n(i).replaceWith(n.FE.MARKERS), "BLOCKQUOTE" == u.tagName && r.nodeType == Node.ELEMENT_NODE ? n(r).remove() : (n(r).after(t.node.isEmpty(u) ? "" : n(u).html()), n(u).remove(), "BR" == r.tagName && n(r).remove())
    }

    function h(i) {
      for (var u, e, o, s, f, h, r = i; !r.previousSibling;)
        if (r = r.parentNode, t.node.isElement(r)) return !1;
      if (r = r.previousSibling, !t.node.isBlock(r) && t.node.isEditable(r)) {
        for (u = t.node.contents(r); r.nodeType != Node.TEXT_NODE && !t.node.isDeletable(r) && u.length && t.node.isEditable(r);) r = u[u.length - 1], u = t.node.contents(r);
        if (r.nodeType == Node.TEXT_NODE) {
          if (t.helpers.isIOS()) return !0;
          e = r.textContent;
          o = e.length - 1;
          t.opts.tabSpaces && e.length >= t.opts.tabSpaces && (s = e.substr(e.length - t.opts.tabSpaces, e.length - 1), 0 == s.replace(/ /g, "").replace(new RegExp(n.FE.UNICODE_NBSP, "g"), "").length && (o = e.length - t.opts.tabSpaces));
          r.textContent = e.substring(0, o);
          r.textContent.length && 55357 == r.textContent.charCodeAt(r.textContent.length - 1) && (r.textContent = r.textContent.substr(0, r.textContent.length - 1));
          0 == r.textContent.length ? 2 != r.parentNode.childNodes.length || r.parentNode != i.parentNode || t.node.isBlock(r.parentNode) || t.node.isElement(r.parentNode) ? (n(r).after(n.FE.MARKERS), r.parentNode.removeChild(r)) : (n(r.parentNode).after(n.FE.MARKERS), n(r.parentNode).remove()) : n(r).after(n.FE.MARKERS)
        } else t.node.isDeletable(r) ? (n(r).after(n.FE.MARKERS), n(r).remove()) : t.events.trigger("node.remove", [n(r)]) !== !1 && (n(r).after(n.FE.MARKERS), n(r).remove())
      } else if (n.FE.NO_DELETE_TAGS.indexOf(r.tagName) < 0 && t.node.isEditable(r))
        if (t.node.isEmpty(r) && !t.node.isList(r)) n(r).remove(), n(i).replaceWith(n.FE.MARKERS);
        else {
          for (t.node.isList(r) && (r = n(r).find("li:last").get(0)), u = t.node.contents(r), u && "BR" == u[u.length - 1].tagName && n(u[u.length - 1]).remove(), u = t.node.contents(r); u && t.node.isBlock(u[u.length - 1]);) r = u[u.length - 1], u = t.node.contents(r);
          for (n(r).append(n.FE.MARKERS), f = i; !f.previousSibling;) f = f.parentNode;
          for (; f && "BR" !== f.tagName && !t.node.isBlock(f);) h = f, f = f.nextSibling, n(r).append(h);
          f && "BR" == f.tagName && n(f).remove();
          n(i).remove()
        }
      else i.nextSibling && "BR" == i.nextSibling.tagName && n(i.nextSibling).remove()
    }

    function a() {
      var c = !1,
        i = t.markers.insert(),
        o, s;
      return i ? (t.$el.get(0).normalize(), o = i.previousSibling, o && (s = o.textContent, s && s.length && 8203 == s.charCodeAt(s.length - 1) && (1 == s.length ? n(o).remove() : (o.textContent = o.textContent.substr(0, s.length - 1), o.textContent.length && 55357 == o.textContent.charCodeAt(o.textContent.length - 1) && (o.textContent = o.textContent.substr(0, o.textContent.length - 1))))), u(i) ? c = h(i) : f(i) ? r(i) && e(i, n(i).parents("li:first").get(0)) ? t.cursorLists._backspace(i) : l(i) : c = h(i), n(i).remove(), t.$el.find("blockquote:empty").remove(), t.html.fillEmptyBlocks(), t.html.cleanEmptyTags(), t.clean.quotes(), t.clean.lists(), t.spaces.normalize(), t.selection.restore(), c) : !0
    }

    function c(i) {
      var h = n(i).parentsUntil(t.$el, "BLOCKQUOTE").length > 0,
        f = t.node.deepestParent(i, [], !h),
        o, u, r, e, s;
      if (f && "BLOCKQUOTE" == f.tagName && (o = t.node.deepestParent(i, [n(i).parentsUntil(t.$el, "BLOCKQUOTE").get(0)]), o && o.nextSibling && (f = o)), null !== f && (r = f.nextSibling, t.node.isBlock(f) && (t.node.isEditable(f) || t.node.isDeletable(f)) && r && n.FE.NO_DELETE_TAGS.indexOf(r.tagName) < 0))
        if (t.node.isDeletable(r)) n(r).remove(), n(i).replaceWith(n.FE.MARKERS);
        else if (t.node.isBlock(r) && t.node.isEditable(r))
        if (t.node.isList(r)) t.node.isEmpty(f, !0) ? (n(f).remove(), n(r).find("li:first").prepend(n.FE.MARKERS)) : (e = n(r).find("li:first"), "BLOCKQUOTE" == f.tagName && (u = t.node.contents(f), u.length && t.node.isBlock(u[u.length - 1]) && (f = u[u.length - 1])), 0 === e.find("ul, ol").length && (n(i).replaceWith(n.FE.MARKERS), e.find(t.html.blockTagsQuery()).not("ol, ul, table").each(function() {
          this.parentNode == e.get(0) && n(this).replaceWith(n(this).html() + (t.node.isEmpty(this) ? "" : "<br>"))
        }), n(f).append(t.node.contents(e.get(0))), e.remove(), 0 === n(r).find("li").length && n(r).remove()));
        else {
          if (u = t.node.contents(r), u.length && "BR" == u[0].tagName && n(u[0]).remove(), "BLOCKQUOTE" != r.tagName && "BLOCKQUOTE" == f.tagName)
            for (u = t.node.contents(f); u.length && t.node.isBlock(u[u.length - 1]);) f = u[u.length - 1], u = t.node.contents(f);
          else if ("BLOCKQUOTE" == r.tagName && "BLOCKQUOTE" != f.tagName)
            for (u = t.node.contents(r); u.length && t.node.isBlock(u[0]);) r = u[0], u = t.node.contents(r);
          n(i).replaceWith(n.FE.MARKERS);
          n(f).append(r.innerHTML);
          n(r).remove()
        }
      else {
        for (n(i).replaceWith(n.FE.MARKERS); r && "BR" !== r.tagName && !t.node.isBlock(r) && t.node.isEditable(r);) s = r, r = r.nextSibling, n(f).append(s);
        r && "BR" == r.tagName && t.node.isEditable(r) && n(r).remove()
      }
    }

    function v(i) {
      for (var s, e, o, h, f = i; !f.nextSibling;)
        if (f = f.parentNode, t.node.isElement(f)) return !1;
      if (f = f.nextSibling, "BR" == f.tagName && t.node.isEditable(f))
        if (f.nextSibling) {
          if (t.node.isBlock(f.nextSibling) && t.node.isEditable(f.nextSibling)) {
            if (!(n.FE.NO_DELETE_TAGS.indexOf(f.nextSibling.tagName) < 0)) return void n(f).remove();
            f = f.nextSibling;
            n(f.previousSibling).remove()
          }
        } else if (u(f)) {
        r(i) ? t.cursorLists._del(i) : (s = t.node.deepestParent(f), s && (n(f).remove(), c(i)));
        return
      }
      if (!t.node.isBlock(f) && t.node.isEditable(f)) {
        for (e = t.node.contents(f); f.nodeType != Node.TEXT_NODE && e.length && !t.node.isDeletable(f) && t.node.isEditable(f);) f = e[0], e = t.node.contents(f);
        f.nodeType == Node.TEXT_NODE ? (n(f).before(n.FE.MARKERS), f.textContent = f.textContent.length && 55357 == f.textContent.charCodeAt(0) ? f.textContent.substring(2, f.textContent.length) : f.textContent.substring(1, f.textContent.length)) : t.node.isDeletable(f) ? (n(f).before(n.FE.MARKERS), n(f).remove()) : t.events.trigger("node.remove", [n(f)]) !== !1 && (n(f).before(n.FE.MARKERS), n(f).remove());
        n(i).remove()
      } else if (n.FE.NO_DELETE_TAGS.indexOf(f.tagName) < 0 && (t.node.isEditable(f) || t.node.isDeletable(f)))
        if (t.node.isDeletable(f)) n(i).replaceWith(n.FE.MARKERS), n(f).remove();
        else if (t.node.isList(f)) i.previousSibling ? (n(f).find("li:first").prepend(i), t.cursorLists._backspace(i)) : (n(f).find("li:first").prepend(n.FE.MARKERS), n(i).remove());
      else if (e = t.node.contents(f), e && "BR" == e[0].tagName && n(e[0]).remove(), e && "BLOCKQUOTE" == f.tagName) {
        for (o = e[0], n(i).before(n.FE.MARKERS); o && "BR" != o.tagName;) h = o, o = o.nextSibling, n(i).before(h);
        o && "BR" == o.tagName && n(o).remove()
      } else n(i).after(n(f).html()).after(n.FE.MARKERS), n(f).remove()
    }

    function y() {
      var i = t.markers.insert(),
        e;
      if (!i) return !1;
      (t.$el.get(0).normalize(), u(i)) ? r(i) ? 0 === n(i).parents("li:first").find("ul, ol").length ? t.cursorLists._del(i) : (e = n(i).parents("li:first").find("ul:first, ol:first").find("li:first"), e = e.find(t.html.blockTagsQuery()).get(-1) || e, e.prepend(i), t.cursorLists._backspace(i)) : c(i): v(f(i) ? i : i);
      n(i).remove();
      t.$el.find("blockquote:empty").remove();
      t.html.fillEmptyBlocks();
      t.html.cleanEmptyTags();
      t.clean.quotes();
      t.clean.lists();
      t.spaces.normalize();
      t.selection.restore()
    }

    function p() {
      t.$el.find(".fr-to-remove").each(function() {
        for (var r = t.node.contents(this), i = 0; i < r.length; i++) r[i].nodeType == Node.TEXT_NODE && (r[i].textContent = r[i].textContent.replace(/\u200B/g, ""));
        n(this).replaceWith(this.innerHTML)
      })
    }

    function o(r, u, f) {
      var h, e = t.node.deepestParent(r, [], !f),
        o, l, y, c, a, p, w, v;
      if (e && "BLOCKQUOTE" == e.tagName) return i(r, e) ? (h = t.html.defaultTag(), h ? n(e).after("<" + h + ">" + n.FE.MARKERS + "<br><\/" + h + ">") : n(e).after(n.FE.MARKERS + "<br>"), n(r).remove(), !1) : (s(r, u, f), !1);
      if (null == e) n(r).replaceWith("<br/>" + n.FE.MARKERS + "<br/>");
      else {
        o = r;
        l = "";
        (!t.node.isBlock(e) || u) && (l = "<br/>");
        y = "";
        c = "";
        h = t.html.defaultTag();
        a = "";
        p = "";
        h && t.node.isBlock(e) && (a = "<" + h + ">", p = "<\/" + h + ">", e.tagName == h.toUpperCase() && (a = t.node.openTagString(n(e).clone().removeAttr("id").get(0))));
        do(o = o.parentNode, u && o == e && (!u || t.node.isBlock(e))) || ((y += t.node.closeTagString(o), o == e && t.node.isBlock(e)) ? c = a + c : (w = "A" == o.tagName && i(r, o) ? "fr-to-remove" : "", c = t.node.openTagString(n(o).clone().addClass(w).get(0)) + c)); while (o != e);
        l = y + l + c + (r.parentNode == e && t.node.isBlock(e) ? "" : n.FE.INVISIBLE_SPACE) + n.FE.MARKERS;
        t.node.isBlock(e) && !n(e).find("*:last").is("br") && n(e).append("<br/>");
        n(r).after('<span id="fr-break"><\/span>');
        n(r).remove();
        e.nextSibling && !t.node.isBlock(e.nextSibling) || t.node.isBlock(e) || n(e).after("<br>");
        v = !u && t.node.isBlock(e) ? t.node.openTagString(e) + n(e).html() + p : t.node.openTagString(e) + n(e).html() + t.node.closeTagString(e);
        v = v.replace(/<span id="fr-break"><\/span>/g, l);
        n(e).replaceWith(v)
      }
    }

    function w(r, u, f) {
      var h = t.node.deepestParent(r, [], !f),
        c;
      if (h && "BLOCKQUOTE" == h.tagName) {
        if (e(r, h)) return c = t.html.defaultTag(), c ? n(h).before("<" + c + ">" + n.FE.MARKERS + "<br><\/" + c + ">") : n(h).before(n.FE.MARKERS + "<br>"), n(r).remove(), !1;
        i(r, h) ? o(r, u, !0) : s(r, u, !0)
      }
      if (null == h) n(r).replaceWith("<br>" + n.FE.MARKERS);
      else {
        if (t.node.isBlock(h))
          if (u) n(r).remove(), n(h).prepend("<br>" + n.FE.MARKERS);
          else {
            if (t.node.isEmpty(h, !0)) return o(r, u, f);
            n(h).before(t.node.openTagString(n(h).clone().removeAttr("id").get(0)) + "<br>" + t.node.closeTagString(h))
          }
        else n(h).before("<br>");
        n(r).remove()
      }
    }

    function s(r, u, f) {
      var o = t.node.deepestParent(r, [], !f),
        s, h, v, c, l, p, w, a, y;
      if (null == o) t.html.defaultTag() && r.parentNode === t.$el.get(0) ? n(r).replaceWith("<" + t.html.defaultTag() + ">" + n.FE.MARKERS + "<br><\/" + t.html.defaultTag() + ">") : ((!r.nextSibling || t.node.isBlock(r.nextSibling)) && n(r).after("<br>"), n(r).replaceWith("<br>" + n.FE.MARKERS));
      else {
        s = r;
        h = "";
        "PRE" == o.tagName && (u = !0);
        (!t.node.isBlock(o) || u) && (h = "<br>");
        v = "";
        c = "";
        do l = s, (s = s.parentNode, "BLOCKQUOTE" == o.tagName && t.node.isEmpty(l) && !n(l).hasClass("fr-marker") && n(l).find(r).length > 0 && n(l).after(r), "BLOCKQUOTE" == o.tagName && (i(r, s) || e(r, s)) || u && s == o && (!u || t.node.isBlock(o))) || (v += t.node.closeTagString(s), p = "A" == s.tagName && i(r, s) ? "fr-to-remove" : "", c = t.node.openTagString(n(s).clone().addClass(p).removeAttr("id").get(0)) + c); while (s != o);
        w = o == r.parentNode && t.node.isBlock(o) || r.nextSibling;
        "BLOCKQUOTE" == o.tagName ? (r.previousSibling && t.node.isBlock(r.previousSibling) && r.nextSibling && "BR" == r.nextSibling.tagName && (n(r.nextSibling).after(r), r.nextSibling && "BR" == r.nextSibling.tagName && n(r.nextSibling).remove()), a = t.html.defaultTag(), h = v + h + (a ? "<" + a + ">" : "") + n.FE.MARKERS + "<br>" + (a ? "<\/" + a + ">" : "") + c) : h = v + h + c + (w ? "" : n.FE.INVISIBLE_SPACE) + n.FE.MARKERS;
        n(r).replaceWith('<span id="fr-break"><\/span>');
        y = t.node.openTagString(o) + n(o).html() + t.node.closeTagString(o);
        y = y.replace(/<span id="fr-break"><\/span>/g, h);
        n(o).replaceWith(y)
      }
    }

    function b(i) {
      var e = t.markers.insert(),
        h;
      if (!e) return !0;
      t.$el.get(0).normalize();
      h = !1;
      n(e).parentsUntil(t.$el, "BLOCKQUOTE").length > 0 && (i = !1, h = !0);
      n(e).parentsUntil(t.$el, "TD, TH").length && (h = !1);
      u(e) ? !r(e) || i || h ? o(e, i, h) : t.cursorLists._endEnter(e) : f(e) ? !r(e) || i || h ? w(e, i, h) : t.cursorLists._startEnter(e) : !r(e) || i || h ? s(e, i, h) : t.cursorLists._middleEnter(e);
      p();
      t.html.fillEmptyBlocks();
      t.html.cleanEmptyTags();
      t.clean.lists();
      t.spaces.normalize();
      t.selection.restore()
    }
    return {
      enter: b,
      backspace: a,
      del: y,
      isAtEnd: i
    }
  };
  n.FE.MODULES.data = function(n) {
    function r(n) {
      return n
    }

    function s(n) {
      if (!n) return n;
      for (var f = "", o = r("charCodeAt"), s = r("fromCharCode"), e = v.indexOf(n[0]), t = 1; t < n.length - 2; t++) {
        for (var l = h(++e), i = n[o](t), u = "";
          /[0-9-]/.test(n[t + 1]);) u += n[++t];
        u = parseInt(u, 10) || 0;
        i = c(i, l, u);
        i ^= e - 1 & 31;
        f += String[s](i)
      }
      return f
    }

    function h(n) {
      for (var r = n.toString(), t = 0, i = 0; i < r.length; i++) t += parseInt(r.charAt(i), 10);
      return t > 10 ? t % 9 + 1 : t
    }

    function c(n, t, i) {
      for (var r = Math.abs(i); r-- > 0;) n -= t;
      return 0 > i && (n += 123), n
    }

    function f(n) {
      return n && "none" == n.css("display") ? (n.remove(), !0) : !1
    }

    function l() {
      return f(t) || f(o)
    }

    function e() {
      return n.$box ? (n.$box.append(i(r(i("kTDD4spmKD1klaMB1C7A5RA1G3RA10YA5qhrjuvnmE1D3FD2bcG-7noHE6B2JB4C3xXA8WF6F-10RG2C3G3B-21zZE3C3H3xCA16NC4DC1f1hOF1MB3B-21whzQH5UA2WB10kc1C2F4D3XC2YD4D1C4F3GF2eJ2lfcD-13HF1IE1TC11TC7WE4TA4d1A2YA6XA4d1A3yCG2qmB-13GF4A1B1KH1HD2fzfbeQC3TD9VE4wd1H2A20A2B-22ujB3nBG2A13jBC10D3C2HD5D1H1KB11uD-16uWF2D4A3F-7C9D-17c1E4D4B3d1D2CA6B2B-13qlwzJF2NC2C-13E-11ND1A3xqUA8UE6bsrrF-7C-22ia1D2CF2H1E2akCD2OE1HH1dlKA6PA5jcyfzB-22cXB4f1C3qvdiC4gjGG2H2gklC3D-16wJC1UG4dgaWE2D5G4g1I2H3B7vkqrxH1H2EC9C3E4gdgzKF1OA1A5PF5C4WWC3VA6XA4e1E3YA2YA5HE4oGH4F2H2IB10D3D2NC5G1B1qWA9PD6PG5fQA13A10XA4C4A3e1H2BA17kC-22cmOB1lmoA2fyhcptwWA3RA8A-13xB-11nf1I3f1B7GB3aD3pavFC10D5gLF2OG1LSB2D9E7fQC1F4F3wpSB5XD3NkklhhaE-11naKA9BnIA6D1F5bQA3A10c1QC6Kjkvitc2B6BE3AF3E2DA6A4JD2IC1jgA-64MB11D6C4==")))), t = n.$box.find("> div:last"), o = t.find("> a"), void("rtl" == n.opts.direction && t.css("left", "auto").css("right", 0))) : !1
    }

    function a() {
      var f = n.opts.key || [""],
        o, s;
      for ("string" == typeof f && (f = [f]), n.ul = !0, o = 0; o < f.length; o++)
        if (s = i(f[o]) || "", !(s !== i(r(i("mcVRDoB1BGILD7YFe1BTXBA7B6=="))) && s.indexOf(u, s.length - u.length) < 0 && [i("9qqG-7amjlwq=="), i("KA3B3C2A6D1D5H5H1A3==")].indexOf(u) < 0)) {
          n.ul = !1;
          break
        }
      n.ul === !0 && e();
      n.events.on("contentChanged", function() {
        n.ul === !0 && l() && e()
      });
      n.events.on("destroy", function() {
        t && t.length && t.remove()
      }, !0)
    }
    var t, o, v = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",
      u = function() {
        for (var i = 0, n = document.domain, r = n.split("."), t = "_gd" + (new Date).getTime(); i < r.length - 1 && -1 == document.cookie.indexOf(t + "=" + t);) n = r.slice(-1 - ++i).join("."), document.cookie = t + "=" + t + ";domain=" + n + ";";
        return document.cookie = t + "=;expires=Thu, 01 Jan 1970 00:00:01 GMT;domain=" + n + ";", n
      }(),
      i = r(s);
    return {
      _init: a
    }
  };
  n.FE.ENTER_P = 0;
  n.FE.ENTER_DIV = 1;
  n.FE.ENTER_BR = 2;
  n.FE.KEYCODE = {
    BACKSPACE: 8,
    TAB: 9,
    ENTER: 13,
    SHIFT: 16,
    CTRL: 17,
    ALT: 18,
    ESC: 27,
    SPACE: 32,
    DELETE: 46,
    ZERO: 48,
    ONE: 49,
    TWO: 50,
    THREE: 51,
    FOUR: 52,
    FIVE: 53,
    SIX: 54,
    SEVEN: 55,
    EIGHT: 56,
    NINE: 57,
    FF_SEMICOLON: 59,
    FF_EQUALS: 61,
    QUESTION_MARK: 63,
    A: 65,
    B: 66,
    C: 67,
    D: 68,
    E: 69,
    F: 70,
    G: 71,
    H: 72,
    I: 73,
    J: 74,
    K: 75,
    L: 76,
    M: 77,
    N: 78,
    O: 79,
    P: 80,
    Q: 81,
    R: 82,
    S: 83,
    T: 84,
    U: 85,
    V: 86,
    W: 87,
    X: 88,
    Y: 89,
    Z: 90,
    META: 91,
    NUM_ZERO: 96,
    NUM_ONE: 97,
    NUM_TWO: 98,
    NUM_THREE: 99,
    NUM_FOUR: 100,
    NUM_FIVE: 101,
    NUM_SIX: 102,
    NUM_SEVEN: 103,
    NUM_EIGHT: 104,
    NUM_NINE: 105,
    NUM_MULTIPLY: 106,
    NUM_PLUS: 107,
    NUM_MINUS: 109,
    NUM_PERIOD: 110,
    NUM_DIVISION: 111,
    SEMICOLON: 186,
    DASH: 189,
    EQUALS: 187,
    COMMA: 188,
    PERIOD: 190,
    SLASH: 191,
    APOSTROPHE: 192,
    TILDE: 192,
    SINGLE_QUOTE: 222,
    OPEN_SQUARE_BRACKET: 219,
    BACKSLASH: 220,
    CLOSE_SQUARE_BRACKET: 221
  };
  n.extend(n.FE.DEFAULTS, {
    enter: n.FE.ENTER_P,
    multiLine: !0,
    tabSpaces: 0
  });
  n.FE.MODULES.keys = function(t) {
    function c() {
      var i, r, u;
      t.helpers.isIOS() && (i = navigator.userAgent.match("CriOS"), r = /(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent), i || r || (u = n(t.o_win).scrollTop(), t.events.disableBlur(), t.selection.save(), t.$el.blur(), t.selection.restore(), t.events.enableBlur(), n(t.o_win).scrollTop(u)))
    }

    function l(n) {
      n.preventDefault();
      n.stopPropagation();
      t.opts.multiLine && (t.selection.isCollapsed() || t.selection.remove(), t.cursor.enter());
      c()
    }

    function a(n) {
      n.preventDefault();
      n.stopPropagation();
      t.opts.multiLine && (t.selection.isCollapsed() || t.selection.remove(), t.cursor.enter(!0))
    }

    function v(n) {
      t.selection.isCollapsed() ? t.cursor.backspace() || (n.preventDefault(), n.stopPropagation(), o = !1) : (n.preventDefault(), n.stopPropagation(), t.selection.remove(), t.html.fillEmptyBlocks(), o = !1);
      t.placeholder.refresh()
    }

    function y(n) {
      n.preventDefault();
      n.stopPropagation();
      "" === t.selection.text() ? t.cursor.del() : t.selection.remove();
      t.placeholder.refresh()
    }

    function p(i) {
      if (t.browser.mozilla) {
        i.preventDefault();
        i.stopPropagation();
        t.selection.isCollapsed() || t.selection.remove();
        t.markers.insert();
        var r = t.$el.find(".fr-marker").get(0),
          u = r.previousSibling,
          f = r.nextSibling;
        !f && r.parentNode && "A" == r.parentNode.tagName ? (n(r).parent().after("&nbsp;" + n.FE.MARKERS), n(r).remove()) : (u && u.nodeType == Node.TEXT_NODE && 1 == u.textContent.length && 160 == u.textContent.charCodeAt(0) ? n(u).after(" ") : n(r).before("&nbsp;"), n(r).replaceWith(n.FE.MARKERS));
        t.selection.restore()
      }
    }

    function w() {
      if (t.browser.mozilla && t.selection.isCollapsed() && !i) {
        var u = t.selection.ranges(0),
          n = u.startContainer,
          r = u.startOffset;
        n && n.nodeType == Node.TEXT_NODE && r <= n.textContent.length && r > 0 && 32 == n.textContent.charCodeAt(r - 1) && (t.selection.save(), t.spaces.normalize(), t.selection.restore())
      }
    }

    function b() {
      t.selection.isFull() && setTimeout(function() {
        var i = t.html.defaultTag();
        i ? t.$el.html("<" + i + ">" + n.FE.MARKERS + "<br/><\/" + i + ">") : t.$el.html(n.FE.MARKERS + "<br/>");
        t.selection.restore();
        t.placeholder.refresh();
        t.button.bulkRefresh();
        t.undo.saveStep()
      }, 0)
    }

    function k(n) {
      if (t.opts.tabSpaces > 0)
        if (t.selection.isCollapsed()) {
          n.preventDefault();
          n.stopPropagation();
          for (var i = "", r = 0; r < t.opts.tabSpaces; r++) i += "&nbsp;";
          t.html.insert(i);
          t.placeholder.refresh()
        } else n.preventDefault(), n.stopPropagation(), n.shiftKey ? t.commands.outdent() : t.commands.indent()
    }

    function d() {
      i = !1
    }

    function g() {
      return i
    }

    function nt(u) {
      var e, c, h, s;
      if (t.events.disableBlur(), o = !0, e = u.which, 16 === e) return !0;
      if (229 === e) return i = !0, !0;
      if (i = !1, c = f(e) && !r(u), h = e == n.FE.KEYCODE.BACKSPACE || e == n.FE.KEYCODE.DELETE, (t.selection.isFull() && !t.opts.keepFormatOnDelete && !t.placeholder.isVisible() || h && t.placeholder.isVisible() && t.opts.keepFormatOnDelete) && (c || h) && (s = t.html.defaultTag(), s ? t.$el.html("<" + s + ">" + n.FE.MARKERS + "<br/><\/" + s + ">") : t.$el.html(n.FE.MARKERS + "<br/>"), t.selection.restore(), !f(e))) return u.preventDefault(), !0;
      e == n.FE.KEYCODE.ENTER ? u.shiftKey ? a(u) : l(u) : e != n.FE.KEYCODE.BACKSPACE || r(u) || u.altKey || t.placeholder.isVisible() ? e != n.FE.KEYCODE.DELETE || r(u) || u.altKey || t.placeholder.isVisible() ? e == n.FE.KEYCODE.SPACE ? p(u) : e == n.FE.KEYCODE.TAB ? k(u) : r(u) || !f(u.which) || t.selection.isCollapsed() || t.selection.remove() : y(u) : v(u);
      t.events.enableBlur()
    }

    function h(i) {
      for (var r = 0; r < i.length; r++) i[r].nodeType == Node.TEXT_NODE && /\u200B/gi.test(i[r].textContent) ? (i[r].textContent = i[r].textContent.replace(/\u200B/gi, ""), 0 === i[r].textContent.length && n(i[r]).remove()) : i[r].nodeType == Node.ELEMENT_NODE && "IFRAME" != i[r].nodeType && h(t.node.contents(i[r]))
    }

    function tt() {
      if (!t.$wp) return !0;
      var i;
      t.opts.height || t.opts.heightMax ? (i = t.position.getBoundingRect().top, t.helpers.isIOS() && (i -= n(t.o_win).scrollTop()), t.opts.iframe && (i += t.$iframe.offset().top), i > t.$wp.offset().top - n(t.o_win).scrollTop() + t.$wp.height() - 20 && t.$wp.scrollTop(i + t.$wp.scrollTop() - (t.$wp.height() + t.$wp.offset().top) + n(t.o_win).scrollTop() + 20)) : (i = t.position.getBoundingRect().top, t.opts.toolbarBottom && (i += t.opts.toolbarStickyOffset), t.helpers.isIOS() && (i -= n(t.o_win).scrollTop()), t.opts.iframe && (i += t.$iframe.offset().top), i += t.opts.toolbarStickyOffset, i > t.o_win.innerHeight - 20 && n(t.o_win).scrollTop(i + n(t.o_win).scrollTop() - t.o_win.innerHeight + 20), i = t.position.getBoundingRect().top, t.opts.toolbarBottom || (i -= t.opts.toolbarStickyOffset), t.helpers.isIOS() && (i -= n(t.o_win).scrollTop()), t.opts.iframe && (i += t.$iframe.offset().top), i < t.$tb.height() + 20 && n(t.o_win).scrollTop(i + n(t.o_win).scrollTop() - t.$tb.height() - 20))
    }

    function s(r) {
      var s, l, c, f, u;
      if (i) return !1;
      if (!t.selection.isCollapsed() || r && (r.which === n.FE.KEYCODE.META || r.which == n.FE.KEYCODE.CTRL)) return !0;
      for (r && (r.which == n.FE.KEYCODE.ENTER || r.which == n.FE.KEYCODE.BACKSPACE || r.which >= 37 && r.which <= 40 && !t.browser.msie) && (r.which == n.FE.KEYCODE.BACKSPACE && o || tt()), f = t.$el.find(t.html.blockTagsQuery()), f.push(t.$el.get(0)), s = [], u = 0; u < f.length; u++)
        if (["TD", "TH"].indexOf(f[u].tagName) < 0)
          for (l = f[u].children, c = 0; c < l.length; c++) "BR" == l[c].tagName && s.push(l[c]);
      for (f = [], u = 0; u < s.length; u++) {
        var a = s[u],
          v = a.previousSibling,
          p = a.nextSibling,
          y = t.node.blockParent(a) || t.$el.get(0);
        v && y && "BR" != v.tagName && !t.node.isBlock(v) && !p && n(y).text().replace(/\u200B/g, "").length > 0 && n(v).text().length > 0 && (t.$el.is(y) && !p && t.opts.enter == n.FE.ENTER_BR && t.browser.msie || (t.selection.save(), n(a).remove(), t.selection.restore()))
      }
      s = [];
      var w = function(t) {
          if (!t) return !1;
          var i = n(t).html();
          return i = i.replace(/<span[^>]*? class\s*=\s*["']?fr-marker["']?[^>]+>\u200b<\/span>/gi, ""), i && /\u200B/.test(i) && i.replace(/\u200B/gi, "").length > 0 ? !0 : !1
        },
        b = function(n) {
          return !t.helpers.isIOS() || 0 === ((n.textContent || "").match(/[\u3041-\u3096\u30A0-\u30FF\u4E00-\u9FFF\u3130-\u318F\uAC00-\uD7AF]/gi) || []).length
        },
        e = t.selection.element();
      w(e) && 0 === n(e).find("li").length && !n(e).hasClass("fr-marker") && "IFRAME" != e.tagName && b(e) && (t.selection.save(), h(t.node.contents(e)), t.selection.restore());
      !t.browser.mozilla && t.html.doNormalize() && (t.selection.save(), t.spaces.normalize(), t.selection.restore())
    }

    function r(n) {
      if (-1 != navigator.userAgent.indexOf("Mac OS X")) {
        if (n.metaKey && !n.altKey) return !0
      } else if (n.ctrlKey && !n.altKey) return !0;
      return !1
    }

    function f(i) {
      if (i >= n.FE.KEYCODE.ZERO && i <= n.FE.KEYCODE.NINE || i >= n.FE.KEYCODE.NUM_ZERO && i <= n.FE.KEYCODE.NUM_MULTIPLY || i >= n.FE.KEYCODE.A && i <= n.FE.KEYCODE.Z || t.browser.webkit && 0 === i) return !0;
      switch (i) {
        case n.FE.KEYCODE.SPACE:
        case n.FE.KEYCODE.QUESTION_MARK:
        case n.FE.KEYCODE.NUM_PLUS:
        case n.FE.KEYCODE.NUM_MINUS:
        case n.FE.KEYCODE.NUM_PERIOD:
        case n.FE.KEYCODE.NUM_DIVISION:
        case n.FE.KEYCODE.SEMICOLON:
        case n.FE.KEYCODE.FF_SEMICOLON:
        case n.FE.KEYCODE.DASH:
        case n.FE.KEYCODE.EQUALS:
        case n.FE.KEYCODE.FF_EQUALS:
        case n.FE.KEYCODE.COMMA:
        case n.FE.KEYCODE.PERIOD:
        case n.FE.KEYCODE.SLASH:
        case n.FE.KEYCODE.APOSTROPHE:
        case n.FE.KEYCODE.SINGLE_QUOTE:
        case n.FE.KEYCODE.OPEN_SQUARE_BRACKET:
        case n.FE.KEYCODE.BACKSLASH:
        case n.FE.KEYCODE.CLOSE_SQUARE_BRACKET:
          return !0;
        default:
          return !1
      }
    }

    function it(i) {
      var o = i.which;
      return r(i) || o >= 37 && 40 >= o || !f(o) && o != n.FE.KEYCODE.DELETE && o != n.FE.KEYCODE.BACKSPACE && o != n.FE.KEYCODE.ENTER ? !0 : (u || (e = t.snapshot.get()), clearTimeout(u), void(u = setTimeout(function() {
        u = null;
        t.undo.saveStep()
      }, Math.max(250, t.opts.typingTimer))))
    }

    function rt(n) {
      return r(n) ? !0 : void(e && u && (t.undo.saveStep(e), e = null))
    }

    function ut() {
      u && (clearTimeout(u), t.undo.saveStep(), e = null)
    }

    function ft() {
      if (t.events.on("keydown", it), t.events.on("input", w), t.events.on("keyup", rt), t.events.on("keypress", d), t.events.on("keydown", nt), t.events.on("keyup", s), t.events.on("html.inserted", s), t.events.on("cut", b), t.$el.get(0).msGetInputContext) try {
        t.$el.get(0).msGetInputContext().addEventListener("MSCandidateWindowShow", function() {
          i = !0
        });
        t.$el.get(0).msGetInputContext().addEventListener("MSCandidateWindowHide", function() {
          i = !1;
          s()
        })
      } catch (n) {}
    }
    var o, u, e, i = !1;
    return {
      _init: ft,
      ctrlKey: r,
      isCharacter: f,
      forceUndo: ut,
      isIME: g
    }
  };
  n.extend(n.FE.DEFAULTS, {
    pastePlain: !1,
    pasteDeniedTags: ["colgroup", "col"],
    pasteDeniedAttrs: ["class", "id", "style"],
    pasteAllowLocalImages: !1
  });
  n.FE.MODULES.paste = function(t) {
    function f(i) {
      n.FE.copied_html = t.html.getSelected();
      n.FE.copied_text = n("<div>").html(n.FE.copied_html).text();
      "cut" == i.type && (t.undo.saveStep(), setTimeout(function() {
        t.html.wrap();
        t.events.focus();
        t.undo.saveStep()
      }, 0))
    }

    function e(n) {
      var r, f, e;
      if (u || (n.originalEvent && (n = n.originalEvent), t.events.trigger("paste.before", [n]) === !1)) return !1;
      if (y = t.$win.scrollTop(), n && n.clipboardData && n.clipboardData.getData) {
        if (r = "", f = n.clipboardData.types, t.helpers.isArray(f))
          for (e = 0; e < f.length; e++) r += f[e] + ";";
        else r = f;
        if (i = "", /text\/html/.test(r) ? i = n.clipboardData.getData("text/html") : /text\/rtf/.test(r) && t.browser.safari ? i = n.clipboardData.getData("text/rtf") : /text\/plain/.test(r) && !this.browser.mozilla && (i = t.html.escapeEntities(n.clipboardData.getData("text/plain")).replace(/\n/g, "<br>")), "" !== i) return o(), n.preventDefault && (n.stopPropagation(), n.preventDefault()), !1;
        i = null
      }
      h()
    }

    function h() {
      t.selection.save();
      t.events.disableBlur();
      i = null;
      r ? r.html("") : (r = n('<div contenteditable="true" style="position: fixed; top: 0; left: -9999px; height: 100%; width: 0; word-break: break-all; overflow:hidden; z-index: 9999; line-height: 140%;" tabindex="-1"><\/div>'), t.$box.after(r), t.events.on("destroy", function() {
        r.remove()
      }));
      r.focus();
      t.win.setTimeout(o, 1)
    }

    function c(i) {
      var u, r, e, o, f;
      for (i = i.replace(/<p(.*?)class="?'?MsoListParagraph"?'? ([\s\S]*?)>([\s\S]*?)<\/p>/gi, "<ul><li>$3<\/li><\/ul>"), i = i.replace(/<p(.*?)class="?'?NumberedText"?'? ([\s\S]*?)>([\s\S]*?)<\/p>/gi, "<ol><li>$3<\/li><\/ol>"), i = i.replace(/<p(.*?)class="?'?MsoListParagraphCxSpFirst"?'?([\s\S]*?)(level\d)?([\s\S]*?)>([\s\S]*?)<\/p>/gi, "<ul><li$3>$5<\/li>"), i = i.replace(/<p(.*?)class="?'?NumberedTextCxSpFirst"?'?([\s\S]*?)(level\d)?([\s\S]*?)>([\s\S]*?)<\/p>/gi, "<ol><li$3>$5<\/li>"), i = i.replace(/<p(.*?)class="?'?MsoListParagraphCxSpMiddle"?'?([\s\S]*?)(level\d)?([\s\S]*?)>([\s\S]*?)<\/p>/gi, "<li$3>$5<\/li>"), i = i.replace(/<p(.*?)class="?'?NumberedTextCxSpMiddle"?'?([\s\S]*?)(level\d)?([\s\S]*?)>([\s\S]*?)<\/p>/gi, "<li$3>$5<\/li>"), i = i.replace(/<p(.*?)class="?'?MsoListBullet"?'?([\s\S]*?)(level\d)?([\s\S]*?)>([\s\S]*?)<\/p>/gi, "<li$3>$5<\/li>"), i = i.replace(/<p(.*?)class="?'?MsoListParagraphCxSpLast"?'?([\s\S]*?)(level\d)?([\s\S]*?)>([\s\S]*?)<\/p>/gi, "<li$3>$5<\/li><\/ul>"), i = i.replace(/<p(.*?)class="?'?NumberedTextCxSpLast"?'?([\s\S]*?)(level\d)?([\s\S]*?)>([\s\S]*?)<\/p>/gi, "<li$3>$5<\/li><\/ol>"), i = i.replace(/<span([^<]*?)style="?'?mso-list:Ignore"?'?([\s\S]*?)>([\s\S]*?)<span/gi, "<span><span"), i = i.replace(/<!--\[if \!supportLists\]-->([\s\S]*?)<!--\[endif\]-->/gi, ""), i = i.replace(/<!\[if \!supportLists\]>([\s\S]*?)<!\[endif\]>/gi, ""), i = i.replace(/(\n|\r| class=(")?Mso[a-zA-Z0-9]+(")?)/gi, " "), i = i.replace(/<!--[\s\S]*?-->/gi, ""), i = i.replace(/<(\/)*(meta|link|span|\\?xml:|st1:|o:|font)(.*?)>/gi, ""), u = ["style", "script", "applet", "embed", "noframes", "noscript"], r = 0; r < u.length; r++) e = new RegExp("<" + u[r] + ".*?" + u[r] + "(.*?)>", "gi"), i = i.replace(e, "");
      i = i.replace(/&nbsp;/gi, " ");
      i = i.replace(/<td([^>]*)><\/td>/g, "<td$1><br><\/td>");
      i = i.replace(/<th([^>]*)><\/th>/g, "<th$1><br><\/th>");
      do o = i, i = i.replace(/<[^\/>][^>]*><\/[^>]+>/gi, ""); while (i != o);
      return i = i.replace(/<lilevel([^1])([^>]*)>/gi, '<li data-indent="true"$2>'), i = i.replace(/<lilevel1([^>]*)>/gi, "<li$1>"), i = t.clean.html(i, t.opts.pasteDeniedTags, t.opts.pasteDeniedAttrs), i = i.replace(/<a>(.[^<]+)<\/a>/gi, "$1"), f = n("<div>").html(i), f.find("li[data-indent]").each(function(t, i) {
        var u = n(i),
          r;
        u.prev("li").length > 0 ? (r = u.prev("li").find("> ul, > ol"), 0 === r.length && (r = n("ul"), u.prev("li").append(r)), r.append(i)) : u.removeAttr("data-indent")
      }), t.html.cleanBlankSpaces(f.get(0)), i = f.html()
    }

    function l(i) {
      var r = n("<div>").html(i),
        u;
      return r.find("p, div, h1, h2, h3, h4, h5, h6, pre, blockquote").each(function(i, r) {
        n(r).replaceWith("<" + (t.html.defaultTag() || "DIV") + ">" + n(r).html() + "<\/" + (t.html.defaultTag() || "DIV") + ">")
      }), n(r.find("*").not("p, div, h1, h2, h3, h4, h5, h6, pre, blockquote, ul, ol, li, table, tbody, thead, tr, td, br, img").get().reverse()).each(function() {
        n(this).replaceWith(n(this).html())
      }), u = function(i) {
        for (var f = t.node.contents(i), r = 0; r < f.length; r++) 3 != f[r].nodeType && 1 != f[r].nodeType ? n(f[r]).remove() : u(f[r])
      }, u(r.get(0)), r.html()
    }

    function o() {
      var e, u, f;
      t.keys.forceUndo();
      e = t.snapshot.get();
      null === i && (i = r.html(), t.selection.restore(), t.events.enableBlur());
      u = t.events.chainTrigger("paste.beforeCleanup", i);
      ("string" == typeof u && (i = u), i.indexOf("<body") >= 0 && (i = i.replace(/[.\s\S\w\W<>]*<body[^>]*>([.\s\S\w\W<>]*)<\/body>[.\s\S\w\W<>]*/g, "$1")), i.indexOf('id="docs-internal-guid') >= 0 && (i = i.replace(/^.* id="docs-internal-guid[^>]*>(.*)<\/b>.*$/, "$1")), i.match(/(class=\"?Mso|style=\"[^\"]*\bmso\-|w:WordDocument)/gi) ? (i = i.replace(/^\n*/g, "").replace(/^ /g, ""), 0 === i.indexOf("<colgroup>") && (i = "<table>" + i + "<\/table>"), i = c(i), i = s(i)) : (t.opts.htmlAllowComments = !1, i = t.clean.html(i, t.opts.pasteDeniedTags, t.opts.pasteDeniedAttrs), t.opts.htmlAllowComments = !0, i = s(i), i = i.replace(/\r|\n|\t/g, ""), n.FE.copied_text && n("<div>").html(i).text().replace(/(\u00A0)/gi, " ").replace(/\r|\n/gi, "") == n.FE.copied_text.replace(/(\u00A0)/gi, " ").replace(/\r|\n/gi, "") && (i = n.FE.copied_html), i = i.replace(/^ */g, "").replace(/ *$/g, "")), t.opts.pastePlain && (i = l(i)), u = t.events.chainTrigger("paste.afterCleanup", i), "string" == typeof u && (i = u), "" !== i) && (f = n("<div>").html(i), t.spaces.normalize(f.get(0)), f.find("span").each(function() {
        0 == this.attributes.length && n(this).replaceWith(this.innerHTML)
      }), f.find("br").each(function() {
        this.previousSibling && t.node.isBlock(this.previousSibling) && n(this).remove()
      }), i = f.html(), t.html.insert(i, !0));
      a();
      t.undo.saveStep(e);
      t.undo.saveStep()
    }

    function a() {
      t.events.trigger("paste.after")
    }

    function s(i) {
      for (var u, r, e, s, h, f = n("<div>").html(i), o = f.find("*:empty:not(br, img, td, th)"); o.length;) {
        for (u = 0; u < o.length; u++) n(o[u]).remove();
        o = f.find("*:empty:not(br, img, td, th)")
      }
      for (r = f.find("> div:not([style]), td > div, th > div, li > div"); r.length && u++ < 100;) e = n(r[r.length - 1]), t.html.defaultTag() && "div" != t.html.defaultTag() ? e.replaceWith("<" + t.html.defaultTag() + ">" + e.html() + "<\/" + t.html.defaultTag() + ">") : e.find("*:last").is("br") ? e.replaceWith(e.html()) : e.replaceWith(e.html() + "<br>"), r = f.find("> div:not([style]), td > div, th > div, li > div");
      for (r = f.find("div:not([style])"); r.length;) {
        for (u = 0; u < r.length; u++) s = n(r[u]), h = s.html().replace(/\u0009/gi, "").trim(), s.replaceWith(h);
        r = f.find("div:not([style])")
      }
      return f.html()
    }

    function v() {
      t.events.on("copy", f);
      t.events.on("cut", f);
      t.events.on("paste", e);
      t.browser.msie && t.browser.version < 11 && (t.events.on("mouseup", function(n) {
        2 == n.button && (setTimeout(function() {
          u = !1
        }, 50), u = !0)
      }, !0), t.events.on("beforepaste", e))
    }
    var y, i, r, u = !1;
    return {
      _init: v
    }
  };
  n.extend(n.FE.DEFAULTS, {
    shortcutsEnabled: ["show", "bold", "italic", "underline", "strikeThrough", "indent", "outdent", "undo", "redo"],
    shortcutsHint: !0
  });
  n.FE.SHORTCUTS_MAP = {};
  n.FE.RegisterShortcut = function(t, i, r, u, f, e) {
    n.FE.SHORTCUTS_MAP[(f ? "^" : "") + (e ? "@" : "") + t] = {
      cmd: i,
      val: r,
      letter: u,
      shift: f,
      option: e
    };
    n.FE.DEFAULTS.shortcutsEnabled.push(i)
  };
  n.FE.RegisterShortcut(n.FE.KEYCODE.E, "show", null, "E", !1, !1);
  n.FE.RegisterShortcut(n.FE.KEYCODE.B, "bold", null, "B", !1, !1);
  n.FE.RegisterShortcut(n.FE.KEYCODE.I, "italic", null, "I", !1, !1);
  n.FE.RegisterShortcut(n.FE.KEYCODE.U, "underline", null, "U", !1, !1);
  n.FE.RegisterShortcut(n.FE.KEYCODE.S, "strikeThrough", null, "S", !1, !1);
  n.FE.RegisterShortcut(n.FE.KEYCODE.CLOSE_SQUARE_BRACKET, "indent", null, "]", !1, !1);
  n.FE.RegisterShortcut(n.FE.KEYCODE.OPEN_SQUARE_BRACKET, "outdent", null, "[", !1, !1);
  n.FE.RegisterShortcut(n.FE.KEYCODE.Z, "undo", null, "Z", !1, !1);
  n.FE.RegisterShortcut(n.FE.KEYCODE.Z, "redo", null, "Z", !0, !1);
  n.FE.MODULES.shortcuts = function(t) {
    function u(r) {
      var u, f;
      if (!t.opts.shortcutsHint) return null;
      if (!i) {
        i = {};
        for (u in n.FE.SHORTCUTS_MAP) n.FE.SHORTCUTS_MAP.hasOwnProperty(u) && t.opts.shortcutsEnabled.indexOf(n.FE.SHORTCUTS_MAP[u].cmd) >= 0 && (i[n.FE.SHORTCUTS_MAP[u].cmd + "." + (n.FE.SHORTCUTS_MAP[u].val || "")] = {
          shift: n.FE.SHORTCUTS_MAP[u].shift,
          option: n.FE.SHORTCUTS_MAP[u].option,
          letter: n.FE.SHORTCUTS_MAP[u].letter
        })
      }
      return f = i[r], f ? (t.helpers.isMac() ? String.fromCharCode(8984) : "Ctrl+") + (f.shift ? t.helpers.isMac() ? String.fromCharCode(8679) : "Shift+" : "") + (f.option ? t.helpers.isMac() ? String.fromCharCode(8997) : "Alt+" : "") + f.letter : null
    }

    function r(i) {
      var r, u, f;
      if (!t.core.hasFocus()) return !0;
      var o = i.which,
        s = -1 != navigator.userAgent.indexOf("Mac OS X") ? i.metaKey : i.ctrlKey,
        e = (i.shiftKey ? "^" : "") + (i.altKey ? "@" : "") + o;
      if (s && n.FE.SHORTCUTS_MAP[e] && (r = n.FE.SHORTCUTS_MAP[e].cmd, r && t.opts.shortcutsEnabled.indexOf(r) >= 0)) {
        if (f = n.FE.SHORTCUTS_MAP[e].val, r && !f ? u = t.$tb.find('.fr-command[data-cmd="' + r + '"]') : r && f && (u = t.$tb.find('.fr-command[data-cmd="' + r + '"][data-param1="' + f + '"]')), u.length) return i.preventDefault(), i.stopPropagation(), u.parents(".fr-toolbar").data("instance", t), "keydown" == i.type && t.button.exec(u), !1;
        if (r && t.commands[r]) return i.preventDefault(), i.stopPropagation(), "keydown" == i.type && t.commands[r](), !1
      }
    }

    function f() {
      t.events.on("keydown", r, !0);
      t.events.on("keyup", r, !0)
    }
    var i = null;
    return {
      _init: f,
      get: u
    }
  };
  n.FE.MODULES.snapshot = function(n) {
    function u(n) {
      for (var f, e, i = n.parentNode.childNodes, u = 0, r = null, t = 0; t < i.length; t++) {
        if (r && (f = i[t].nodeType === Node.TEXT_NODE && "" === i[t].textContent, e = r.nodeType === Node.TEXT_NODE && i[t].nodeType === Node.TEXT_NODE, f || e || u++), i[t] == n) return u;
        r = i[t]
      }
    }

    function t(t) {
      var i = [];
      if (!t.parentNode) return [];
      for (; !n.node.isElement(t);) i.push(u(t)), t = t.parentNode;
      return i.reverse()
    }

    function i(n, t) {
      for (; n && n.nodeType === Node.TEXT_NODE;) {
        var i = n.previousSibling;
        i && i.nodeType == Node.TEXT_NODE && (t += i.textContent.length);
        n = i
      }
      return t
    }

    function f(n) {
      return {
        scLoc: t(n.startContainer),
        scOffset: i(n.startContainer, n.startOffset),
        ecLoc: t(n.endContainer),
        ecOffset: i(n.endContainer, n.endOffset)
      }
    }

    function e() {
      var t = {},
        r, i;
      if (n.events.trigger("snapshot.before"), t.html = n.$wp ? n.$el.html() : n.$oel.get(0).outerHTML, t.ranges = [], n.$wp && n.selection.inEditor() && n.core.hasFocus())
        for (r = n.selection.ranges(), i = 0; i < r.length; i++) t.ranges.push(f(r[i]));
      return n.events.trigger("snapshot.after"), t
    }

    function r(t) {
      for (var i = n.$el.get(0), r = 0; r < t.length; r++) i = i.childNodes[t[r]];
      return i
    }

    function o(t, i) {
      try {
        var f = r(i.scLoc),
          e = i.scOffset,
          o = r(i.ecLoc),
          s = i.ecOffset,
          u = n.doc.createRange();
        u.setStart(f, e);
        u.setEnd(o, s);
        t.addRange(u)
      } catch (h) {}
    }

    function s(t) {
      var r, i;
      for (n.$el.html() != t.html && n.$el.html(t.html), r = n.selection.get(), n.selection.clear(), n.events.focus(!0), i = 0; i < t.ranges.length; i++) o(r, t.ranges[i])
    }

    function h(t, i) {
      return t.html != i.html ? !1 : n.core.hasFocus() && JSON.stringify(t.ranges) != JSON.stringify(i.ranges) ? !1 : !0
    }
    return {
      get: e,
      restore: s,
      equal: h
    }
  };
  n.FE.MODULES.undo = function(n) {
    function u(t) {
      var i = t.which,
        r = n.keys.ctrlKey(t);
      r && (90 == i && t.shiftKey && t.preventDefault(), 90 == i && t.preventDefault())
    }

    function f() {
      return 0 === n.undo_stack.length || n.undo_index <= 1 ? !1 : !0
    }

    function e() {
      return n.undo_index == n.undo_stack.length ? !1 : !0
    }

    function o(r) {
      return !n.undo_stack || n.undoing || n.$el.get(0).querySelectorAll(".fr-marker").length ? !1 : void("undefined" == typeof r ? (r = n.snapshot.get(), n.undo_stack[n.undo_index - 1] && n.snapshot.equal(n.undo_stack[n.undo_index - 1], r) || (t(), n.undo_stack.push(r), n.undo_index++, r.html != i && (n.events.trigger("contentChanged"), i = r.html))) : (t(), n.undo_index > 0 ? n.undo_stack[n.undo_index - 1] = r : (n.undo_stack.push(r), n.undo_index++)))
    }

    function t() {
      if (!n.undo_stack || n.undoing) return !1;
      for (; n.undo_stack.length > n.undo_index;) n.undo_stack.pop()
    }

    function s() {
      if (n.undo_index > 1) {
        n.undoing = !0;
        var t = n.undo_stack[--n.undo_index - 1];
        clearTimeout(n._content_changed_timer);
        n.snapshot.restore(t);
        n.popups.hideAll();
        n.toolbar.enable();
        n.events.trigger("contentChanged");
        n.events.trigger("commands.undo");
        n.undoing = !1
      }
    }

    function h() {
      if (n.undo_index < n.undo_stack.length) {
        n.undoing = !0;
        var t = n.undo_stack[n.undo_index++];
        clearTimeout(n._content_changed_timer);
        n.snapshot.restore(t);
        n.popups.hideAll();
        n.toolbar.enable();
        n.events.trigger("contentChanged");
        n.events.trigger("commands.redo");
        n.undoing = !1
      }
    }

    function r() {
      n.undo_index = 0;
      n.undo_stack = []
    }

    function c() {
      n.undo_stack = []
    }

    function l() {
      r();
      n.events.on("initialized", function() {
        i = n.html.get(!1, !0)
      });
      n.events.on("blur", function() {
        n.undo.saveStep()
      });
      n.events.on("keydown", u);
      n.events.on("destroy", c)
    }
    var i = null;
    return {
      _init: l,
      run: s,
      redo: h,
      canDo: f,
      canRedo: e,
      dropRedo: t,
      reset: r,
      saveStep: o
    }
  };
  n.FE.ICON_DEFAULT_TEMPLATE = "font_awesome";
  n.FE.ICON_TEMPLATES = {
    font_awesome: '<i class="fa fa-[NAME]"><\/i>',
    text: '<span style="text-align: center;">[NAME]<\/span>',
    image: "<img src=[SRC] alt=[ALT] />"
  };
  n.FE.ICONS = {
    bold: {
      NAME: "bold"
    },
    italic: {
      NAME: "italic"
    },
    underline: {
      NAME: "underline"
    },
    strikeThrough: {
      NAME: "strikethrough"
    },
    subscript: {
      NAME: "subscript"
    },
    superscript: {
      NAME: "superscript"
    },
    color: {
      NAME: "tint"
    },
    outdent: {
      NAME: "outdent"
    },
    indent: {
      NAME: "indent"
    },
    undo: {
      NAME: "rotate-left"
    },
    redo: {
      NAME: "rotate-right"
    },
    insertHR: {
      NAME: "minus"
    },
    clearFormatting: {
      NAME: "eraser"
    },
    selectAll: {
      NAME: "mouse-pointer"
    }
  };
  n.FE.DefineIconTemplate = function(t, i) {
    n.FE.ICON_TEMPLATES[t] = i
  };
  n.FE.DefineIcon = function(t, i) {
    n.FE.ICONS[t] = i
  };
  n.FE.MODULES.icon = function() {
    function t(t) {
      var u = null,
        r = n.FE.ICONS[t],
        i;
      return "undefined" != typeof r && (i = r.template || n.FE.ICON_DEFAULT_TEMPLATE, i && (i = n.FE.ICON_TEMPLATES[i]) && (u = i.replace(/\[([a-zA-Z]*)\]/g, function(n, i) {
        return "NAME" == i ? r[i] || t : r[i]
      }))), u || t
    }
    return {
      create: t
    }
  };
  n.FE.MODULES.tooltip = function(t) {
    function i() {
      t.$tooltip && t.$tooltip.removeClass("fr-visible").css("left", "-3000px").css("position", "fixed")
    }

    function r(i, r) {
      var u, e;
      if (i.data("title") || i.data("title", i.attr("title")), !i.data("title")) return !1;
      t.$tooltip || f();
      i.removeAttr("title");
      t.$tooltip.text(i.data("title"));
      t.$tooltip.addClass("fr-visible");
      u = i.offset().left + (i.outerWidth() - t.$tooltip.outerWidth()) / 2;
      0 > u && (u = 0);
      u + t.$tooltip.outerWidth() > n(t.o_win).width() && (u = n(t.o_win).width() - t.$tooltip.outerWidth());
      "undefined" == typeof r && (r = t.opts.toolbarBottom);
      e = r ? i.offset().top - t.$tooltip.height() : i.offset().top + i.outerHeight();
      t.$tooltip.css("position", "");
      t.$tooltip.css("left", u);
      t.$tooltip.css("top", e)
    }

    function u(u, f, e) {
      t.helpers.isMobile() || (t.events.$on(u, "mouseenter", f, function(i) {
        n(i.currentTarget).hasClass("fr-disabled") || t.edit.isDisabled() || r(n(i.currentTarget), e)
      }, !0), t.events.$on(u, "mouseleave " + t._mousedown + " " + t._mouseup, f, function() {
        i()
      }, !0))
    }

    function f() {
      t.helpers.isMobile() || (t.shared.$tooltip ? t.$tooltip = t.shared.$tooltip : (t.shared.$tooltip = n('<div class="fr-tooltip"><\/div>'), t.$tooltip = t.shared.$tooltip, t.opts.theme && t.$tooltip.addClass(t.opts.theme + "-theme"), n(t.o_doc).find("body").append(t.$tooltip)), t.events.on("shared.destroy", function() {
        t.$tooltip.html("").removeData().remove();
        t.$tooltip = null
      }, !0))
    }
    return {
      hide: i,
      to: r,
      bind: u
    }
  };
  n.FE.MODULES.button = function(t) {
    function o(i) {
      var r = n(i.currentTarget),
        u = r.next(),
        s = r.hasClass("fr-active"),
        o = (t.helpers.isMobile(), n(".fr-dropdown.fr-active").not(r)),
        f = r.parents(".fr-toolbar, .fr-popup").data("instance") || t,
        e;
      (f.helpers.isIOS() && 0 == f.$el.get(0).querySelectorAll(".fr-marker").length && (f.selection.save(), f.selection.clear(), f.selection.restore()), s) || (e = r.data("cmd"), u.find(".fr-command").removeClass("fr-active"), n.FE.COMMANDS[e] && n.FE.COMMANDS[e].refreshOnShow && n.FE.COMMANDS[e].refreshOnShow.apply(f, [r, u]), u.css("left", r.offset().left - r.parent().offset().left - ("rtl" == t.opts.direction ? u.width() - r.outerWidth() : 0)), t.opts.toolbarBottom ? u.css("bottom", t.$tb.height() - r.position().top) : u.css("top", r.position().top + r.outerHeight()));
      r.addClass("fr-blink").toggleClass("fr-active");
      setTimeout(function() {
        r.removeClass("fr-blink")
      }, 300);
      u.offset().left + u.outerWidth() > n(t.opts.scrollableContainer).offset().left + n(t.opts.scrollableContainer).outerWidth() && u.css("margin-left", -(u.offset().left + u.outerWidth() - n(t.opts.scrollableContainer).offset().left - n(t.opts.scrollableContainer).outerWidth()));
      o.removeClass("fr-active");
      o.parent(".fr-toolbar:not(.fr-inline)").css("zIndex", "");
      0 != r.parents(".fr-popup").length || t.opts.toolbarInline || (r.hasClass("fr-active") ? t.$tb.css("zIndex", (t.opts.zIndex || 1) + 4) : t.$tb.css("zIndex", ""))
    }

    function f(t) {
      var u, i, r;
      for (t.addClass("fr-blink"), setTimeout(function() {
          t.removeClass("fr-blink")
        }, 500), u = t.data("cmd"), i = [];
        "undefined" != typeof t.data("param" + (i.length + 1));) i.push(t.data("param" + (i.length + 1)));
      r = n(".fr-dropdown.fr-active");
      r.length && (r.removeClass("fr-active"), r.parent(".fr-toolbar:not(.fr-inline)").css("zIndex", ""));
      t.parents(".fr-popup, .fr-toolbar").data("instance").commands.exec(u, i)
    }

    function s(t) {
      var i = n(t.currentTarget);
      f(i)
    }

    function h(t) {
      var u = n(t.currentTarget),
        i = u.parents(".fr-popup, .fr-toolbar").data("instance"),
        r;
      if (0 != u.parents(".fr-popup").length || u.data("popup") || i.popups.hideAll(), i.popups.areVisible() && !i.popups.areVisible(i)) {
        for (r = 0; r < n.FE.INSTANCES.length; r++) n.FE.INSTANCES[r] != i && n.FE.INSTANCES[r].popups && n.FE.INSTANCES[r].popups.areVisible() && n.FE.INSTANCES[r].$el.find(".fr-marker").remove();
        i.popups.hideAll()
      }
      u.hasClass("fr-dropdown") ? o(t) : (s(t), n.FE.COMMANDS[u.data("cmd")] && 0 != n.FE.COMMANDS[u.data("cmd")].refreshAfterCallback && i.button.bulkRefresh())
    }

    function c(n) {
      var t = n.find(".fr-dropdown.fr-active");
      t.length && (t.removeClass("fr-active"), t.parent(".fr-toolbar:not(.fr-inline)").css("zIndex", ""))
    }

    function l(n) {
      n.preventDefault();
      n.stopPropagation()
    }

    function a(n) {
      return n.stopPropagation(), t.helpers.isMobile() ? void 0 : !1
    }

    function v(i, f) {
      t.events.bindClick(i, ".fr-command:not(.fr-disabled)", h);
      t.events.$on(i, t._mousedown + " " + t._mouseup + " " + t._move, ".fr-dropdown-menu", l, !0);
      t.events.$on(i, t._mousedown + " " + t._mouseup + " " + t._move, ".fr-dropdown-menu .fr-dropdown-wrapper", a, !0);
      var e = i.get(0).ownerDocument,
        s = "defaultView" in e ? e.defaultView : e.parentWindow,
        o = function(r) {
          r && (r.type != t._mouseup || r.target == n("html").get(0)) && ("keydown" != r.type || (!t.keys.isCharacter(r.which) || t.keys.ctrlKey(r)) && r.which != n.FE.KEYCODE.ESC) || c(i)
        };
      t.events.$on(n(s), t._mouseup + " resize keydown", o, !0);
      t.opts.iframe && t.events.$on(t.$win, t._mouseup, o, !0);
      i.hasClass("fr-popup") ? n.merge(r, i.find(".fr-btn").toArray()) : n.merge(u, i.find(".fr-btn").toArray());
      t.tooltip.bind(i, ".fr-btn, .fr-title", f)
    }

    function y(n, i) {
      var f = "",
        r, u, e;
      if (i.html) f += "function" == typeof i.html ? i.html.call(t) : i.html;
      else {
        r = i.options;
        "function" == typeof r && (r = r());
        f += '<ul class="fr-dropdown-list">';
        for (u in r) r.hasOwnProperty(u) && (e = t.shortcuts.get(n + "." + u), e = e ? '<span class="fr-shortcut">' + e + "<\/span>" : "", f += '<li><a class="fr-command" data-cmd="' + n + '" data-param1="' + u + '" title="' + r[u] + '">' + t.language.translate(r[u]) + "<\/a><\/li>");
        f += "<\/ul>"
      }
      return f
    }

    function p(n, i, r) {
      var f = i.displaySelection,
        o, h, c, u, s, e;
      return "function" == typeof f && (f = f(t)), f ? (h = "function" == typeof i.defaultSelection ? i.defaultSelection(t) : i.defaultSelection, o = '<span style="width:' + (i.displaySelectionWidth || 100) + 'px">' + (h || t.language.translate(i.title)) + "<\/span>") : o = t.icon.create(i.icon || n), c = i.popup ? ' data-popup="true"' : "", u = t.shortcuts.get(n + "."), u = u ? " (" + u + ")" : "", s = '<button type="button" tabindex="-1" aria-label="' + (t.language.translate(i.title) || "") + '" title="' + (t.language.translate(i.title) || "") + u + '" class="fr-command fr-btn' + ("dropdown" == i.type ? " fr-dropdown" : "") + (i.displaySelection ? " fr-selection" : "") + (i.back ? " fr-back" : "") + (i.disabled ? " fr-disabled" : "") + (r ? "" : " fr-hidden") + '" data-cmd="' + n + '"' + c + ">" + o + "<\/button>", "dropdown" == i.type && (e = '<div class="fr-dropdown-menu"><div class="fr-dropdown-wrapper"><div class="fr-dropdown-content">', e += y(n, i), e += "<\/div><\/div><\/div>", s += e), s
    }

    function w(i, r) {
      for (var u, f, s, e = "", o = 0; o < i.length; o++) u = i[o], f = n.FE.COMMANDS[u], f && "undefined" != typeof f.plugin && t.opts.pluginsEnabled.indexOf(f.plugin) < 0 || (f ? (s = "undefined" != typeof r ? r.indexOf(u) >= 0 : !0, e += p(u, f, s)) : "|" == u ? e += '<div class="fr-separator fr-vs"><\/div>' : "-" == u && (e += '<div class="fr-separator fr-hs"><\/div>'));
      return e
    }

    function b(i) {
      var u, f = i.parents(".fr-popup, .fr-toolbar").data("instance") || t,
        r = i.data("cmd");
      i.hasClass("fr-dropdown") ? u = i.next() : i.removeClass("fr-active");
      n.FE.COMMANDS[r] && n.FE.COMMANDS[r].refresh ? n.FE.COMMANDS[r].refresh.apply(f, [i, u]) : t.refresh[r] && f.refresh[r](i, u)
    }

    function e(i) {
      var r = t.$tb ? t.$tb.data("instance") || t : t;
      return 0 == t.events.trigger("buttons.refresh") ? !0 : void setTimeout(function() {
        for (var t, f, e = r.selection.inEditor() && r.core.hasFocus(), u = 0; u < i.length; u++) t = n(i[u]), f = t.data("cmd"), 0 == t.parents(".fr-popup").length ? e || n.FE.COMMANDS[f] && n.FE.COMMANDS[f].forcedRefresh ? r.button.refresh(t) : t.hasClass("fr-dropdown") || t.removeClass("fr-active") : t.parents(".fr-popup").is(":visible") && r.button.refresh(t)
      }, 0)
    }

    function i() {
      e(u);
      e(r)
    }

    function k() {
      u = [];
      r = []
    }

    function d() {
      t.opts.toolbarInline ? t.events.on("toolbar.show", i) : (t.events.on("mouseup", i), t.events.on("keyup", i), t.events.on("blur", i), t.events.on("focus", i), t.events.on("contentChanged", i));
      t.events.on("shared.destroy", k)
    }
    var u = [],
      r;
    return (t.opts.toolbarInline || t.opts.toolbarContainer) && (t.shared.buttons || (t.shared.buttons = []), u = t.shared.buttons), r = [], t.shared.popup_buttons || (t.shared.popup_buttons = []), r = t.shared.popup_buttons, {
      _init: d,
      buildList: w,
      bindCommands: v,
      refresh: b,
      bulkRefresh: i,
      exec: f
    }
  };
  n.FE.POPUP_TEMPLATES = {
    "text.edit": "[_EDIT_]"
  };
  n.FE.RegisterTemplate = function(t, i) {
    n.FE.POPUP_TEMPLATES[t] = i
  };
  n.FE.MODULES.popups = function(t) {
    function o(r, u) {
      u.is(":visible") || (u = n(t.opts.scrollableContainer));
      u.is(i[r].data("container")) || (i[r].data("container", u), u.append(i[r]))
    }

    function v(s, h, c, l) {
      var y, p, a, v;
      if (u() && t.$el.find(".fr-marker").length > 0 && (t.events.disableBlur(), t.selection.restore()), f([s]), !i[s]) return !1;
      n(".fr-dropdown.fr-active").removeClass("fr-active").parent(".fr-toolbar").css("zIndex", "");
      i[s].data("instance", t);
      t.$tb && t.$tb.data("instance", t);
      y = i[s].outerWidth();
      p = (i[s].outerHeight(), r(s));
      i[s].addClass("fr-active").removeClass("fr-hidden").find("input, textarea").removeAttr("disabled");
      a = i[s].data("container");
      a.is(t.$tb) && t.$tb.css("zIndex", (t.opts.zIndex || 1) + 4);
      t.opts.toolbarInline && a && t.$tb && a.get(0) == t.$tb.get(0) && (o(s, n(t.opts.scrollableContainer)), c = t.$tb.offset().top - t.helpers.getPX(t.$tb.css("margin-top")), h = t.$tb.offset().left + t.$tb.outerWidth() / 2 + (parseFloat(t.$tb.find(".fr-arrow").css("margin-left")) || 0) + t.$tb.find(".fr-arrow").outerWidth() / 2, t.$tb.hasClass("fr-above") && c && (c += t.$tb.outerHeight()), l = 0);
      a = i[s].data("container");
      !t.opts.iframe || l || p || (h && (h -= t.$iframe.offset().left), c && (c -= t.$iframe.offset().top));
      h && (h -= y / 2);
      t.opts.toolbarBottom && a && t.$tb && a.get(0) == t.$tb.get(0) && (i[s].addClass("fr-above"), c && (c -= i[s].outerHeight()));
      i[s].removeClass("fr-active");
      t.position.at(h, c, i[s], l || 0);
      i[s].addClass("fr-active");
      v = i[s].find("input:visible, textarea:visible").get(0);
      v && (0 == t.$el.find(".fr-marker").length && t.core.hasFocus() && t.selection.save(), t.events.disableBlur(), n(v).select().focus());
      t.opts.toolbarInline && t.toolbar.hide();
      t.events.trigger("popups.show." + s);
      e(s)._repositionPopup()
    }

    function y(n, i) {
      t.events.on("popups.show." + n, i)
    }

    function r(n) {
      return i[n] && i[n].hasClass("fr-active") && t.core.sameInstance(i[n]) || !1
    }

    function u(n) {
      for (var t in i)
        if (i.hasOwnProperty(t) && r(t) && ("undefined" == typeof n || i[t].data("instance") == n)) return !0;
      return !1
    }

    function s(n) {
      i[n] && i[n].hasClass("fr-active") && (i[n].removeClass("fr-active fr-above"), t.events.trigger("popups.hide." + n), t.$tb && (t.opts.zIndex > 1 ? t.$tb.css("zIndex", t.opts.zIndex + 1) : t.$tb.css("zIndex", "")), t.events.disableBlur(), i[n].find("input, textarea, button").filter(":focus").blur(), i[n].find("input, textarea").attr("disabled", "disabled"))
    }

    function p(n, i) {
      t.events.on("popups.hide." + n, i)
    }

    function w(n) {
      var r = i[n],
        u;
      return r && !r.data("inst" + t.id) && (u = e(n), a(u, n)), r
    }

    function b(n, i) {
      t.events.on("popups.refresh." + n, i)
    }

    function k(r) {
      var f, u, e;
      for (t.events.trigger("popups.refresh." + r), f = i[r].find(".fr-command"), u = 0; u < f.length; u++) e = n(f[u]), 0 == e.parents(".fr-dropdown-menu").length && t.button.refresh(e)
    }

    function f(n) {
      "undefined" == typeof n && (n = []);
      for (var t in i) i.hasOwnProperty(t) && n.indexOf(t) < 0 && s(t)
    }

    function h() {
      t.shared.exit_flag = !0
    }

    function c() {
      t.shared.exit_flag = !1
    }

    function l() {
      return t.shared.exit_flag
    }

    function d(i, r) {
      var u = n.FE.POPUP_TEMPLATES[i],
        f;
      "function" == typeof u && (u = u.apply(t));
      for (f in r) r.hasOwnProperty(f) && (u = u.replace("[_" + f.toUpperCase() + "_]", r[f]));
      return u
    }

    function g(r, u) {
      var o = d(r, u),
        f = n('<div class="fr-popup' + (t.helpers.isMobile() ? " fr-mobile" : " fr-desktop") + (t.opts.toolbarInline ? " fr-inline" : "") + '"><span class="fr-arrow"><\/span>' + o + "<\/div>"),
        e;
      return t.opts.theme && f.addClass(t.opts.theme + "-theme"), t.opts.zIndex > 1 && t.$tb.css("z-index", t.opts.zIndex + 2), "auto" != t.opts.direction && f.removeClass("fr-ltr fr-rtl").addClass("fr-" + t.opts.direction), f.find("input, textarea").attr("dir", t.opts.direction).attr("disabled", "disabled"), e = n("body"), e.append(f), f.data("container", e), i[r] = f, t.button.bindCommands(f, !1), f
    }

    function e(u) {
      var f = i[u];
      return {
        _windowResize: function() {
          var n = f.data("instance") || t;
          !n.helpers.isMobile() && f.is(":visible") && (n.events.disableBlur(), n.popups.hide(u), n.events.enableBlur())
        },
        _inputFocus: function(i) {
          var r = f.data("instance") || t,
            u;
          (i.preventDefault(), setTimeout(function() {
            r.events.enableBlur()
          }, 0), r.helpers.isMobile()) && (u = n(r.o_win).scrollTop(), setTimeout(function() {
            n(r.o_win).scrollTop(u)
          }, 0))
        },
        _inputBlur: function() {
          var i = f.data("instance") || t;
          document.activeElement != this && n(this).is(":visible") && (i.events.blurActive() && i.events.trigger("blur"), i.events.enableBlur())
        },
        _inputKeydown: function(i) {
          var e = f.data("instance") || t,
            h = i.which,
            o, s;
          if (n.FE.KEYCODE.TAB == h) i.preventDefault(), o = f.find("input, textarea, button, select").filter(":visible").not(":disabled").toArray(), o.sort(function(t, r) {
            return i.shiftKey ? n(t).attr("tabIndex") < n(r).attr("tabIndex") : n(t).attr("tabIndex") > n(r).attr("tabIndex")
          }), e.events.disableBlur(), s = o.indexOf(this) + 1, s == o.length && (s = 0), n(o[s]).focus();
          else if (n.FE.KEYCODE.ENTER == h) f.find(".fr-submit:visible").length > 0 && (i.preventDefault(), i.stopPropagation(), e.events.disableBlur(), e.button.exec(f.find(".fr-submit:visible:first")));
          else {
            if (n.FE.KEYCODE.ESC == h) return i.preventDefault(), i.stopPropagation(), e.$el.find(".fr-marker") && (e.events.disableBlur(), n(this).data("skip", !0), e.selection.restore(), e.events.enableBlur()), r(u) && f.find(".fr-back:visible").length ? e.button.exec(f.find(".fr-back:visible:first")) : e.popups.hide(u), e.opts.toolbarInline && e.toolbar.showInline(null, !0), !1;
            i.stopPropagation()
          }
        },
        _windowKeydown: function(i) {
          if (!t.core.sameInstance(f)) return !0;
          var e = f.data("instance") || t,
            o = i.which;
          if (n.FE.KEYCODE.ESC == o) {
            if (r(u) && e.opts.toolbarInline) return i.stopPropagation(), r(u) && f.find(".fr-back:visible").length ? e.button.exec(f.find(".fr-back:visible:first")) : (e.popups.hide(u), e.toolbar.showInline(null, !0)), !1;
            r(u) && f.find(".fr-back:visible").length ? e.button.exec(f.find(".fr-back:visible:first")) : e.popups.hide(u)
          }
        },
        _editorKeydown: function(i) {
          var e = f.data("instance") || t;
          e.keys.ctrlKey(i) || i.which == n.FE.KEYCODE.ESC || (r(u) && f.find(".fr-back:visible").length ? e.button.exec(f.find(".fr-back:visible:first")) : e.popups.hide(u))
        },
        _preventFocus: function(i) {
          var e = f.data("instance") || t,
            r, u;
          return e.events.disableBlur(), r = i.originalEvent ? i.originalEvent.target || i.originalEvent.originalTarget : null, u = "input, textarea, button, select, label, .fr-command", r && !n(r).is(u) && 0 === n(r).parents(u).length ? (i.stopPropagation(), !1) : void(r && n(r).is(u) && i.stopPropagation())
        },
        _editorMouseup: function() {
          f.is(":visible") && l() && f.find("input:focus, textarea:focus, button:focus, select:focus").filter(":visible").length > 0 && t.events.disableBlur()
        },
        _windowMouseup: function(n) {
          if (!t.core.sameInstance(f)) return !0;
          var i = f.data("instance") || t;
          f.is(":visible") && l() && (n.stopPropagation(), i.markers.remove(), i.popups.hide(u), c())
        },
        _doPlaceholder: function() {
          var t = n(this).next();
          0 == t.length && n(this).after("<label>" + n(this).attr("placeholder") + "<\/label>");
          n(this).toggleClass("fr-not-empty", "" != n(this).val())
        },
        _repositionPopup: function() {
          if (!t.opts.height && !t.opts.heightMax || t.opts.toolbarInline) return !0;
          if (t.$wp && r(u) && f.parent().get(0) == n(t.opts.scrollableContainer).get(0)) {
            var i = f.offset().top - t.$wp.offset().top,
              e = t.$wp.outerHeight();
            f.hasClass("fr-above") && (i += f.outerHeight());
            i > e || 0 > i ? f.addClass("fr-hidden") : f.removeClass("fr-hidden")
          }
        }
      }
    }

    function a(n, r) {
      t.events.on("mouseup", n._editorMouseup, !0);
      t.$wp && t.events.on("keydown", n._editorKeydown);
      t.events.on("blur", function() {
        u() && t.markers.remove();
        f()
      });
      t.$wp && !t.helpers.isMobile() && t.events.$on(t.$wp, "scroll.popup" + r, n._repositionPopup);
      t.events.on("window.keydown", n._windowKeydown);
      t.events.on("window.mouseup", n._windowMouseup, !0);
      i[r].data("inst" + t.id, !0);
      t.events.on("destroy", function() {
        t.core.sameInstance(i[r]) && i[r].removeClass("fr-active").appendTo("body")
      }, !0)
    }

    function nt(i, r) {
      var u = g(i, r),
        f = e(i);
      return a(f, i), t.events.$on(u, "mousedown mouseup touchstart touchend touch", "*", f._preventFocus, !0), t.events.$on(u, "focus", "input, textarea, button, select", f._inputFocus, !0), t.events.$on(u, "blur", "input, textarea, button, select", f._inputBlur, !0), t.events.$on(u, "keydown", "input, textarea, button, select", f._inputKeydown, !0), t.events.$on(u, "keydown keyup change input", "input, textarea", f._doPlaceholder, !0), t.helpers.isIOS() && t.events.$on(u, "touchend", "label", function() {
        n("#" + n(this).attr("for")).prop("checked", function(n, t) {
          return !t
        })
      }, !0), t.events.$on(n(t.o_win), "resize", f._windowResize, !0), u
    }

    function tt() {
      var n, t;
      for (n in i) i.hasOwnProperty(n) && (t = i[n], t.html("").removeData().remove(), i[n] = null);
      i = []
    }

    function it() {
      t.events.on("shared.destroy", tt, !0);
      t.events.on("window.mousedown", h);
      t.events.on("window.touchmove", c);
      t.events.on("mousedown", function(n) {
        u() && (n.stopPropagation(), t.$el.find(".fr-marker").remove(), h(), t.events.disableBlur())
      })
    }
    t.shared.popups || (t.shared.popups = {});
    var i = t.shared.popups;
    return t.shared.exit_flag = !1, {
      _init: it,
      create: nt,
      get: w,
      show: v,
      hide: s,
      onHide: p,
      hideAll: f,
      setContainer: o,
      refresh: k,
      onRefresh: b,
      onShow: y,
      isVisible: r,
      areVisible: u
    }
  };
  n.FE.MODULES.position = function(t) {
    function r() {
      var i, u = t.selection.ranges(0),
        f, r, e, o;
      return u && u.collapsed && t.selection.inEditor() ? (f = !1, 0 == t.$el.find(".fr-marker").length && (t.selection.save(), f = !0), r = t.$el.find(".fr-marker:first"), r.css("display", "inline"), r.css("line-height", ""), e = r.offset(), o = r.outerHeight(), r.css("display", "none"), r.css("line-height", 0), i = {}, i.left = e.left, i.width = 0, i.height = o, i.top = e.top - (t.helpers.isIOS() ? 0 : n(t.o_win).scrollTop()), i.right = 1, i.bottom = 1, i.ok = !0, f && t.selection.restore()) : u && (i = u.getBoundingClientRect()), i
    }

    function e(i, r, u) {
      var o = i.outerHeight(),
        f, e, s;
      return !t.helpers.isMobile() && t.$tb && i.parent().get(0) != t.$tb.get(0) && (f = (i.parent().height() - 20 - (t.opts.toolbarBottom ? t.$tb.outerHeight() : 0), i.parent().offset().top), e = r - o - (u || 0), i.parent().get(0) == n(t.opts.scrollableContainer).get(0) && (f -= i.parent().position().top), s = n(t.opts.scrollableContainer).get(0).scrollHeight, f + r + o > n(t.opts.scrollableContainer).offset().top + s && i.parent().offset().top + e > 0 ? (r = e, i.addClass("fr-above")) : i.removeClass("fr-above")), r
    }

    function o(i, r) {
      var u = i.outerWidth();
      return i.parent().offset().left + r + u > n(t.opts.scrollableContainer).width() - 10 && (r = n(t.opts.scrollableContainer).width() - u - 10 - i.parent().offset().left + n(t.opts.scrollableContainer).offset().left), i.parent().offset().left + r < n(t.opts.scrollableContainer).offset().left && (r = 10 - i.parent().offset().left + n(t.opts.scrollableContainer).offset().left), r
    }

    function s(i) {
      var f = r(),
        e, o;
      i.css("top", 0).css("left", 0);
      e = f.top + f.height;
      o = f.left + f.width / 2 - i.outerWidth() / 2 + n(t.o_win).scrollLeft();
      t.opts.iframe || (e += n(t.o_win).scrollTop());
      u(o, e, i, f.height)
    }

    function u(n, i, r, u) {
      var f = r.data("container"),
        h, s;
      f && "BODY" != f.get(0).tagName && (n && (n -= f.offset().left), i && (i -= f.offset().top - f.scrollTop()));
      t.opts.iframe && f && t.$tb && f.get(0) != t.$tb.get(0) && (n && (n += t.$iframe.offset().left), i && (i += t.$iframe.offset().top));
      h = o(r, n);
      n && (r.css("left", h), s = r.find(".fr-arrow"), s.data("margin-left") || s.data("margin-left", t.helpers.getPX(s.css("margin-left"))), s.css("margin-left", n - h + s.data("margin-left")));
      i && r.css("top", e(r, i, u))
    }

    function h(i) {
      var r = n(i),
        s = r.is(".fr-sticky-on"),
        f = r.data("sticky-top"),
        h = r.data("sticky-scheduled"),
        o, e, u;
      "undefined" == typeof f ? (r.data("sticky-top", 0), o = n('<div class="fr-sticky-dummy" style="height: ' + r.outerHeight() + 'px;"><\/div>'), t.$box.prepend(o)) : t.$box.find(".fr-sticky-dummy").css("height", r.outerHeight());
      t.core.hasFocus() || t.$tb.find("input:visible:focus").length > 0 ? (e = n(window).scrollTop(), u = Math.min(Math.max(e - t.$tb.parent().offset().top, 0), t.$tb.parent().outerHeight() - r.outerHeight()), u != f && u != h && (clearTimeout(r.data("sticky-timeout")), r.data("sticky-scheduled", u), r.outerHeight() < e - t.$tb.parent().offset().top && r.addClass("fr-opacity-0"), r.data("sticky-timeout", setTimeout(function() {
        var u = n(window).scrollTop(),
          i = Math.min(Math.max(u - t.$tb.parent().offset().top, 0), t.$tb.parent().outerHeight() - r.outerHeight());
        i > 0 && "BODY" == t.$tb.parent().get(0).tagName && (i += t.$tb.parent().position().top);
        i != f && (r.css("top", Math.max(i, 0)), r.data("sticky-top", i), r.data("sticky-scheduled", i));
        r.removeClass("fr-opacity-0")
      }, 100))), s || (r.css("top", "0"), r.width(t.$tb.parent().width()), r.addClass("fr-sticky-on"), t.$box.addClass("fr-sticky-box"))) : (clearTimeout(n(i).css("sticky-timeout")), r.css("top", "0"), r.css("position", ""), r.width(""), r.data("sticky-top", 0), r.removeClass("fr-sticky-on"), t.$box.removeClass("fr-sticky-box"))
    }

    function c(i) {
      var f, p, v, b, k, d, g;
      if (i.offsetWidth) {
        var s, h, r = n(i),
          c = r.outerHeight(),
          u = r.data("sticky-position"),
          l = n("body" == t.opts.scrollableContainer ? t.o_win : t.opts.scrollableContainer).outerHeight(),
          e = 0,
          y = 0;
        "body" !== t.opts.scrollableContainer && (e = n(t.opts.scrollableContainer).offset().top, y = n(t.o_win).outerHeight() - e - l);
        f = "body" == t.opts.scrollableContainer ? n(t.o_win).scrollTop() : e;
        p = r.is(".fr-sticky-on");
        r.data("sticky-parent") || r.data("sticky-parent", r.parent());
        var a = r.data("sticky-parent"),
          o = a.offset().top,
          w = a.outerHeight();
        (r.data("sticky-offset") || (r.data("sticky-offset", !0), r.after('<div class="fr-sticky-dummy" style="height: ' + c + 'px;"><\/div>')), u) || (v = "auto" !== r.css("top") || "auto" !== r.css("bottom"), v || r.css("position", "fixed"), u = {
          top: r.hasClass("fr-top"),
          bottom: r.hasClass("fr-bottom")
        }, v || r.css("position", ""), r.data("sticky-position", u), r.data("top", r.hasClass("fr-top") ? r.css("top") : "auto"), r.data("bottom", r.hasClass("fr-bottom") ? r.css("bottom") : "auto"));
        b = function() {
          return f + s > o && o + w - c >= f + s
        };
        k = function() {
          return f + l - h > o + c && o + w > f + l - h
        };
        s = t.helpers.getPX(r.data("top"));
        h = t.helpers.getPX(r.data("bottom"));
        d = u.top && b();
        g = u.bottom && k();
        d || g ? (r.css("width", a.width() + "px"), p || (r.addClass("fr-sticky-on"), r.removeClass("fr-sticky-off"), r.css("top") && ("auto" != r.data("top") ? r.css("top", t.helpers.getPX(r.data("top")) + e) : r.data("top", "auto")), r.css("bottom") && ("auto" != r.data("bottom") ? r.css("bottom", t.helpers.getPX(r.data("bottom")) + y) : r.css("bottom", "auto")))) : r.hasClass("fr-sticky-off") || (r.width(""), r.removeClass("fr-sticky-on"), r.addClass("fr-sticky-off"), r.css("top") && "auto" != r.css("top") && r.css("top", 0), r.css("bottom") && r.css("bottom", 0))
      }
    }

    function f() {
      var i = document.createElement("test"),
        n = i.style;
      return n.cssText = "position:" + ["-webkit-", "-moz-", "-ms-", "-o-", ""].join("sticky; position:") + " sticky;", -1 !== n.position.indexOf("sticky") && !t.helpers.isIOS() && !t.helpers.isAndroid()
    }

    function l() {
      if (!f())
        if (t._stickyElements = [], t.helpers.isIOS()) {
          var r = function() {
            t.helpers.requestAnimationFrame()(r);
            for (var n = 0; n < t._stickyElements.length; n++) h(t._stickyElements[n])
          };
          r();
          t.events.$on(n(t.o_win), "scroll", function() {
            var r;
            if (t.core.hasFocus())
              for (r = 0; r < t._stickyElements.length; r++) {
                var i = n(t._stickyElements[r]),
                  u = i.parent(),
                  f = n(window).scrollTop();
                i.outerHeight() < f - u.offset().top && (i.addClass("fr-opacity-0"), i.data("sticky-top", -1), i.data("sticky-scheduled", -1))
              }
          }, !0)
        } else t.events.$on(n("body" == t.opts.scrollableContainer ? t.o_win : t.opts.scrollableContainer), "scroll", i, !0), t.events.$on(n(t.o_win), "resize", i, !0), t.events.on("initialized", i), t.events.on("focus", i), t.events.$on(n(t.o_win), "resize", "textarea", i, !0);
      t.events.on("destroy", function() {
        t._stickyElements = []
      })
    }

    function i() {
      for (var n = 0; n < t._stickyElements.length; n++) c(t._stickyElements[n])
    }

    function a(n) {
      n.addClass("fr-sticky");
      t.helpers.isIOS() && n.addClass("fr-sticky-ios");
      f() || t._stickyElements.push(n.get(0))
    }

    function v() {
      l()
    }
    return {
      _init: v,
      forSelection: s,
      addSticky: a,
      refresh: i,
      at: u,
      getBoundingRect: r
    }
  };
  n.FE.MODULES.refresh = function(t) {
    function i(n) {
      n.toggleClass("fr-disabled", !t.undo.canDo())
    }

    function r(n) {
      n.toggleClass("fr-disabled", !t.undo.canRedo())
    }

    function u(n) {
      var u, r, i;
      if (n.hasClass("fr-no-refresh")) return !1;
      for (u = t.selection.blocks(), r = 0; r < u.length; r++) {
        for (i = u[r].previousSibling; i && i.nodeType == Node.TEXT_NODE && 0 === i.textContent.length;) i = i.previousSibling;
        if ("LI" != u[r].tagName || i) return n.removeClass("fr-disabled"), !0;
        n.addClass("fr-disabled")
      }
    }

    function f(i) {
      var u, r, f;
      if (i.hasClass("fr-no-refresh")) return !1;
      for (u = t.selection.blocks(), r = 0; r < u.length; r++)
        if ((f = "rtl" == t.opts.direction || "rtl" == n(u[r]).css("direction") ? "margin-right" : "margin-left", "LI" == u[r].tagName || "LI" == u[r].parentNode.tagName) || t.helpers.getPX(n(u[r]).css(f)) > 0) return i.removeClass("fr-disabled"), !0;
      i.addClass("fr-disabled")
    }
    return {
      undo: i,
      redo: r,
      outdent: f,
      indent: u
    }
  };
  n.extend(n.FE.DEFAULTS, {
    editInPopup: !1
  });
  n.FE.MODULES.textEdit = function(t) {
    function i() {
      var n = '<div id="fr-text-edit-' + t.id + '" class="fr-layer fr-text-edit-layer"><div class="fr-input-line"><input type="text" placeholder="' + t.language.translate("Text") + '" tabIndex="1"><\/div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="updateText" tabIndex="2">' + t.language.translate("Update") + "<\/button><\/div><\/div>",
        i = {
          edit: n
        };
      t.popups.create("text.edit", i)
    }

    function r() {
      var i, r = t.popups.get("text.edit");
      i = "INPUT" === t.$el.prop("tagName") ? t.$el.attr("placeholder") : t.$el.text();
      r.find("input").val(i).trigger("change");
      t.popups.setContainer("text.edit", n("body"));
      t.popups.show("text.edit", t.$el.offset().left + t.$el.outerWidth() / 2, t.$el.offset().top + t.$el.outerHeight(), t.$el.outerHeight())
    }

    function u() {
      t.events.$on(t.$el, t._mouseup, function() {
        setTimeout(function() {
          r()
        }, 10)
      })
    }

    function f() {
      var i = t.popups.get("text.edit"),
        n = i.find("input").val();
      0 == n.length && (n = t.opts.placeholderText);
      "INPUT" === t.$el.prop("tagName") ? t.$el.attr("placeholder", n) : t.$el.text(n);
      t.events.trigger("contentChanged");
      t.popups.hide("text.edit")
    }

    function e() {
      t.opts.editInPopup && (i(), u())
    }
    return {
      _init: e,
      update: f
    }
  };
  n.FE.RegisterCommand("updateText", {
    focus: !1,
    undo: !1,
    callback: function() {
      this.textEdit.update()
    }
  });
  n.extend(n.FE.DEFAULTS, {
    toolbarBottom: !1,
    toolbarButtons: ["fullscreen", "bold", "italic", "underline", "strikeThrough", "subscript", "superscript", "fontFamily", "fontSize", "|", "color", "emoticons", "inlineStyle", "paragraphStyle", "|", "paragraphFormat", "align", "formatOL", "formatUL", "outdent", "indent", "quote", "insertHR", "-", "insertLink", "insertImage", "insertVideo", "insertFile", "insertTable", "undo", "redo", "clearFormatting", "selectAll", "html", "applyFormat", "removeFormat"],
    toolbarButtonsXS: ["bold", "italic", "fontFamily", "fontSize", "|", "undo", "redo"],
    toolbarButtonsSM: ["bold", "italic", "underline", "|", "fontFamily", "fontSize", "insertLink", "insertImage", "table", "|", "undo", "redo"],
    toolbarButtonsMD: ["fullscreen", "bold", "italic", "underline", "fontFamily", "fontSize", "color", "paragraphStyle", "paragraphFormat", "align", "formatOL", "formatUL", "outdent", "indent", "quote", "insertHR", "-", "insertLink", "insertImage", "insertVideo", "insertFile", "insertTable", "undo", "redo", "clearFormatting"],
    toolbarContainer: null,
    toolbarInline: !1,
    toolbarSticky: !0,
    toolbarStickyOffset: 0,
    toolbarVisibleWithoutSelection: !1
  });
  n.FE.MODULES.toolbar = function(t) {
    function e(n, t) {
      for (var i = 0; i < t.length; i++) "-" != t[i] && "|" != t[i] && n.indexOf(t[i]) < 0 && n.push(t[i])
    }

    function a() {
      var i = n.merge([], h()),
        r, u;
      for (e(i, t.opts.toolbarButtonsXS || []), e(i, t.opts.toolbarButtonsSM || []), e(i, t.opts.toolbarButtonsMD || []), e(i, t.opts.toolbarButtons), r = i.length - 1; r >= 0; r--) "-" != i[r] && "|" != i[r] && i.indexOf(i[r]) < r && i.splice(r, 1);
      u = t.button.buildList(i, h());
      t.$tb.append(u);
      t.button.bindCommands(t.$tb)
    }

    function h() {
      var n = t.helpers.screenSize();
      return u[n]
    }

    function l() {
      var i = h(),
        n, r, u;
      for (t.$tb.find(".fr-separator").remove(), t.$tb.find("> .fr-command").addClass("fr-hidden"), n = 0; n < i.length; n++) "|" == i[n] || "-" == i[n] ? t.$tb.append(t.button.buildList([i[n]])) : (r = t.$tb.find('> .fr-command[data-cmd="' + i[n] + '"]'), u = null, r.next().hasClass("fr-dropdown-menu") && (u = r.next()), r.removeClass("fr-hidden").appendTo(t.$tb), u && u.appendTo(t.$tb))
    }

    function v() {
      t.events.$on(n(t.o_win), "resize", l, !0);
      t.events.$on(n(t.o_win), "orientationchange", l, !0)
    }

    function i(i, r) {
      setTimeout(function() {
        if ((!i || i.which != n.FE.KEYCODE.ESC) && t.selection.inEditor() && t.core.hasFocus() && !t.popups.areVisible() && (t.opts.toolbarVisibleWithoutSelection && i && "keyup" != i.type || !t.selection.isCollapsed() && !t.keys.isIME() || r)) {
          if (t.$tb.data("instance", t), 0 == t.events.trigger("toolbar.show", [i])) return !1;
          t.opts.toolbarContainer || t.position.forSelection(t.$tb);
          t.$tb.show()
        }
      }, 0)
    }

    function r() {
      var i = n(".fr-dropdown.fr-active");
      return i.next().find(t.o_doc.activeElement).length ? !0 : 0 == t.events.trigger("toolbar.hide") ? !1 : void t.$tb.hide()
    }

    function y() {
      return 0 == t.events.trigger("toolbar.show") ? !1 : void t.$tb.show()
    }

    function o() {
      t.events.on("window.mousedown", r);
      t.events.on("keydown", r);
      t.events.on("blur", r);
      t.events.on("window.mouseup", i);
      t.helpers.isMobile() ? t.helpers.isIOS() || (t.events.on("window.touchend", i), t.browser.mozilla && setInterval(i, 200)) : t.events.on("window.keyup", i);
      t.events.on("keydown", function(t) {
        t && t.which == n.FE.KEYCODE.ESC && r()
      });
      t.events.$on(t.$wp, "scroll.toolbar", i);
      t.events.on("commands.after", i);
      t.helpers.isMobile() && (t.events.$on(t.$doc, "selectionchange", i), t.events.$on(t.$doc, "orientationchange", i))
    }

    function p() {
      t.opts.toolbarInline ? (n(t.opts.scrollableContainer).append(t.$tb), t.$tb.data("container", n(t.opts.scrollableContainer)), t.$tb.addClass("fr-inline"), t.$tb.prepend('<span class="fr-arrow"><\/span>'), o(), t.opts.toolbarBottom = !1) : (t.opts.toolbarBottom && !t.helpers.isIOS() ? (t.$box.append(t.$tb), t.$tb.addClass("fr-bottom"), t.$box.addClass("fr-bottom")) : (t.opts.toolbarBottom = !1, t.$box.prepend(t.$tb), t.$tb.addClass("fr-top"), t.$box.addClass("fr-top")), t.$tb.addClass("fr-basic"), t.opts.toolbarSticky && (t.opts.toolbarStickyOffset && (t.opts.toolbarBottom ? t.$tb.css("bottom", t.opts.toolbarStickyOffset) : t.$tb.css("top", t.opts.toolbarStickyOffset)), t.position.addSticky(t.$tb)))
    }

    function w() {
      t.$tb.html("").removeData().remove();
      t.$tb = null
    }

    function b() {
      t.$box.removeClass("fr-top fr-bottom fr-inline fr-basic");
      t.$box.find(".fr-sticky-dummy").remove()
    }

    function c() {
      t.opts.theme && t.$tb.addClass(t.opts.theme + "-theme");
      t.opts.zIndex > 1 && t.$tb.css("z-index", t.opts.zIndex + 1);
      "auto" != t.opts.direction && t.$tb.removeClass("fr-ltr fr-rtl").addClass("fr-" + t.opts.direction);
      t.helpers.isMobile() ? t.$tb.addClass("fr-mobile") : t.$tb.addClass("fr-desktop");
      t.opts.toolbarContainer ? (t.opts.toolbarInline && (o(), r()), t.opts.toolbarBottom ? t.$tb.addClass("fr-bottom") : t.$tb.addClass("fr-top")) : p();
      s = t.$tb.get(0).ownerDocument;
      nt = "defaultView" in s ? s.defaultView : s.parentWindow;
      a();
      v();
      t.events.$on(t.$tb, t._mousedown + " " + t._mouseup, function(n) {
        var i = n.originalEvent ? n.originalEvent.target || n.originalEvent.originalTarget : null;
        if (i && "INPUT" != i.tagName && !t.edit.isDisabled()) return (n.stopPropagation(), n.preventDefault(), !1)
      }, !0)
    }

    function k() {
      return t.$wp ? (t.opts.toolbarContainer ? (t.shared.$tb ? (t.$tb = t.shared.$tb, t.opts.toolbarInline && o()) : (t.shared.$tb = n('<div class="fr-toolbar"><\/div>'), t.$tb = t.shared.$tb, n(t.opts.toolbarContainer).append(t.$tb), c(), t.$tb.data("instance", t)), t.opts.toolbarInline ? t.$box.addClass("fr-inline") : t.$box.addClass("fr-basic"), t.events.on("focus", function() {
        t.$tb.data("instance", t)
      }, !0), t.opts.toolbarInline = !1) : t.opts.toolbarInline ? (t.$box.addClass("fr-inline"), t.shared.$tb ? (t.$tb = t.shared.$tb, o()) : (t.shared.$tb = n('<div class="fr-toolbar"><\/div>'), t.$tb = t.shared.$tb, c())) : (t.$box.addClass("fr-basic"), t.$tb = n('<div class="fr-toolbar"><\/div>'), c(), t.$tb.data("instance", t)), t.events.on("destroy", b, !0), void t.events.on(t.opts.toolbarInline ? "shared.destroy" : "destroy", w, !0)) : !1
    }

    function d() {
      !f && t.$tb && (t.$tb.find("> .fr-command").addClass("fr-disabled fr-no-refresh"), f = !0)
    }

    function g() {
      f && t.$tb && (t.$tb.find("> .fr-command").removeClass("fr-disabled fr-no-refresh"), f = !1);
      t.button.bulkRefresh()
    }
    var s, nt, u = [],
      f;
    return u[n.FE.XS] = t.opts.toolbarButtonsXS || t.opts.toolbarButtons, u[n.FE.SM] = t.opts.toolbarButtonsSM || t.opts.toolbarButtons, u[n.FE.MD] = t.opts.toolbarButtonsMD || t.opts.toolbarButtons, u[n.FE.LG] = t.opts.toolbarButtons, f = !1, {
      _init: k,
      hide: r,
      show: y,
      showInline: i,
      disable: d,
      enable: g
    }
  }
});
/*!
 * froala_editor v2.3.2 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2016 Froala Labs
 */
! function(n) {
  "function" == typeof define && define.amd ? define(["jquery"], n) : "object" == typeof module && module.exports ? module.exports = function(t, i) {
    return void 0 === i && (i = "undefined" != typeof window ? require("jquery") : require("jquery")(t)), n(i), i
  } : n(jQuery)
}(function(n) {
  "use strict";
  n.FE.PLUGINS.align = function(t) {
    function i(i) {
      t.selection.save();
      t.html.wrap(!0, !0, !0, !0);
      t.selection.restore();
      for (var u = t.selection.blocks(), r = 0; r < u.length; r++) n(u[r]).css("text-align", i).removeClass("fr-temp-div"), "" === n(u[r]).attr("class") && n(u[r]).removeAttr("class");
      t.selection.save();
      t.html.unwrap();
      t.selection.restore()
    }

    function r(i) {
      var r = t.selection.blocks(),
        u;
      r.length && (u = t.helpers.getAlignment(n(r[0])), i.find("> *:first").replaceWith(t.icon.create("align-" + u)))
    }

    function u(i, r) {
      var u = t.selection.blocks(),
        f;
      u.length && (f = t.helpers.getAlignment(n(u[0])), r.find('a.fr-command[data-param1="' + f + '"]').addClass("fr-active"))
    }
    return {
      apply: i,
      refresh: r,
      refreshOnShow: u
    }
  };
  n.FE.DefineIcon("align", {
    NAME: "align-left"
  });
  n.FE.DefineIcon("align-left", {
    NAME: "align-left"
  });
  n.FE.DefineIcon("align-right", {
    NAME: "align-right"
  });
  n.FE.DefineIcon("align-center", {
    NAME: "align-center"
  });
  n.FE.DefineIcon("align-justify", {
    NAME: "align-justify"
  });
  n.FE.RegisterCommand("align", {
    type: "dropdown",
    title: "Align",
    options: {
      left: "Align Left",
      center: "Align Center",
      right: "Align Right",
      justify: "Align Justify"
    },
    html: function() {
      var r = '<ul class="fr-dropdown-list">',
        i = n.FE.COMMANDS.align.options;
      for (var t in i) i.hasOwnProperty(t) && (r += '<li><a class="fr-command fr-title" data-cmd="align" data-param1="' + t + '" title="' + this.language.translate(i[t]) + '">' + this.icon.create("align-" + t) + "<\/a><\/li>");
      return r + "<\/ul>"
    },
    callback: function(n, t) {
      this.align.apply(t)
    },
    refresh: function(n) {
      this.align.refresh(n)
    },
    refreshOnShow: function(n, t) {
      this.align.refreshOnShow(n, t)
    },
    plugin: "align"
  })
});
/*!
 * froala_editor v2.3.2 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2016 Froala Labs - image moduke
 */
! function(n) {
  "function" == typeof define && define.amd ? define(["jquery"], n) : "object" == typeof module && module.exports ? module.exports = function(t, i) {
    return void 0 === i && (i = "undefined" != typeof window ? require("jquery") : require("jquery")(t)), n(i), i
  } : n(jQuery)
}(function(n) {
  "use strict";
  n.extend(n.FE.POPUP_TEMPLATES, {
    "image.insert": "[_BUTTONS_][_UPLOAD_LAYER_][_BY_URL_LAYER_][_PROGRESS_BAR_]",
    "image.edit": "[_BUTTONS_]",
    "image.alt": "[_BUTTONS_][_ALT_LAYER_]",
    "image.size": "[_BUTTONS_][_SIZE_LAYER_]"
  });
  n.extend(n.FE.DEFAULTS, {
    imageInsertButtons: ["imageBack", "|", "imageUpload", "imageByURL"],
    imageEditButtons: ["imageReplace", "imageAlign", "imageRemove", "|", "imageLink", "linkOpen", "linkEdit", "linkRemove", "-", "imageDisplay", "imageStyle", "imageAlt", "imageSize"],
    imageAltButtons: ["imageBack", "|"],
    imageSizeButtons: ["imageBack", "|"],
    imageUploadURL: "https://i.froala.com/upload",
    imageUploadParam: "file",
    imageUploadParams: {},
    imageUploadToS3: !1,
    imageUploadMethod: "POST",
    imageMaxSize: 10485760,
    imageAllowedTypes: ["jpeg", "jpg", "png", "gif", "svg+xml"],
    imageResize: !0,
    imageResizeWithPercent: !1,
    imageRoundPercent: !1,
    imageDefaultWidth: 300,
    imageDefaultAlign: "center",
    imageDefaultDisplay: "block",
    imageSplitHTML: !1,
    imageStyles: {
      "fr-rounded": "Rounded",
      "fr-bordered": "Bordered"
    },
    imageMove: !0,
    imageMultipleStyles: !0,
    imageTextNear: !0,
    imagePaste: !0,
    imagePasteProcess: !1,
    imageMinWidth: 16,
    imageOutputSize: !1
  });
  n.FE.PLUGINS.image = function(t) {
    function ii() {
      var r = t.popups.get("image.insert"),
        n = r.find(".fr-image-by-url-layer input");
      n.val("");
      i && n.val(i.attr("src"));
      n.trigger("change")
    }

    function ri() {
      var n = t.$tb.find('.fr-command[data-cmd="insertImage"]'),
        i = t.popups.get("image.insert"),
        r, u;
      (i || (i = b()), l(), i.hasClass("fr-active")) || ((t.popups.refresh("image.insert"), t.popups.setContainer("image.insert", t.$tb), n.is(":visible")) ? (r = n.offset().left + n.outerWidth() / 2, u = n.offset().top + (t.opts.toolbarBottom ? 10 : n.outerHeight() - 10), t.popups.show("image.insert", r, u, n.outerHeight())) : (t.position.forSelection(i), t.popups.show("image.insert")))
    }

    function v() {
      var r = t.popups.get("image.edit"),
        u, f;
      r || (r = ct());
      t.popups.setContainer("image.edit", n(t.opts.scrollableContainer));
      t.popups.refresh("image.edit");
      u = i.offset().left + i.outerWidth() / 2;
      f = i.offset().top + i.outerHeight();
      t.popups.show("image.edit", u, f, i.outerHeight())
    }

    function ui() {
      l()
    }

    function fi(n) {
      if (!n.hasClass("fr-dii") && !n.hasClass("fr-dib")) {
        var i = n.css("float");
        n.css("float", "none");
        "block" == n.css("display") ? (n.css("float", i), t.opts.imageEditButtons.indexOf("imageAlign") >= 0 && (0 === parseInt(n.css("margin-left"), 10) && (n.attr("style") || "").indexOf("margin-right: auto") >= 0 ? n.addClass("fr-fil") : 0 === parseInt(n.css("margin-right"), 10) && (n.attr("style") || "").indexOf("margin-left: auto") >= 0 && n.addClass("fr-fir")), n.addClass("fr-dib")) : (n.css("float", i), t.opts.imageEditButtons.indexOf("imageAlign") >= 0 && ("left" == n.css("float") ? n.addClass("fr-fil") : "right" == n.css("float") && n.addClass("fr-fir")), n.addClass("fr-dii"));
        n.css("margin", "");
        n.css("float", "");
        n.css("display", "");
        n.css("z-index", "");
        n.css("position", "");
        n.css("overflow", "");
        n.css("vertical-align", "")
      }
    }

    function ut() {
      for (var i, u = "IMG" == t.$el.get(0).tagName ? [t.$el.get(0)] : t.$el.get(0).querySelectorAll("img"), r = 0; r < u.length; r++) i = n(u[r]), (t.opts.imageEditButtons.indexOf("imageAlign") >= 0 || t.opts.imageEditButtons.indexOf("imageDisplay") >= 0) && fi(i), i.attr("width") && (i.css("width", i.width()), i.removeAttr("width")), t.opts.imageTextNear || i.removeClass("fr-dii").addClass("fr-dib"), t.opts.iframe && i.on("load", t.size.syncIframe)
    }

    function k() {
      for (var r = Array.prototype.slice.call(t.$el.get(0).querySelectorAll("img")), u = [], i = 0; i < r.length; i++) u.push(r[i].getAttribute("src")), n(r[i]).toggleClass("fr-draggable", t.opts.imageMove), "" === r[i].className && r[i].removeAttribute("class"), "" === r[i].getAttribute("style") && r[i].removeAttribute("style");
      if (p)
        for (i = 0; i < p.length; i++) u.indexOf(p[i].getAttribute("src")) < 0 && t.events.trigger("image.removed", [n(p[i])]);
      p = r
    }

    function o() {
      var u, f, e;
      r || or();
      u = t.$wp || n(t.opts.scrollableContainer);
      u.append(r);
      r.data("instance", t);
      f = u.scrollTop() - ("static" != u.css("position") ? u.offset().top : 0);
      e = u.scrollLeft() - ("static" != u.css("position") ? u.offset().left : 0);
      e -= t.helpers.getPX(u.css("border-left-width"));
      f -= t.helpers.getPX(u.css("border-top-width"));
      r.css("top", (t.opts.iframe ? i.offset().top : i.offset().top + f) - 1).css("left", (t.opts.iframe ? i.offset().left : i.offset().left + e) - 1).css("width", i.get(0).getBoundingClientRect().width).css("height", i.get(0).getBoundingClientRect().height).addClass("fr-active")
    }

    function d(n) {
      return '<div class="fr-handler fr-h' + n + '"><\/div>'
    }

    function ei(f) {
      var e, o;
      if (!t.core.sameInstance(r)) return !0;
      if (f.preventDefault(), f.stopPropagation(), t.$el.find("img.fr-error").left) return !1;
      t.undo.canDo() || t.undo.saveStep();
      u = n(this);
      u.data("start-x", f.pageX || f.originalEvent.touches[0].pageX);
      u.data("start-width", i.width());
      u.data("start-height", i.height());
      e = i.width();
      t.opts.imageResizeWithPercent ? (o = i.parentsUntil(t.$el, t.html.blockTagsQuery()).get(0) || t.$el.get(0), i.css("width", (e / n(o).outerWidth() * 100).toFixed(2) + "%")) : i.css("width", e);
      s.show();
      t.popups.hideAll();
      ot()
    }

    function oi(f) {
      var h, c;
      if (!t.core.sameInstance(r)) return !0;
      if (u && i) {
        if ((f.preventDefault(), t.$el.find("img.fr-error").left) || (h = f.pageX || (f.originalEvent.touches ? f.originalEvent.touches[0].pageX : null), !h)) return !1;
        var l = u.data("start-x"),
          s = h - l,
          e = u.data("start-width");
        ((u.hasClass("fr-hnw") || u.hasClass("fr-hsw")) && (s = 0 - s), t.opts.imageResizeWithPercent) ? (c = i.parentsUntil(t.$el, t.html.blockTagsQuery()).get(0) || t.$el.get(0), e = ((e + s) / n(c).outerWidth() * 100).toFixed(2), t.opts.imageRoundPercent && (e = Math.round(e)), i.css("width", e + "%"), i.css("height", "").removeAttr("height")) : (e + s >= t.opts.imageMinWidth && i.css("width", e + s), i.css("height", u.data("start-height") * i.width() / u.data("start-width")));
        o();
        t.events.trigger("image.resize", [tt()])
      }
    }

    function ht(n) {
      if (!t.core.sameInstance(r)) return !0;
      if (u && i) {
        if (n && n.stopPropagation(), t.$el.find("img.fr-error").left) return !1;
        u = null;
        s.hide();
        o();
        v();
        t.undo.saveStep();
        t.events.trigger("image.resizeEnd", [tt()])
      }
    }

    function f(n, r) {
      t.edit.on();
      i && i.addClass("fr-error");
      si(t.language.translate("Something went wrong. Please try again."));
      t.events.trigger("image.error", [{
        code: n,
        message: h[n]
      }, r])
    }

    function ct(n) {
      var r, u, f;
      return n ? (t.$wp && t.events.$on(t.$wp, "scroll", function() {
        i && t.popups.isVisible("image.edit") && v()
      }), !0) : (r = "", t.opts.imageEditButtons.length > 0 && (r += '<div class="fr-buttons">', r += t.button.buildList(t.opts.imageEditButtons), r += "<\/div>"), u = {
        buttons: r
      }, f = t.popups.create("image.edit", u), f)
    }

    function c(r) {
      var u = t.popups.get("image.insert"),
        f, e;
      (u || (u = b()), u.find(".fr-layer.fr-active").removeClass("fr-active").addClass("fr-pactive"), u.find(".fr-image-progress-bar-layer").addClass("fr-active"), u.find(".fr-buttons").hide(), i) && (t.popups.setContainer("image.insert", n(t.opts.scrollableContainer)), f = i.offset().left + i.width() / 2, e = i.offset().top + i.height(), t.popups.show("image.insert", f, e, i.outerHeight()));
      "undefined" == typeof r && w("Uploading", 0)
    }

    function l(n) {
      var i = t.popups.get("image.insert");
      i && (i.find(".fr-layer.fr-pactive").addClass("fr-active").removeClass("fr-pactive"), i.find(".fr-image-progress-bar-layer").removeClass("fr-active"), i.find(".fr-buttons").show(), (n || t.$el.find("img.fr-error").length) && (t.events.focus(), t.$el.find("img.fr-error").remove(), t.undo.saveStep(), t.undo.run(), t.undo.dropRedo()))
    }

    function w(n, i) {
      var u = t.popups.get("image.insert"),
        r;
      u && (r = u.find(".fr-image-progress-bar-layer"), r.find("h3").text(n + (i ? " " + i + "%" : "")), r.removeClass("fr-error"), i ? (r.find("div").removeClass("fr-indeterminate"), r.find("div > span").css("width", i + "%")) : r.find("div").addClass("fr-indeterminate"))
    }

    function si(n) {
      c();
      var r = t.popups.get("image.insert"),
        i = r.find(".fr-image-progress-bar-layer");
      i.addClass("fr-error");
      i.find("h3").text(n)
    }

    function hi() {
      var r = t.popups.get("image.insert"),
        n = r.find(".fr-image-by-url-layer input");
      n.val().length > 0 && (c(), w("Loading image"), g(t.helpers.sanitizeURL(n.val()), !0, [], i), n.val(""), n.blur())
    }

    function e(n) {
      bt.call(n.get(0))
    }

    function lt() {
      var i = n(this);
      t.popups.hide("image.insert");
      i.removeClass("fr-uploading");
      i.next().is("br") && i.next().remove();
      e(i);
      t.events.trigger("image.loaded", [i])
    }

    function g(n, i, r, u, e) {
      t.edit.off();
      w("Loading image");
      var o = new Image;
      o.onload = function() {
        var i, f, o, h, s, c;
        if (u) {
          for (o = u.data("fr-old-src"), t.$wp ? (i = u.clone().removeData("fr-old-src").removeClass("fr-uploading"), i.off("load"), o && u.attr("src", o), u.replaceWith(i)) : i = u, h = i.get(0).attributes, s = 0; s < h.length; s++) c = h[s], 0 === c.nodeName.indexOf("data-") && i.removeAttr(c.nodeName);
          if ("undefined" != typeof r)
            for (f in r) r.hasOwnProperty(f) && "link" != f && i.attr("data-" + f, r[f]);
          i.on("load", lt);
          i.attr("src", n);
          t.edit.on();
          k();
          t.undo.saveStep();
          t.events.trigger(o ? "image.replaced" : "image.inserted", [i, e])
        } else i = at(n, r, lt), k(), t.undo.saveStep(), t.events.trigger("image.inserted", [i, e])
      };
      o.onerror = function() {
        f(kt)
      };
      o.src = n
    }

    function ci(i) {
      try {
        if (t.events.trigger("image.uploaded", [i], !0) === !1) return t.edit.on(), !1;
        var r = n.parseJSON(i);
        return r.link ? r : (f(dt, i), !1)
      } catch (u) {
        return f(y, i), !1
      }
    }

    function li(i) {
      try {
        var r = n(i).find("Location").text(),
          u = n(i).find("Key").text();
        return t.events.trigger("image.uploadedToS3", [r, u, i], !0) === !1 ? (t.edit.on(), !1) : r
      } catch (e) {
        return f(y, i), !1
      }
    }

    function ai(n) {
      var s, u;
      w("Loading image");
      var e = this.status,
        i = this.response,
        o = this.responseXML,
        r = this.responseText;
      try {
        t.opts.imageUploadToS3 ? 201 == e ? (s = li(o), s && g(s, !1, [], n, i || o)) : f(y, i || o) : e >= 200 && 300 > e ? (u = ci(r), u && g(u.link, !1, u, n, i || r)) : f(gt, i || r)
      } catch (h) {
        f(y, i || r)
      }
    }

    function vi() {
      f(y, this.response || this.responseText || this.responseXML)
    }

    function yi(n) {
      if (n.lengthComputable) {
        var t = n.loaded / n.total * 100 | 0;
        w("Uploading", t)
      }
    }

    function at(i, r, u) {
      var e, s = "",
        f, o, h;
      if (r && "undefined" != typeof r)
        for (e in r) r.hasOwnProperty(e) && "link" != e && (s += " data-" + e + '="' + r[e] + '"');
      return f = t.opts.imageDefaultWidth, f && "auto" != f && ("" + f).indexOf("px") < 0 && ("" + f).indexOf("%") < 0 && (f += "px"), o = n('<img class="' + (t.opts.imageDefaultDisplay ? "fr-di" + t.opts.imageDefaultDisplay[0] : "") + (t.opts.imageDefaultAlign && "center" != t.opts.imageDefaultAlign ? " fr-fi" + t.opts.imageDefaultAlign[0] : "") + '" src="' + i + '"' + s + (f ? ' style="width: ' + f + ';"' : "") + ">"), o.on("load", u), t.edit.on(), t.events.focus(!0), t.selection.restore(), t.undo.saveStep(), t.opts.imageSplitHTML ? t.markers.split() : t.markers.insert(), h = t.$el.find(".fr-marker"), h.replaceWith(o), t.html.wrap(), t.selection.clear(), o
    }

    function pi() {
      t.edit.on();
      l(!0)
    }

    function wi(r, u, f) {
      function h() {
        var f = n(this);
        f.off("load");
        f.addClass("fr-uploading");
        f.next().is("br") && f.next().remove();
        t.placeholder.refresh();
        f.is(i) || e(f);
        o();
        c();
        t.edit.off();
        r.onload = function() {
          ai.call(r, f)
        };
        r.onerror = vi;
        r.upload.onprogress = yi;
        r.onabort = pi;
        f.off("abortUpload").on("abortUpload", function() {
          4 != r.readyState && r.abort()
        });
        r.send(u)
      }
      var l, s = new FileReader;
      s.addEventListener("load", function() {
        var n = s.result;
        if (s.result.indexOf("svg+xml") < 0) {
          for (var u = atob(s.result.split(",")[1]), f = [], r = 0; r < u.length; r++) f.push(u.charCodeAt(r));
          n = window.URL.createObjectURL(new Blob([new Uint8Array(f)], {
            type: "image/jpeg"
          }))
        }
        i ? (i.on("load", h), t.edit.on(), t.undo.saveStep(), i.data("fr-old-src", i.attr("src")), i.attr("src", n)) : l = at(n, null, h)
      }, !1);
      s.readAsDataURL(f)
    }

    function ft(n) {
      var u, i, r, e, o;
      if (t.events.trigger("image.beforeUpload", [n]) === !1) return !1;
      if ("undefined" != typeof n && n.length > 0) {
        if (u = n[0], u.size > t.opts.imageMaxSize) return f(ni), !1;
        if (t.opts.imageAllowedTypes.indexOf(u.type.replace(/image\//g, "")) < 0) return f(ti), !1;
        if (t.drag_support.formdata && (i = t.drag_support.formdata ? new FormData : null), i) {
          if (t.opts.imageUploadToS3 !== !1) {
            i.append("key", t.opts.imageUploadToS3.keyStart + (new Date).getTime() + "-" + (u.name || "untitled"));
            i.append("success_action_status", "201");
            i.append("X-Requested-With", "xhr");
            i.append("Content-Type", u.type);
            for (r in t.opts.imageUploadToS3.params) t.opts.imageUploadToS3.params.hasOwnProperty(r) && i.append(r, t.opts.imageUploadToS3.params[r])
          }
          for (r in t.opts.imageUploadParams) t.opts.imageUploadParams.hasOwnProperty(r) && i.append(r, t.opts.imageUploadParams[r]);
          i.append(t.opts.imageUploadParam, u);
          e = t.opts.imageUploadURL;
          t.opts.imageUploadToS3 && (e = "https://" + t.opts.imageUploadToS3.region + ".amazonaws.com/" + t.opts.imageUploadToS3.bucket);
          o = t.core.getXHR(e, t.opts.imageUploadMethod);
          wi(o, i, u)
        }
      }
    }

    function bi(i) {
      t.events.$on(i, "dragover dragenter", ".fr-image-upload-layer", function() {
        return n(this).addClass("fr-drop"), !1
      });
      t.events.$on(i, "dragleave dragend", ".fr-image-upload-layer", function() {
        return n(this).removeClass("fr-drop"), !1
      });
      t.events.$on(i, "drop", ".fr-image-upload-layer", function(r) {
        var u, f;
        r.preventDefault();
        r.stopPropagation();
        n(this).removeClass("fr-drop");
        u = r.originalEvent.dataTransfer;
        u && u.files && (f = i.data("instance") || t, f.events.disableBlur(), f.image.upload(u.files), f.events.enableBlur())
      });
      t.events.$on(i, "change", '.fr-image-upload-layer input[type="file"]', function() {
        if (this.files) {
          var r = i.data("instance") || t;
          r.events.disableBlur();
          i.find("input:focus").blur();
          r.events.enableBlur();
          r.image.upload(this.files)
        }
        n(this).val("")
      })
    }

    function ki(i) {
      var r = i.originalEvent.dataTransfer,
        u, f;
      if (r && r.files && r.files.length && (u = r.files[0], u && u.type && t.opts.imageAllowedTypes.indexOf(u.type.replace(/image\//g, "")) >= 0)) return t.markers.remove(), t.markers.insertAtPoint(i.originalEvent), t.$el.find(".fr-marker").replaceWith(n.FE.MARKERS), t.popups.hideAll(), f = t.popups.get("image.insert"), f || (f = b()), t.popups.setContainer("image.insert", n(t.opts.scrollableContainer)), t.popups.show("image.insert", i.originalEvent.pageX, i.originalEvent.pageY), c(), ft(r.files), i.preventDefault(), i.stopPropagation(), !1
    }

    function di() {
      var i, r, u = t.selection.ranges(0);
      u.collapsed && u.startContainer.nodeType == Node.ELEMENT_NODE && (u.startContainer.childNodes.length == u.startOffset ? (i = u.startContainer.childNodes[u.startOffset - 1], i && "IMG" == i.tagName && "block" == n(i).css("display") && (r = t.node.blockParent(i), r && t.html.defaultTag() ? r.nextSibling || (["TD", "TH"].indexOf(r.tagName) < 0 ? n(r).after("<" + t.html.defaultTag() + "><br>" + n.FE.MARKERS + "<\/" + t.html.defaultTag() + ">") : n(img).after("<br>" + n.FE.MARKERS), t.selection.restore()) : r || (n(i).after("<br>" + n.FE.MARKERS), t.selection.restore()))) : 0 === u.startOffset && u.startContainer.childNodes.length > u.startOffset && (i = u.startContainer.childNodes[u.startOffset], i && "IMG" == i.tagName && "block" == n(i).css("display") && (r = t.node.blockParent(i), r && t.html.defaultTag() ? r.previousSibling || (["TD", "TH"].indexOf(r.tagName) < 0 ? n(r).before("<" + t.html.defaultTag() + "><br>" + n.FE.MARKERS + "<\/" + t.html.defaultTag() + ">") : n(img).before("<br>" + n.FE.MARKERS), t.selection.restore()) : r || (n(i).before(n.FE.MARKERS + "<br>"), t.selection.restore()))))
    }

    function gi() {
      t.events.$on(t.$el, t._mousedown, "IMG" == t.$el.get(0).tagName ? null : 'img:not([contenteditable="false"])', function(i) {
        return n(this).parents('[contenteditable="false"]:not(.fr-element):not(body)').length ? !0 : (t.selection.clear(), it = !0, t.browser.msie && (t.events.disableBlur(), t.$el.attr("contenteditable", !1)), t.draggable || i.preventDefault(), void i.stopPropagation())
      });
      t.events.$on(t.$el, t._mouseup, "IMG" == t.$el.get(0).tagName ? null : 'img:not([contenteditable="false"])', function(i) {
        return n(this).parents('[contenteditable="false"]:not(.fr-element):not(body)').length ? !0 : void(it && (it = !1, i.stopPropagation(), t.browser.msie && (t.$el.attr("contenteditable", !0), t.events.enableBlur())))
      });
      t.events.on("keyup", function(i) {
        if (i.shiftKey && "" === t.selection.text().replace(/\n/g, "")) {
          var r = t.selection.element(),
            u = t.selection.endElement();
          r && "IMG" == r.tagName ? e(n(r)) : u && "IMG" == u.tagName && e(n(u))
        }
      }, !0);
      t.events.on("drop", ki);
      t.events.on("mousedown window.mousedown", ar);
      t.events.on("window.touchmove", ot);
      t.events.on("mouseup window.mouseup", function() {
        if (i) return (a(), !1)
      });
      t.events.on("commands.mousedown", function(n) {
        n.parents(".fr-toolbar").length > 0 && a()
      });
      t.events.on("mouseup", di);
      t.events.on("blur image.hideResizer commands.undo commands.redo element.dropped", function() {
        it = !1;
        a(!0)
      })
    }

    function b(n) {
      var r, e, o;
      if (n) return t.popups.onRefresh("image.insert", ii), t.popups.onHide("image.insert", ui), !0;
      e = "";
      t.opts.imageInsertButtons.length > 1 && (e = '<div class="fr-buttons">' + t.button.buildList(t.opts.imageInsertButtons) + "<\/div>");
      var u = t.opts.imageInsertButtons.indexOf("imageUpload"),
        f = t.opts.imageInsertButtons.indexOf("imageByURL"),
        s = "";
      u >= 0 && (r = " fr-active", f >= 0 && u > f && (r = ""), s = '<div class="fr-image-upload-layer' + r + ' fr-layer" id="fr-image-upload-layer-' + t.id + '"><strong>' + t.language.translate("Drop image") + "<\/strong><br>(" + t.language.translate("or click") + ')<div class="fr-form"><input type="file" accept="image/' + t.opts.imageAllowedTypes.join(", image/").toLowerCase() + '" tabIndex="-1"><\/div><\/div>');
      o = "";
      f >= 0 && (r = " fr-active", u >= 0 && f > u && (r = ""), o = '<div class="fr-image-by-url-layer' + r + ' fr-layer" id="fr-image-by-url-layer-' + t.id + '"><div class="fr-input-line"><input type="text" placeholder="http://" tabIndex="1"><\/div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageInsertByURL" tabIndex="2">' + t.language.translate("Insert") + "<\/button><\/div><\/div>");
      var c = {
          buttons: e,
          upload_layer: s,
          by_url_layer: o,
          progress_bar: '<div class="fr-image-progress-bar-layer fr-layer"><h3 class="fr-message">Uploading<\/h3><div class="fr-loader"><span class="fr-progress"><\/span><\/div><div class="fr-action-buttons"><button type="button" class="fr-command fr-back" data-cmd="imageDismissError" tabIndex="2">OK<\/button><\/div><\/div>'
        },
        h = t.popups.create("image.insert", c);
      return t.$wp && t.events.$on(t.$wp, "scroll", function() {
        i && t.popups.isVisible("image.insert") && nt()
      }), bi(h), h
    }

    function nr() {
      if (i) {
        var n = t.popups.get("image.alt");
        n.find("input").val(i.attr("alt") || "").trigger("change")
      }
    }

    function vt() {
      var r = t.popups.get("image.alt"),
        u, f;
      r || (r = yt());
      l();
      t.popups.refresh("image.alt");
      t.popups.setContainer("image.alt", n(t.opts.scrollableContainer));
      u = i.offset().left + i.width() / 2;
      f = i.offset().top + i.height();
      t.popups.show("image.alt", u, f, i.outerHeight())
    }

    function yt(n) {
      var r, u, f, e;
      return n ? (t.popups.onRefresh("image.alt", nr), !0) : (r = "", r = '<div class="fr-buttons">' + t.button.buildList(t.opts.imageAltButtons) + "<\/div>", u = "", u = '<div class="fr-image-alt-layer fr-layer fr-active" id="fr-image-alt-layer-' + t.id + '"><div class="fr-input-line"><input type="text" placeholder="' + t.language.translate("Alternate Text") + '" tabIndex="1"><\/div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageSetAlt" tabIndex="2">' + t.language.translate("Update") + "<\/button><\/div><\/div>", f = {
        buttons: r,
        alt_layer: u
      }, e = t.popups.create("image.alt", f), t.$wp && t.events.$on(t.$wp, "scroll.image-alt", function() {
        i && t.popups.isVisible("image.alt") && vt()
      }), e)
    }

    function tr(n) {
      if (i) {
        var r = t.popups.get("image.alt");
        i.attr("alt", n || r.find("input").val() || "");
        r.find("input:focus").blur();
        e(i)
      }
    }

    function ir() {
      if (i) {
        var n = t.popups.get("image.size");
        n.find('input[name="width"]').val(i.get(0).style.width).trigger("change");
        n.find('input[name="height"]').val(i.get(0).style.height).trigger("change")
      }
    }

    function pt() {
      var r = t.popups.get("image.size"),
        u, f;
      r || (r = wt());
      l();
      t.popups.refresh("image.size");
      t.popups.setContainer("image.size", n(t.opts.scrollableContainer));
      u = i.offset().left + i.width() / 2;
      f = i.offset().top + i.height();
      t.popups.show("image.size", u, f, i.outerHeight())
    }

    function wt(n) {
      var r, u, f, e;
      return n ? (t.popups.onRefresh("image.size", ir), !0) : (r = "", r = '<div class="fr-buttons">' + t.button.buildList(t.opts.imageSizeButtons) + "<\/div>", u = "", u = '<div class="fr-image-size-layer fr-layer fr-active" id="fr-image-size-layer-' + t.id + '"><div class="fr-image-group"><div class="fr-input-line"><input type="text" name="width" placeholder="' + t.language.translate("Width") + '" tabIndex="1"><\/div><div class="fr-input-line"><input type="text" name="height" placeholder="' + t.language.translate("Height") + '" tabIndex="1"><\/div><\/div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageSetSize" tabIndex="2">' + t.language.translate("Update") + "<\/button><\/div><\/div>", f = {
        buttons: r,
        size_layer: u
      }, e = t.popups.create("image.size", f), t.$wp && t.events.$on(t.$wp, "scroll.image-size", function() {
        i && t.popups.isVisible("image.size") && pt()
      }), e)
    }

    function rr(n, r) {
      if (i) {
        var u = t.popups.get("image.size");
        i.css("width", n || u.find('input[name="width"]').val());
        i.css("height", r || u.find('input[name="height"]').val());
        u.find("input:focus").blur();
        e(i)
      }
    }

    function ur(n) {
      var e, u, r = t.popups.get("image.insert"),
        f;
      i || t.opts.toolbarInline ? i && (u = i.offset().top + i.outerHeight()) : (f = t.$tb.find('.fr-command[data-cmd="insertImage"]'), e = f.offset().left + f.outerWidth() / 2, u = f.offset().top + (t.opts.toolbarBottom ? 10 : f.outerHeight() - 10));
      !i && t.opts.toolbarInline && (u = r.offset().top - t.helpers.getPX(r.css("margin-top")), r.hasClass("fr-above") && (u += r.outerHeight()));
      r.find(".fr-layer").removeClass("fr-active");
      r.find(".fr-" + n + "-layer").addClass("fr-active");
      t.popups.show("image.insert", e, u, i ? i.outerHeight() : 0)
    }

    function fr(n) {
      var i = t.popups.get("image.insert");
      i.find(".fr-image-upload-layer").hasClass("fr-active") && n.addClass("fr-active")
    }

    function er(n) {
      var i = t.popups.get("image.insert");
      i.find(".fr-image-by-url-layer").hasClass("fr-active") && n.addClass("fr-active")
    }

    function or() {
      var u;
      t.shared.$image_resizer ? (r = t.shared.$image_resizer, s = t.shared.$img_overlay, t.events.on("destroy", function() {
        r.removeClass("fr-active").appendTo(n("body"))
      }, !0)) : (t.shared.$image_resizer = n('<div class="fr-image-resizer"><\/div>'), r = t.shared.$image_resizer, t.events.$on(r, "mousedown", function(n) {
        n.stopPropagation()
      }, !0), t.opts.imageResize && (r.append(d("nw") + d("ne") + d("sw") + d("se")), t.shared.$img_overlay = n('<div class="fr-image-overlay"><\/div>'), s = t.shared.$img_overlay, u = r.get(0).ownerDocument, n(u).find("body").append(s)));
      t.events.on("shared.destroy", function() {
        r.html("").removeData().remove();
        r = null;
        t.opts.imageResize && (s.remove(), s = null)
      }, !0);
      t.helpers.isMobile() || t.events.$on(n(t.o_win), "resize", function() {
        i && !i.hasClass("fr-uploading") ? a(!0) : i && (o(), nt(), c(!1))
      });
      t.opts.imageResize && (u = r.get(0).ownerDocument, t.events.$on(r, t._mousedown, ".fr-handler", ei), t.events.$on(n(u), t._mousemove, oi), t.events.$on(n(u.defaultView || u.parentWindow), t._mouseup, ht), t.events.$on(s, "mouseleave", ht))
    }

    function et(r) {
      r = r || i;
      r && t.events.trigger("image.beforeRemove", [r]) !== !1 && (t.popups.hideAll(), a(!0), r.get(0) == t.$el.get(0) ? r.removeAttr("src") : ("A" == r.get(0).parentNode.tagName ? (t.selection.setBefore(r.get(0).parentNode) || t.selection.setAfter(r.get(0).parentNode) || r.parent().after(n.FE.MARKERS), n(r.get(0).parentNode).remove()) : (t.selection.setBefore(r.get(0)) || t.selection.setAfter(r.get(0)) || r.after(n.FE.MARKERS), r.remove()), t.html.fillEmptyBlocks(), t.selection.restore()), t.undo.saveStep())
    }

    function sr() {
      if (gi(), "IMG" == t.$el.get(0).tagName && t.$el.addClass("fr-view"), t.events.$on(t.$el, t.helpers.isMobile() && !t.helpers.isWindowsPhone() ? "touchend" : "click", "IMG" == t.$el.get(0).tagName ? null : 'img:not([contenteditable="false"])', bt), t.helpers.isMobile() && (t.events.$on(t.$el, "touchstart", "IMG" == t.$el.get(0).tagName ? null : 'img:not([contenteditable="false"])', function() {
          st = !1
        }), t.events.$on(t.$el, "touchmove", function() {
          st = !0
        })), t.events.on("window.keydown keydown", function(r) {
          var u = r.which,
            f;
          return i && (u == n.FE.KEYCODE.BACKSPACE || u == n.FE.KEYCODE.DELETE) ? (r.preventDefault(), r.stopPropagation(), et(), !1) : i && u == n.FE.KEYCODE.ESC ? (f = i, a(!0), t.selection.setAfter(f.get(0)), t.selection.restore(), r.preventDefault(), !1) : i && !t.keys.ctrlKey(r) ? (r.preventDefault(), !1) : void 0
        }, !0), t.events.$on(n(t.o_win), "keydown", function(t) {
          var r = t.which;
          if (i && r == n.FE.KEYCODE.BACKSPACE) return (t.preventDefault(), !1)
        }), t.events.$on(t.$win, "keydown", function(t) {
          var r = t.which;
          i && i.hasClass("fr-uploading") && r == n.FE.KEYCODE.ESC && i.trigger("abortUpload")
        }), t.events.on("destroy", function() {
          i && i.hasClass("fr-uploading") && i.trigger("abortUpload")
        }), t.events.on("paste.before", cr), t.events.on("paste.beforeCleanup", lr), t.events.on("paste.after", hr), t.events.on("html.set", ut), t.events.on("html.inserted", ut), ut(), t.events.on("destroy", function() {
          p = []
        }), t.events.on("html.get", function(n) {
          return n.replace(/<(img)((?:[\w\W]*?))class="([\w\W]*?)(fr-uploading|fr-error)([\w\W]*?)"((?:[\w\W]*?))>/g, "")
        }), t.opts.imageOutputSize) {
        var r;
        t.events.on("html.beforeGet", function() {
          r = t.$el.get(0).querySelectorAll("img");
          for (var i = 0; i < r.length; i++) r[i].setAttribute("width", n(r[i]).width()), r[i].setAttribute("height", n(r[i]).height())
        });
        t.events.on("html.afterGet", function() {
          for (var n = 0; n < r.length; n++) r[n].removeAttribute("width"), r[n].removeAttribute("height")
        })
      }
      t.opts.iframe && t.events.on("image.loaded", t.size.syncIframe);
      t.$wp && (k(), t.events.on("contentChanged", k));
      t.events.$on(n(t.o_win), "orientationchange.image", function() {
        setTimeout(function() {
          var n = tt();
          n && e(n)
        }, 0)
      });
      ct(!0);
      b(!0);
      wt(!0);
      yt(!0);
      t.events.on("node.remove", function(n) {
        if ("IMG" == n.get(0).tagName) return (et(n), !1)
      })
    }

    function hr() {
      t.opts.imagePaste ? t.$el.find("img[data-fr-image-pasted]").each(function(r, u) {
        var f, l;
        if (t.opts.imagePasteProcess && (f = t.opts.imageDefaultWidth, f && "auto" != f && (f += t.opts.imageResizeWithPercent ? "%" : "px"), n(u).css("width", f), n(u).removeClass("fr-dii fr-dib fr-fir fr-fil").addClass((t.opts.imageDefaultDisplay ? "fr-di" + t.opts.imageDefaultDisplay[0] : "") + (t.opts.imageDefaultAlign && "center" != t.opts.imageDefaultAlign ? " fr-fi" + t.opts.imageDefaultAlign[0] : ""))), 0 === u.src.indexOf("data:")) {
          if (t.events.trigger("image.beforePasteUpload", [u]) === !1) return !1;
          i = n(u);
          o();
          v();
          nt();
          c();
          t.edit.off();
          for (var s = atob(n(u).attr("src").split(",")[1]), h = [], e = 0; e < s.length; e++) h.push(s.charCodeAt(e));
          l = new Blob([new Uint8Array(h)], {
            type: "image/jpeg"
          });
          ft([l]);
          n(u).removeAttr("data-fr-image-pasted")
        } else 0 !== u.src.indexOf("http") ? (t.selection.save(), n(u).remove(), t.selection.restore()) : n(u).removeAttr("data-fr-image-pasted")
      }) : t.$el.find("img[data-fr-image-pasted]").remove()
    }

    function cr(n) {
      var i, r;
      if (n && n.clipboardData && n.clipboardData.items && n.clipboardData.items[0] && (i = n.clipboardData.items[0].getAsFile(), i)) return r = new FileReader, r.onload = function(n) {
        var r = n.target.result,
          i = t.opts.imageDefaultWidth;
        i && "auto" != i && ("" + i).indexOf("px") < 0 && ("" + i).indexOf("%") < 0 && (i += "px");
        t.html.insert('<img data-fr-image-pasted="true" class="' + (t.opts.imageDefaultDisplay ? "fr-di" + t.opts.imageDefaultDisplay[0] : "") + (t.opts.imageDefaultAlign && "center" != t.opts.imageDefaultAlign ? " fr-fi" + t.opts.imageDefaultAlign[0] : "") + '" src="' + r + '"' + (i ? ' style="width: ' + i + ';"' : "") + ">");
        t.events.trigger("paste.after")
      }, r.readAsDataURL(i), !1
    }

    function lr(n) {
      return n.replace(/<img /gi, '<img data-fr-image-pasted="true" ')
    }

    function bt(r) {
      if (n(this).parents('[contenteditable="false"]:not(.fr-element):not(body)').length || r && "touchend" == r.type && st) return !0;
      if (r && t.edit.isDisabled()) return r.stopPropagation(), r.preventDefault(), !1;
      for (var u = 0; u < n.FE.INSTANCES.length; u++) n.FE.INSTANCES[u] != t && n.FE.INSTANCES[u].events.trigger("image.hideResizer");
      t.toolbar.disable();
      r && (r.stopPropagation(), r.preventDefault());
      t.helpers.isMobile() && (t.events.disableBlur(), t.$el.blur(), t.events.enableBlur());
      t.opts.iframe && t.size.syncIframe();
      i = n(this);
      dr();
      o();
      v();
      t.selection.clear();
      t.button.bulkRefresh();
      t.events.trigger("video.hideResizer")
    }

    function a(n) {
      i && (vr() || n === !0) && (t.toolbar.enable(), r.removeClass("fr-active"), t.popups.hide("image.edit"), i = null, ot())
    }

    function ar() {
      rt = !0
    }

    function ot() {
      rt = !1
    }

    function vr() {
      return rt
    }

    function yr(n) {
      i.removeClass("fr-fir fr-fil");
      "left" == n ? i.addClass("fr-fil") : "right" == n && i.addClass("fr-fir");
      o();
      v()
    }

    function pr(n) {
      i && (i.hasClass("fr-fil") ? n.find("> *:first").replaceWith(t.icon.create("align-left")) : i.hasClass("fr-fir") ? n.find("> *:first").replaceWith(t.icon.create("align-right")) : n.find("> *:first").replaceWith(t.icon.create("align-justify")))
    }

    function wr(n, t) {
      if (i) {
        var r = "justify";
        i.hasClass("fr-fil") ? r = "left" : i.hasClass("fr-fir") && (r = "right");
        t.find('.fr-command[data-param1="' + r + '"]').addClass("fr-active")
      }
    }

    function br(n) {
      i.removeClass("fr-dii fr-dib");
      "inline" == n ? i.addClass("fr-dii") : "block" == n && i.addClass("fr-dib");
      o();
      v()
    }

    function kr(n, t) {
      var r = "block";
      i.hasClass("fr-dii") && (r = "inline");
      t.find('.fr-command[data-param1="' + r + '"]').addClass("fr-active")
    }

    function nt() {
      var r = t.popups.get("image.insert"),
        u, f;
      r || (r = b());
      t.popups.isVisible("image.insert") || (l(), t.popups.refresh("image.insert"), t.popups.setContainer("image.insert", n(t.opts.scrollableContainer)));
      u = i.offset().left + i.width() / 2;
      f = i.offset().top + i.height();
      t.popups.show("image.insert", u, f, i.outerHeight())
    }

    function dr() {
      var n, r;
      i && (t.selection.clear(), n = t.doc.createRange(), n.selectNode(i.get(0)), r = t.selection.get(), r.addRange(n))
    }

    function gr() {
      i ? (n(".fr-popup input:focus").blur(), e(i)) : (t.events.disableBlur(), t.selection.restore(), t.events.enableBlur(), t.popups.hide("image.insert"), t.toolbar.showInline())
    }

    function tt() {
      return i
    }

    function nu(n, r, u) {
      if ("undefined" == typeof r && (r = t.opts.imageStyles), "undefined" == typeof u && (u = t.opts.imageMultipleStyles), !i) return !1;
      if (!u) {
        var f = Object.keys(r);
        f.splice(f.indexOf(n), 1);
        i.removeClass(f.join(" "))
      }
      i.toggleClass(n);
      e(i)
    }
    var i, r, u, s, it = !1,
      kt = 1,
      dt = 2,
      gt = 3,
      y = 4,
      ni = 5,
      ti = 6,
      h = {},
      p, st, rt;
    return h[kt] = "Image cannot be loaded from the passed link.", h[dt] = "No link in upload response.", h[gt] = "Error during file upload.", h[y] = "Parsing response failed.", h[ni] = "File is too large.", h[ti] = "Image file type is invalid.", h[7] = "Files can be uploaded only to same domain in IE 8 and IE 9.", rt = !1, {
      _init: sr,
      showInsertPopup: ri,
      showLayer: ur,
      refreshUploadButton: fr,
      refreshByURLButton: er,
      upload: ft,
      insertByURL: hi,
      align: yr,
      refreshAlign: pr,
      refreshAlignOnShow: wr,
      display: br,
      refreshDisplayOnShow: kr,
      replace: nt,
      back: gr,
      get: tt,
      insert: g,
      showProgressBar: c,
      remove: et,
      hideProgressBar: l,
      applyStyle: nu,
      showAltPopup: vt,
      showSizePopup: pt,
      setAlt: tr,
      setSize: rr,
      exitEdit: a,
      edit: e
    }
  };
  n.FE.DefineIcon("insertImage", {
    NAME: "image"
  });
  n.FE.RegisterShortcut(n.FE.KEYCODE.P, "insertImage", null, "P");
  n.FE.RegisterCommand("insertImage", {
    title: "Insert Image",
    undo: !1,
    focus: !0,
    refreshAfterCallback: !1,
    popup: !0,
    callback: function() {
      this.popups.isVisible("image.insert") ? (this.$el.find(".fr-marker") && (this.events.disableBlur(), this.selection.restore()), this.popups.hide("image.insert")) : this.image.showInsertPopup()
    },
    plugin: "image"
  });
  n.FE.DefineIcon("imageUpload", {
    NAME: "upload"
  });
  n.FE.RegisterCommand("imageUpload", {
    title: "Upload Image",
    undo: !1,
    focus: !1,
    callback: function() {
      this.image.showLayer("image-upload")
    },
    refresh: function(n) {
      this.image.refreshUploadButton(n)
    }
  });
  n.FE.DefineIcon("imageByURL", {
    NAME: "link"
  });
  n.FE.RegisterCommand("imageByURL", {
    title: "By URL",
    undo: !1,
    focus: !1,
    callback: function() {
      this.image.showLayer("image-by-url")
    },
    refresh: function(n) {
      this.image.refreshByURLButton(n)
    }
  });
  n.FE.RegisterCommand("imageInsertByURL", {
    title: "Insert Image",
    undo: !0,
    refreshAfterCallback: !1,
    callback: function() {
      this.image.insertByURL()
    },
    refresh: function(n) {
      var t = this.image.get();
      t ? n.text(this.language.translate("Replace")) : n.text(this.language.translate("Insert"))
    }
  });
  n.FE.DefineIcon("imageDisplay", {
    NAME: "star"
  });
  n.FE.RegisterCommand("imageDisplay", {
    title: "Display",
    type: "dropdown",
    options: {
      inline: "Inline",
      block: "Break Text"
    },
    callback: function(n, t) {
      this.image.display(t)
    },
    refresh: function(n) {
      this.opts.imageTextNear || n.addClass("fr-hidden")
    },
    refreshOnShow: function(n, t) {
      this.image.refreshDisplayOnShow(n, t)
    }
  });
  n.FE.DefineIcon("imageAlign", {
    NAME: "align-center"
  });
  n.FE.RegisterCommand("imageAlign", {
    type: "dropdown",
    title: "Align",
    options: {
      left: "Align Left",
      justify: "None",
      right: "Align Right"
    },
    html: function() {
      var r = '<ul class="fr-dropdown-list">',
        i = n.FE.COMMANDS.imageAlign.options;
      for (var t in i) i.hasOwnProperty(t) && (r += '<li><a class="fr-command fr-title" data-cmd="imageAlign" data-param1="' + t + '" title="' + this.language.translate(i[t]) + '">' + this.icon.create("align-" + t) + "<\/a><\/li>");
      return r + "<\/ul>"
    },
    callback: function(n, t) {
      this.image.align(t)
    },
    refresh: function(n) {
      this.image.refreshAlign(n)
    },
    refreshOnShow: function(n, t) {
      this.image.refreshAlignOnShow(n, t)
    }
  });
  n.FE.DefineIcon("imageReplace", {
    NAME: "exchange"
  });
  n.FE.RegisterCommand("imageReplace", {
    title: "Replace",
    undo: !1,
    focus: !1,
    refreshAfterCallback: !1,
    callback: function() {
      this.image.replace()
    }
  });
  n.FE.DefineIcon("imageRemove", {
    NAME: "trash"
  });
  n.FE.RegisterCommand("imageRemove", {
    title: "Remove",
    callback: function() {
      this.image.remove()
    }
  });
  n.FE.DefineIcon("imageBack", {
    NAME: "arrow-left"
  });
  n.FE.RegisterCommand("imageBack", {
    title: "Back",
    undo: !1,
    focus: !1,
    back: !0,
    callback: function() {
      this.image.back()
    },
    refresh: function(n) {
      var t = this.image.get();
      t || this.opts.toolbarInline ? (n.removeClass("fr-hidden"), n.next(".fr-separator").removeClass("fr-hidden")) : (n.addClass("fr-hidden"), n.next(".fr-separator").addClass("fr-hidden"))
    }
  });
  n.FE.RegisterCommand("imageDismissError", {
    title: "OK",
    undo: !1,
    callback: function() {
      this.image.hideProgressBar(!0)
    }
  });
  n.FE.DefineIcon("imageStyle", {
    NAME: "magic"
  });
  n.FE.RegisterCommand("imageStyle", {
    title: "Style",
    type: "dropdown",
    html: function() {
      var i = '<ul class="fr-dropdown-list">',
        n = this.opts.imageStyles;
      for (var t in n) n.hasOwnProperty(t) && (i += '<li><a class="fr-command" data-cmd="imageStyle" data-param1="' + t + '">' + this.language.translate(n[t]) + "<\/a><\/li>");
      return i + "<\/ul>"
    },
    callback: function(n, t) {
      this.image.applyStyle(t)
    },
    refreshOnShow: function(t, i) {
      var r = this.image.get();
      r && i.find(".fr-command").each(function() {
        var t = n(this).data("param1");
        n(this).toggleClass("fr-active", r.hasClass(t))
      })
    }
  });
  n.FE.DefineIcon("imageAlt", {
    NAME: "info"
  });
  n.FE.RegisterCommand("imageAlt", {
    undo: !1,
    focus: !1,
    title: "Alternate Text",
    callback: function() {
      this.image.showAltPopup()
    }
  });
  n.FE.RegisterCommand("imageSetAlt", {
    undo: !0,
    focus: !1,
    title: "Update",
    refreshAfterCallback: !1,
    callback: function() {
      this.image.setAlt()
    }
  });
  n.FE.DefineIcon("imageSize", {
    NAME: "arrows-alt"
  });
  n.FE.RegisterCommand("imageSize", {
    undo: !1,
    focus: !1,
    title: "Change Size",
    callback: function() {
      this.image.showSizePopup()
    }
  });
  n.FE.RegisterCommand("imageSetSize", {
    undo: !0,
    focus: !1,
    title: "Update",
    refreshAfterCallback: !1,
    callback: function() {
      this.image.setSize()
    }
  })
});
/*!
 * froala_editor v2.3.2 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2016 Froala Labs
 */
! function(n) {
  "function" == typeof define && define.amd ? define(["jquery"], n) : "object" == typeof module && module.exports ? module.exports = function(t, i) {
    return void 0 === i && (i = "undefined" != typeof window ? require("jquery") : require("jquery")(t)), n(i), i
  } : n(jQuery)
}(function(n) {
  "use strict";
  n.FE.PLUGINS.lists = function(t) {
    function i(n) {
      return '<span class="fr-open-' + n.toLowerCase() + '"><\/span>'
    }

    function r(n) {
      return '<span class="fr-close-' + n.toLowerCase() + '"><\/span>'
    }

    function o(t, i) {
      for (var f, e, u = [], r = 0; r < t.length; r++) f = t[r].parentNode, "LI" == t[r].tagName && f.tagName != i && u.indexOf(f) < 0 && u.push(f);
      for (r = u.length - 1; r >= 0; r--) e = n(u[r]), e.replaceWith("<" + i.toLowerCase() + ">" + e.html() + "<\/" + i.toLowerCase() + ">")
    }

    function s(i, r) {
      o(i, r);
      for (var f = t.html.defaultTag(), u = 0; u < i.length; u++) "LI" != i[u].tagName && (f && i[u].tagName.toLowerCase() == f ? n(i[u]).replaceWith("<" + r + "><li" + t.node.attributes(i[u]) + ">" + n(i[u]).html() + "<\/li><\/" + r + ">") : n(i[u]).wrap("<" + r + "><li><\/li><\/" + r + ">"));
      t.clean.lists()
    }

    function u(u) {
      for (var h, c, e, o, l, s, f = u.length - 1; f >= 0; f--)
        for (h = f - 1; h >= 0; h--)
          if (n(u[h]).find(u[f]).length || u[h] == u[f]) {
            u.splice(f, 1);
            break
          }
      for (c = [], f = 0; f < u.length; f++) e = n(u[f]), o = u[f].parentNode, e.before(r(o.tagName)), "LI" == o.parentNode.tagName ? (e.before(r("LI")), e.after(i("LI"))) : (t.node.isEmpty(e.get(0), !0) || 0 !== e.find(t.html.blockTagsQuery()).length || e.append("<br>"), e.append(i("LI")), e.prepend(r("LI"))), e.after(i(o.tagName)), "LI" == o.parentNode.tagName && (o = o.parentNode.parentNode), c.indexOf(o) < 0 && c.push(o);
      for (f = 0; f < c.length; f++) l = n(c[f]), s = l.html(), s = s.replace(/<span class="fr-close-([a-z]*)"><\/span>/g, "<\/$1>"), s = s.replace(/<span class="fr-open-([a-z]*)"><\/span>/g, "<$1>"), l.replaceWith(t.node.openTagString(l.get(0)) + s + t.node.closeTagString(l.get(0)));
      t.$el.find("li:empty").remove();
      t.$el.find("ul:empty, ol:empty").remove();
      t.clean.lists();
      t.html.wrap()
    }

    function h(n, t) {
      for (var r = !0, i = 0; i < n.length; i++) {
        if ("LI" != n[i].tagName) return !1;
        n[i].parentNode.tagName != t && (r = !1)
      }
      return r
    }

    function c(n) {
      t.selection.save();
      t.html.wrap(!0, !0, !0, !0);
      t.selection.restore();
      for (var i = t.selection.blocks(), r = 0; r < i.length; r++) "LI" != i[r].tagName && "LI" == i[r].parentNode.tagName && (i[r] = i[r].parentNode);
      t.selection.save();
      h(i, n) ? u(i) : s(i, n);
      t.html.unwrap();
      t.selection.restore()
    }

    function l(i, r) {
      var f = n(t.selection.element()),
        u;
      f.get(0) != t.$el.get(0) && (u = f.get(0), "LI" != u.tagName && (u = f.parents("li").get(0)), u && u.parentNode.tagName == r && t.$el.get(0).contains(u.parentNode) && i.addClass("fr-active"))
    }

    function f(i) {
      var r, f, e, h, u, c, o, s;
      for (t.selection.save(), r = 0; r < i.length; r++)
        if (f = i[r].previousSibling, f)
          if (e = n(i[r]).find("> ul, > ol").get(0), e) {
            for (h = n("<li>").prependTo(n(e)), u = t.node.contents(i[r])[0]; u && !t.node.isList(u);) c = u.nextSibling, h.append(u), u = c;
            n(f).append(n(e));
            n(i[r]).remove()
          } else o = n(f).find("> ul, > ol").get(0), o ? n(o).append(n(i[r])) : (s = n("<" + i[r].parentNode.tagName + ">"), n(f).append(s), s.append(n(i[r])));
      t.clean.lists();
      t.selection.restore()
    }

    function e(n) {
      t.selection.save();
      u(n);
      t.selection.restore()
    }

    function a(n) {
      if ("indent" == n || "outdent" == n) {
        for (var o = !1, r = t.selection.blocks(), u = [], i = 0; i < r.length; i++) "LI" == r[i].tagName ? (o = !0, u.push(r[i])) : "LI" == r[i].parentNode.tagName && (o = !0, u.push(r[i].parentNode));
        o && ("indent" == n ? f(u) : e(u))
      }
    }

    function v() {
      t.events.on("commands.after", a);
      t.events.on("keydown", function(i) {
        if (i.which == n.FE.KEYCODE.TAB) {
          for (var s, u = t.selection.blocks(), o = [], r = 0; r < u.length; r++) "LI" == u[r].tagName ? (s = !0, o.push(u[r])) : "LI" == u[r].parentNode.tagName && (s = !0, o.push(u[r].parentNode));
          if (s) return i.preventDefault(), i.stopPropagation(), i.shiftKey ? e(o) : f(o), !1
        }
      }, !0)
    }
    return {
      _init: v,
      format: c,
      refresh: l
    }
  };
  n.FE.RegisterCommand("formatUL", {
    title: "Unordered List",
    refresh: function(n) {
      this.lists.refresh(n, "UL")
    },
    callback: function() {
      this.lists.format("UL")
    },
    plugin: "lists"
  });
  n.FE.RegisterCommand("formatOL", {
    title: "Ordered List",
    refresh: function(n) {
      this.lists.refresh(n, "OL")
    },
    callback: function() {
      this.lists.format("OL")
    },
    plugin: "lists"
  });
  n.FE.DefineIcon("formatUL", {
    NAME: "list-ul"
  });
  n.FE.DefineIcon("formatOL", {
    NAME: "list-ol"
  })
});
/*!
 * froala_editor v2.3.2 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2016 Froala Labs
 */
! function(n) {
  "function" == typeof define && define.amd ? define(["jquery"], n) : "object" == typeof module && module.exports ? module.exports = function(t, i) {
    return void 0 === i && (i = "undefined" != typeof window ? require("jquery") : require("jquery")(t)), n(i), i
  } : n(jQuery)
}(function(n) {
  "use strict";
  n.extend(n.FE.DEFAULTS, {});
  n.FE.URLRegEx = /(\s|^|>)((http|https|ftp|ftps)\:\/\/[a-zA-Z0-9\-\.]+(\.[a-zA-Z]{2,3})?(:\d*)?(\/[^\s<]*)?)(\s|$|<)/gi;
  n.FE.PLUGINS.url = function(t) {
    function i(r) {
      r.each(function() {
        if ("IFRAME" != this.tagName)
          if (3 == this.nodeType) {
            var r = this.textContent.replace(/&nbsp;/gi, "");
            n.FE.URLRegEx.test(r) && (n(this).before(r.replace(n.FE.URLRegEx, '$1<a href="$2">$2<\/a>$7')), n(this).remove())
          } else 1 == this.nodeType && ["A", "BUTTON", "TEXTAREA"].indexOf(this.tagName) < 0 && i(t.node.contents(this))
      })
    }

    function r() {
      t.events.on("paste.afterCleanup", function(t) {
        if (n.FE.URLRegEx.test(t)) return t.replace(n.FE.URLRegEx, '$1<a href="$2">$2<\/a>$7')
      });
      t.events.on("keyup", function(r) {
        var u = r.which;
        (u == n.FE.KEYCODE.ENTER || u == n.FE.KEYCODE.SPACE) && i(t.node.contents(t.$el.get(0)))
      });
      t.events.on("keydown", function(i) {
        var u = i.which,
          r;
        if (u == n.FE.KEYCODE.ENTER && (r = t.selection.element(), ("A" == r.tagName || n(r).parents("a").length) && t.selection.info(r).atEnd)) return i.stopImmediatePropagation(), "A" !== r.tagName && (r = n(r).parents("a")[0]), n(r).after("&nbsp;" + n.FE.MARKERS), t.selection.restore(), !1
      })
    }
    return {
      _init: r
    }
  }
});
/*!
 * froala_editor v2.3.2 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2016 Froala Labs
 */
! function(n) {
  "function" == typeof define && define.amd ? define(["jquery"], n) : "object" == typeof module && module.exports ? module.exports = function(t, i) {
    return void 0 === i && (i = "undefined" != typeof window ? require("jquery") : require("jquery")(t)), n(i), i
  } : n(jQuery)
}(function(n) {
  "use strict";
  n.extend(n.FE.DEFAULTS, {
    codeMirror: !0,
    codeMirrorOptions: {
      lineNumbers: !0,
      tabMode: "indent",
      indentWithTabs: !0,
      lineWrapping: !0,
      mode: "text/html",
      tabSize: 2
    },
    codeBeautifierOptions: {
      end_with_newline: !0,
      indent_inner_html: !0,
      extra_liners: ["p", "h1", "h2", "h3", "h4", "h5", "h6", "blockquote", "pre", "ul", "ol", "table", "dl"],
      brace_style: "expand",
      indent_char: "\t",
      indent_size: 1,
      wrap_line_length: 0
    }
  });
  n.FE.PLUGINS.codeView = function(t) {
    function u() {
      return t.$box.hasClass("fr-code-view")
    }

    function o() {
      return r ? r.getValue() : i.val()
    }

    function s(n) {
      var i = o();
      t.html.set(i);
      t.$el.blur();
      t.$tb.find(" > .fr-command").not(n).removeClass("fr-disabled");
      n.removeClass("fr-active");
      t.events.focus(!0);
      t.placeholder.refresh();
      t.undo.saveStep()
    }

    function h(n) {
      var u, e, f, o, s;
      i || l();
      !r && t.opts.codeMirror && "undefined" != typeof CodeMirror && (r = CodeMirror.fromTextArea(i.get(0), t.opts.codeMirrorOptions));
      t.undo.saveStep();
      t.html.cleanEmptyTags();
      t.html.cleanWhiteTags(!0);
      t.core.hasFocus() && (t.core.isEmpty() || (t.selection.save(), t.$el.find('.fr-marker[data-type="true"]:first').replaceWith('<span class="fr-tmp fr-sm">F<\/span>'), t.$el.find('.fr-marker[data-type="false"]:last').replaceWith('<span class="fr-tmp fr-em">F<\/span>')));
      u = t.html.get(!1, !0);
      t.$el.find("span.fr-tmp").remove();
      t.core.hasFocus() && t.$el.blur();
      u = u.replace(/<span class="fr-tmp fr-sm">F<\/span>/, "FROALA-SM");
      u = u.replace(/<span class="fr-tmp fr-em">F<\/span>/, "FROALA-EM");
      t.codeBeautifier && (u = t.codeBeautifier.run(u, t.opts.codeBeautifierOptions));
      r ? (e = u.indexOf("FROALA-SM"), f = u.indexOf("FROALA-EM"), e > f ? e = f : f -= 9, u = u.replace(/FROALA-SM/g, "").replace(/FROALA-EM/g, ""), o = u.substring(0, e).length - u.substring(0, e).replace(/\n/g, "").length, s = u.substring(0, f).length - u.substring(0, f).replace(/\n/g, "").length, e = u.substring(0, e).length - u.substring(0, u.substring(0, e).lastIndexOf("\n") + 1).length, f = u.substring(0, f).length - u.substring(0, u.substring(0, f).lastIndexOf("\n") + 1).length, r.setSize(null, t.opts.height ? t.opts.height : "auto"), t.opts.heightMin && t.$box.find(".CodeMirror-scroll").css("min-height", t.opts.heightMin), r.setValue(u), r.focus(), r.setSelection({
        line: o,
        ch: e
      }, {
        line: s,
        ch: f
      }), r.refresh(), r.clearHistory()) : (e = u.indexOf("FROALA-SM"), f = u.indexOf("FROALA-EM") - 9, t.opts.heightMin && i.css("min-height", t.opts.heightMin), t.opts.height && i.css("height", t.opts.height), t.opts.heightMax && i.css("max-height", t.opts.height || t.opts.heightMax), i.val(u.replace(/FROALA-SM/g, "").replace(/FROALA-EM/g, "")), i.focus(), i.get(0).setSelectionRange(e, f));
      t.$tb.find(" > .fr-command").not(n).addClass("fr-disabled");
      n.addClass("fr-active");
      !t.helpers.isMobile() && t.opts.toolbarInline && t.toolbar.hide()
    }

    function e(n) {
      "undefined" == typeof n && (n = !u());
      var i = t.$tb.find('.fr-command[data-cmd="html"]');
      n ? (t.popups.hideAll(), t.$box.toggleClass("fr-code-view", !0), h(i)) : (t.$box.toggleClass("fr-code-view", !1), s(i))
    }

    function c() {
      u() && e(t.$tb.find('button[data-cmd="html"]'));
      r && r.toTextArea();
      i.val("").removeData().remove();
      i = null;
      f && (f.remove(), f = null)
    }

    function l() {
      i = n('<textarea class="fr-code" tabindex="-1">');
      t.$wp.append(i);
      i.attr("dir", t.opts.direction);
      t.$box.hasClass("fr-basic") || (f = n('<a data-cmd="html" title="Code View" class="fr-command fr-btn html-switch' + (t.helpers.isMobile() ? "" : " fr-desktop") + '" role="button" tabindex="-1"><i class="fa fa-code"><\/i><\/button>'), t.$box.append(f), t.events.bindClick(t.$box, "a.html-switch", function() {
        e(!1)
      }));
      var r = function() {
        return !u()
      };
      t.events.on("buttons.refresh", r);
      t.events.on("copy", r, !0);
      t.events.on("cut", r, !0);
      t.events.on("paste", r, !0);
      t.events.on("destroy", c, !0);
      t.events.on("html.set", function() {
        u() && e(!0)
      });
      t.events.on("form.submit", function() {
        u() && (t.html.set(o()), t.events.trigger("contentChanged", [], !0))
      }, !0)
    }

    function a() {
      if (!t.$wp) return !1
    }
    var i, r, f;
    return {
      _init: a,
      toggle: e,
      isActive: u,
      get: o
    }
  };
  n.FE.RegisterCommand("html", {
    title: "Code View",
    undo: !1,
    focus: !1,
    forcedRefresh: !0,
    callback: function() {
      this.codeView.toggle()
    },
    plugin: "codeView"
  });
  n.FE.DefineIcon("html", {
    NAME: "code"
  })
});
/*!
 * froala_editor v2.3.2 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2016 Froala Labs
 */
! function(n) {
  "function" == typeof define && define.amd ? define(["jquery"], n) : "object" == typeof module && module.exports ? module.exports = function(t, i) {
    return void 0 === i && (i = "undefined" != typeof window ? require("jquery") : require("jquery")(t)), n(i), i
  } : n(jQuery)
}(function(n) {
  "use strict";
  n.extend(n.FE.POPUP_TEMPLATES, {
    "video.insert": "[_BUTTONS_][_BY_URL_LAYER_][_EMBED_LAYER_]",
    "video.edit": "[_BUTTONS_]",
    "video.size": "[_BUTTONS_][_SIZE_LAYER_]"
  });
  n.extend(n.FE.DEFAULTS, {
    videoInsertButtons: ["videoBack", "|", "videoByURL", "videoEmbed"],
    videoEditButtons: ["videoDisplay", "videoAlign", "videoSize", "videoRemove"],
    videoResize: !0,
    videoSizeButtons: ["videoBack", "|"],
    videoSplitHTML: !1,
    videoTextNear: !0,
    videoDefaultAlign: "center",
    videoDefaultDisplay: "block",
    videoMove: !0
  });
  n.FE.VIDEO_PROVIDERS = [{
    test_regex: /^.*((youtu.be)|(youtube.com))\/((v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))?\??v?=?([^#\&\?]*).*/,
    url_regex: /(?:https?:\/\/)?(?:www\.)?(?:m\.)?(?:youtube\.com|youtu\.be)\/(?:watch\?v=|embed\/)?([0-9a-zA-Z_\-]+)(.+)?/g,
    url_text: "//www.youtube.com/embed/$1",
    html: '<iframe width="640" height="360" src="{url}?wmode=opaque" frameborder="0" allowfullscreen><\/iframe>'
  }, {
    test_regex: /^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/))?([0-9]+)/,
    url_regex: /(?:https?:\/\/)?(?:www\.)?(?:vimeo\.com)\/(?:channels\/[A-z]+\/|groups\/[A-z]+\/videos\/)?(.+)/g,
    url_text: "//player.vimeo.com/video/$1",
    html: '<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen><\/iframe>'
  }, {
    test_regex: /^.+(dailymotion.com|dai.ly)\/(video|hub)?\/?([^_]+)[^#]*(#video=([^_&]+))?/,
    url_regex: /(?:https?:\/\/)?(?:www\.)?(?:dailymotion\.com|dai\.ly)\/(?:video|hub)?\/?(.+)/g,
    url_text: "//www.dailymotion.com/embed/video/$1",
    html: '<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen><\/iframe>'
  }, {
    test_regex: /^.+(screen.yahoo.com)\/[^_&]+/,
    url_regex: "",
    url_text: "",
    html: '<iframe width="640" height="360" src="{url}?format=embed" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true" allowtransparency="true"><\/iframe>'
  }, {
    test_regex: /^.+(rutube.ru)\/[^_&]+/,
    url_regex: /(?:https?:\/\/)?(?:www\.)?(?:rutube\.ru)\/(?:video)?\/?(.+)/g,
    url_text: "//rutube.ru/play/embed/$1",
    html: '<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true" allowtransparency="true"><\/iframe>'
  }];
  n.FE.VIDEO_EMBED_REGEX = /^\W*((<iframe.*><\/iframe>)|(<embed.*>))\W*$/i;
  n.FE.PLUGINS.video = function(t) {
    function d() {
      var n = t.popups.get("video.insert"),
        r = n.find(".fr-video-by-url-layer input"),
        i;
      r.val("").trigger("change");
      i = n.find(".fr-video-embed-layer textarea");
      i.val("").trigger("change")
    }

    function g() {
      var n = t.$tb.find('.fr-command[data-cmd="insertVideo"]'),
        i = t.popups.get("video.insert"),
        r, u;
      (i || (i = v()), i.hasClass("fr-active")) || (t.popups.refresh("video.insert"), t.popups.setContainer("video.insert", t.$tb), r = n.offset().left + n.outerWidth() / 2, u = n.offset().top + (t.opts.toolbarBottom ? 10 : n.outerHeight() - 10), t.popups.show("video.insert", r, u, n.outerHeight()))
    }

    function o() {
      var u = t.popups.get("video.edit");
      u || (u = at());
      t.popups.setContainer("video.edit", n(t.opts.scrollableContainer));
      t.popups.refresh("video.edit");
      var r = i.find("iframe, embed, video"),
        f = r.offset().left + r.outerWidth() / 2,
        e = r.offset().top + r.outerHeight();
      t.popups.show("video.edit", f, e, r.outerHeight())
    }

    function v(n) {
      var i, r, u, f, e;
      return n ? (t.popups.onRefresh("video.insert", d), !0) : (i = "", t.opts.videoInsertButtons.length > 1 && (i = '<div class="fr-buttons">' + t.button.buildList(t.opts.videoInsertButtons) + "<\/div>"), r = "", t.opts.videoInsertButtons.indexOf("videoByURL") >= 0 && (r = '<div class="fr-video-by-url-layer fr-layer fr-active" id="fr-video-by-url-layer-' + t.id + '"><div class="fr-input-line"><input type="text" placeholder="http://" tabIndex="1"><\/div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="videoInsertByURL" tabIndex="2">' + t.language.translate("Insert") + "<\/button><\/div><\/div>"), u = "", t.opts.videoInsertButtons.indexOf("videoEmbed") >= 0 && (u = '<div class="fr-video-embed-layer fr-layer" id="fr-video-embed-layer-' + t.id + '"><div class="fr-input-line"><textarea type="text" placeholder="' + t.language.translate("Embedded Code") + '" tabIndex="1" rows="5"><\/textarea><\/div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="videoInsertEmbed" tabIndex="2">' + t.language.translate("Insert") + "<\/button><\/div><\/div>"), f = {
        buttons: i,
        by_url_layer: r,
        embed_layer: u
      }, e = t.popups.create("video.insert", f), e)
    }

    function nt(n) {
      var e, f, r = t.popups.get("video.insert"),
        u;
      i || t.opts.toolbarInline || (u = t.$tb.find('.fr-command[data-cmd="insertVideo"]'), e = u.offset().left + u.outerWidth() / 2, f = u.offset().top + (t.opts.toolbarBottom ? 10 : u.outerHeight() - 10));
      t.opts.toolbarInline && (f = r.offset().top - t.helpers.getPX(r.css("margin-top")), r.hasClass("fr-above") && (f += r.outerHeight()));
      r.find(".fr-layer").removeClass("fr-active");
      r.find(".fr-" + n + "-layer").addClass("fr-active");
      t.popups.show("video.insert", e, f, 0)
    }

    function tt(n) {
      var i = t.popups.get("video.insert");
      i.find(".fr-video-by-url-layer").hasClass("fr-active") && n.addClass("fr-active")
    }

    function it(n) {
      var i = t.popups.get("video.insert");
      i.find(".fr-video-embed-layer").hasClass("fr-active") && n.addClass("fr-active")
    }

    function c(n) {
      t.events.focus(!0);
      t.selection.restore();
      t.html.insert('<span contenteditable="false" draggable="true" class="fr-jiv fr-video fr-dv' + t.opts.videoDefaultDisplay[0] + ("center" != t.opts.videoDefaultAlign ? " fr-fv" + t.opts.videoDefaultAlign[0] : "") + '">' + n + "<\/span>", !1, t.opts.videoSplitHTML);
      t.popups.hide("video.insert");
      var i = t.$el.find(".fr-jiv");
      i.removeClass("fr-jiv");
      i.toggleClass("fr-draggable", t.opts.videoMove);
      t.events.trigger("video.inserted", [i])
    }

    function rt(i) {
      var e, r, f, u;
      if ("undefined" == typeof i && (e = t.popups.get("video.insert"), i = e.find('.fr-video-by-url-layer input[type="text"]').val() || ""), r = null, t.helpers.isURL(i))
        for (f = 0; f < n.FE.VIDEO_PROVIDERS.length; f++)
          if (u = n.FE.VIDEO_PROVIDERS[f], u.test_regex.test(i)) {
            r = i.replace(u.url_regex, u.url_text);
            r = u.html.replace(/\{url\}/, r);
            break
          }
      r ? c(r) : t.events.trigger("video.linkError", [i])
    }

    function ut(i) {
      if ("undefined" == typeof i) {
        var r = t.popups.get("video.insert");
        i = r.find(".fr-video-embed-layer textarea").val() || ""
      }
      0 !== i.length && n.FE.VIDEO_EMBED_REGEX.test(i) ? c(i) : t.events.trigger("video.codeError", [i])
    }

    function ft(i) {
      if (!t.core.sameInstance(r)) return !0;
      i.preventDefault();
      i.stopPropagation();
      var e = i.pageX || (i.originalEvent.touches ? i.originalEvent.touches[0].pageX : null),
        o = i.pageY || (i.originalEvent.touches ? i.originalEvent.touches[0].pageY : null);
      return e && o ? (t.undo.canDo() || t.undo.saveStep(), u = n(this), u.data("start-x", e), u.data("start-y", o), f.show(), t.popups.hideAll(), void l()) : !1
    }

    function et(n) {
      var e, o, l, a;
      if (!t.core.sameInstance(r)) return !0;
      if (u) {
        if (n.preventDefault(), e = n.pageX || (n.originalEvent.touches ? n.originalEvent.touches[0].pageX : null), o = n.pageY || (n.originalEvent.touches ? n.originalEvent.touches[0].pageY : null), !e || !o) return !1;
        l = u.data("start-x");
        a = u.data("start-y");
        u.data("start-x", e);
        u.data("start-y", o);
        var h = e - l,
          c = o - a,
          f = i.find("iframe, embed, video"),
          v = f.width(),
          y = f.height();
        (u.hasClass("fr-hnw") || u.hasClass("fr-hsw")) && (h = 0 - h);
        (u.hasClass("fr-hnw") || u.hasClass("fr-hne")) && (c = 0 - c);
        f.css("width", v + h);
        f.css("height", y + c);
        f.removeAttr("width");
        f.removeAttr("height");
        s()
      }
    }

    function y(n) {
      return t.core.sameInstance(r) ? void(u && i && (n && n.stopPropagation(), u = null, f.hide(), s(), o(), t.undo.saveStep())) : !0
    }

    function h(n) {
      return '<div class="fr-handler fr-h' + n + '"><\/div>'
    }

    function ot() {
      var i;
      t.shared.$video_resizer ? (r = t.shared.$video_resizer, f = t.shared.$vid_overlay, t.events.on("destroy", function() {
        r.removeClass("fr-active").appendTo(n("body"))
      }, !0)) : (t.shared.$video_resizer = n('<div class="fr-video-resizer"><\/div>'), r = t.shared.$video_resizer, t.events.$on(r, "mousedown", function(n) {
        n.stopPropagation()
      }, !0), t.opts.videoResize && (r.append(h("nw") + h("ne") + h("sw") + h("se")), t.shared.$vid_overlay = n('<div class="fr-video-overlay"><\/div>'), f = t.shared.$vid_overlay, i = r.get(0).ownerDocument, n(i).find("body").append(f)));
      t.events.on("shared.destroy", function() {
        r.html("").removeData().remove();
        r = null;
        t.opts.videoResize && (f.remove(), f = null)
      }, !0);
      t.helpers.isMobile() || t.events.$on(n(t.o_win), "resize.video", function() {
        e(!0)
      });
      t.opts.videoResize && (i = r.get(0).ownerDocument, t.events.$on(r, t._mousedown, ".fr-handler", ft), t.events.$on(n(i), t._mousemove, et), t.events.$on(n(i.defaultView || i.parentWindow), t._mouseup, y), t.events.$on(f, "mouseleave", y))
    }

    function s() {
      r || ot();
      (t.$wp || n(t.opts.scrollableContainer)).append(r);
      r.data("instance", t);
      var u = i.find("iframe, embed, video");
      r.css("top", (t.opts.iframe ? u.offset().top - 1 : u.offset().top - t.$wp.offset().top - 1) + t.$wp.scrollTop()).css("left", (t.opts.iframe ? u.offset().left - 1 : u.offset().left - t.$wp.offset().left - 1) + t.$wp.scrollLeft()).css("width", u.outerWidth()).css("height", u.height()).addClass("fr-active")
    }

    function st(r) {
      if (r && "touchend" == r.type && a) return !0;
      if (r.preventDefault(), r.stopPropagation(), t.edit.isDisabled()) return !1;
      for (var u = 0; u < n.FE.INSTANCES.length; u++) n.FE.INSTANCES[u] != t && n.FE.INSTANCES[u].events.trigger("video.hideResizer");
      t.toolbar.disable();
      t.helpers.isMobile() && (t.events.disableBlur(), t.$el.blur(), t.events.enableBlur());
      i = n(this);
      n(this).addClass("fr-active");
      t.opts.iframe && t.size.syncIframe();
      s();
      o();
      t.selection.clear();
      t.button.bulkRefresh();
      t.events.trigger("image.hideResizer")
    }

    function e(n) {
      i && (ct() || n === !0) && (r.removeClass("fr-active"), t.toolbar.enable(), i.removeClass("fr-active"), i = null, l())
    }

    function ht() {
      t.shared.vid_exit_flag = !0
    }

    function l() {
      t.shared.vid_exit_flag = !1
    }

    function ct() {
      return t.shared.vid_exit_flag
    }

    function lt() {
      t.events.on("mousedown window.mousedown", ht);
      t.events.on("window.touchmove", l);
      t.events.on("mouseup window.mouseup", e);
      t.events.on("commands.mousedown", function(n) {
        n.parents(".fr-toolbar").length > 0 && e()
      });
      t.events.on("blur video.hideResizer commands.undo commands.redo element.dropped", function() {
        e(!0)
      })
    }

    function at() {
      var n = "",
        r, u;
      return t.opts.videoEditButtons.length >= 1 && (n += '<div class="fr-buttons">', n += t.button.buildList(t.opts.videoEditButtons), n += "<\/div>"), r = {
        buttons: n
      }, u = t.popups.create("video.edit", r), t.events.$on(t.$wp, "scroll.video-edit", function() {
        i && t.popups.isVisible("video.edit") && o()
      }), u
    }

    function vt() {
      if (i) {
        var r = t.popups.get("video.size"),
          n = i.find("iframe, embed, video");
        r.find('input[name="width"]').val(n.get(0).style.width || n.attr("width")).trigger("change");
        r.find('input[name="height"]').val(n.get(0).style.height || n.attr("height")).trigger("change")
      }
    }

    function p() {
      var u = t.popups.get("video.size");
      u || (u = w());
      t.popups.refresh("video.size");
      t.popups.setContainer("video.size", n(t.opts.scrollableContainer));
      var r = i.find("iframe, embed, video"),
        f = r.offset().left + r.width() / 2,
        e = r.offset().top + r.height();
      t.popups.show("video.size", f, e, r.height())
    }

    function w(n) {
      var r, u, f, e;
      return n ? (t.popups.onRefresh("video.size", vt), !0) : (r = "", r = '<div class="fr-buttons">' + t.button.buildList(t.opts.videoSizeButtons) + "<\/div>", u = "", u = '<div class="fr-video-size-layer fr-layer fr-active" id="fr-video-size-layer-' + t.id + '"><div class="fr-video-group"><div class="fr-input-line"><input type="text" name="width" placeholder="' + t.language.translate("Width") + '" tabIndex="1"><\/div><div class="fr-input-line"><input type="text" name="height" placeholder="' + t.language.translate("Height") + '" tabIndex="1"><\/div><\/div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="videoSetSize" tabIndex="2">' + t.language.translate("Update") + "<\/button><\/div><\/div>", f = {
        buttons: r,
        size_layer: u
      }, e = t.popups.create("video.size", f), t.events.$on(t.$wp, "scroll", function() {
        i && t.popups.isVisible("video.size") && p()
      }), e)
    }

    function yt(n) {
      i.removeClass("fr-fvr fr-fvl");
      "left" == n ? i.addClass("fr-fvl") : "right" == n && i.addClass("fr-fvr");
      s();
      o()
    }

    function pt(n) {
      return i ? void(i.hasClass("fr-fvl") ? n.find("> *:first").replaceWith(t.icon.create("align-left")) : i.hasClass("fr-fvr") ? n.find("> *:first").replaceWith(t.icon.create("align-right")) : n.find("> *:first").replaceWith(t.icon.create("align-justify"))) : !1
    }

    function wt(n, t) {
      var r = "justify";
      i.hasClass("fr-fvl") ? r = "left" : i.hasClass("fr-fvr") && (r = "right");
      t.find('.fr-command[data-param1="' + r + '"]').addClass("fr-active")
    }

    function bt(n) {
      i.removeClass("fr-dvi fr-dvb");
      "inline" == n ? i.addClass("fr-dvi") : "block" == n && i.addClass("fr-dvb");
      s();
      o()
    }

    function kt(n, t) {
      var r = "block";
      i.hasClass("fr-dvi") && (r = "inline");
      t.find('.fr-command[data-param1="' + r + '"]').addClass("fr-active")
    }

    function b() {
      if (i && t.events.trigger("video.beforeRemove", [i]) !== !1) {
        var n = i;
        t.popups.hideAll();
        e(!0);
        t.selection.setBefore(n.get(0)) || t.selection.setAfter(n.get(0));
        n.remove();
        t.selection.restore();
        t.html.fillEmptyBlocks();
        t.events.trigger("video.removed", [n])
      }
    }

    function dt(n) {
      if (!n.hasClass("fr-dvi") && !n.hasClass("fr-dvb")) {
        var i = n.css("float");
        n.css("float", "none");
        "block" == n.css("display") ? (n.css("float", i), 0 === parseInt(n.css("margin-left"), 10) && (n.attr("style") || "").indexOf("margin-right: auto") >= 0 ? n.addClass("fr-fvl") : 0 === parseInt(n.css("margin-right"), 10) && (n.attr("style") || "").indexOf("margin-left: auto") >= 0 && n.addClass("fr-fvr"), n.addClass("fr-dvb")) : (n.css("float", i), "left" == n.css("float") ? n.addClass("fr-fvl") : "right" == n.css("float") && n.addClass("fr-fvr"), n.addClass("fr-dvi"));
        n.css("margin", "");
        n.css("float", "");
        n.css("display", "");
        n.css("z-index", "");
        n.css("position", "");
        n.css("overflow", "");
        n.css("vertical-align", "")
      }
      t.opts.videoTextNear || n.removeClass("fr-dvi").addClass("fr-dvb")
    }

    function k() {
      t.$el.find("video").filter(function() {
        return 0 === n(this).parents("span.fr-video").length
      }).wrap('<span class="fr-video" contenteditable="false"><\/span>');
      t.$el.find("embed, iframe").filter(function() {
        var r, i, u;
        if (t.browser.safari && this.getAttribute("src") && this.setAttribute("src", this.src), n(this).parents("span.fr-video").length > 0) return !1;
        for (r = n(this).attr("src"), i = 0; i < n.FE.VIDEO_PROVIDERS.length; i++)
          if (u = n.FE.VIDEO_PROVIDERS[i], u.test_regex.test(r)) return !0;
        return !1
      }).map(function() {
        return 0 === n(this).parents("object").length ? this : n(this).parents("object").get(0)
      }).wrap('<span class="fr-video" contenteditable="false"><\/span>');
      for (var i = t.$el.find("span.fr-video"), r = 0; r < i.length; r++) dt(n(i[r]));
      i.toggleClass("fr-draggable", t.opts.videoMove)
    }

    function gt() {
      lt();
      t.helpers.isMobile() && (t.events.$on(t.$el, "touchstart", "span.fr-video", function() {
        a = !1
      }), t.events.$on(t.$el, "touchmove", function() {
        a = !0
      }));
      t.events.on("html.set", k);
      k();
      t.events.$on(t.$el, "mousedown", "span.fr-video", function(n) {
        n.stopPropagation()
      });
      t.events.$on(t.$el, "click touchend", "span.fr-video", st);
      t.events.on("keydown", function(r) {
        var u = r.which;
        return !i || u != n.FE.KEYCODE.BACKSPACE && u != n.FE.KEYCODE.DELETE ? i && u == n.FE.KEYCODE.ESC ? (e(!0), r.preventDefault(), !1) : i && !t.keys.ctrlKey(r) ? (r.preventDefault(), !1) : void 0 : (r.preventDefault(), b(), !1)
      }, !0);
      t.events.on("keydown", function() {
        t.$el.find("span.fr-video:empty").remove()
      });
      v(!0);
      w(!0)
    }

    function ni() {
      i ? i.trigger("click") : (t.events.disableBlur(), t.selection.restore(), t.events.enableBlur(), t.popups.hide("video.insert"), t.toolbar.showInline())
    }

    function ti(n, r) {
      if (i) {
        var f = t.popups.get("video.size"),
          u = i.find("iframe, embed, video");
        u.css("width", n || f.find('input[name="width"]').val());
        u.css("height", r || f.find('input[name="height"]').val());
        u.get(0).style.width && u.removeAttr("width");
        u.get(0).style.height && u.removeAttr("height");
        f.find("input").blur();
        setTimeout(function() {
          i.trigger("click")
        }, t.helpers.isAndroid() ? 50 : 0)
      }
    }

    function ii() {
      return i
    }
    var f, u, r, i, a;
    return t.shared.vid_exit_flag = !1, {
      _init: gt,
      showInsertPopup: g,
      showLayer: nt,
      refreshByURLButton: tt,
      refreshEmbedButton: it,
      insertByURL: rt,
      insertEmbed: ut,
      insert: c,
      align: yt,
      refreshAlign: pt,
      refreshAlignOnShow: wt,
      display: bt,
      refreshDisplayOnShow: kt,
      remove: b,
      showSizePopup: p,
      back: ni,
      setSize: ti,
      get: ii
    }
  };
  n.FE.RegisterCommand("insertVideo", {
    title: "Insert Video",
    undo: !1,
    focus: !0,
    refreshAfterCallback: !1,
    popup: !0,
    callback: function() {
      this.popups.isVisible("video.insert") ? (this.$el.find(".fr-marker") && (this.events.disableBlur(), this.selection.restore()), this.popups.hide("video.insert")) : this.video.showInsertPopup()
    },
    plugin: "video"
  });
  n.FE.DefineIcon("insertVideo", {
    NAME: "video-camera"
  });
  n.FE.DefineIcon("videoByURL", {
    NAME: "link"
  });
  n.FE.RegisterCommand("videoByURL", {
    title: "By URL",
    undo: !1,
    focus: !1,
    callback: function() {
      this.video.showLayer("video-by-url")
    },
    refresh: function(n) {
      this.video.refreshByURLButton(n)
    }
  });
  n.FE.DefineIcon("videoEmbed", {
    NAME: "code"
  });
  n.FE.RegisterCommand("videoEmbed", {
    title: "Embedded Code",
    undo: !1,
    focus: !1,
    callback: function() {
      this.video.showLayer("video-embed")
    },
    refresh: function(n) {
      this.video.refreshEmbedButton(n)
    }
  });
  n.FE.RegisterCommand("videoInsertByURL", {
    undo: !0,
    focus: !0,
    callback: function() {
      this.video.insertByURL()
    }
  });
  n.FE.RegisterCommand("videoInsertEmbed", {
    undo: !0,
    focus: !0,
    callback: function() {
      this.video.insertEmbed()
    }
  });
  n.FE.DefineIcon("videoDisplay", {
    NAME: "star"
  });
  n.FE.RegisterCommand("videoDisplay", {
    title: "Display",
    type: "dropdown",
    options: {
      inline: "Inline",
      block: "Break Text"
    },
    callback: function(n, t) {
      this.video.display(t)
    },
    refresh: function(n) {
      this.opts.videoTextNear || n.addClass("fr-hidden")
    },
    refreshOnShow: function(n, t) {
      this.video.refreshDisplayOnShow(n, t)
    }
  });
  n.FE.DefineIcon("videoAlign", {
    NAME: "align-center"
  });
  n.FE.RegisterCommand("videoAlign", {
    type: "dropdown",
    title: "Align",
    options: {
      left: "Align Left",
      justify: "None",
      right: "Align Right"
    },
    html: function() {
      var r = '<ul class="fr-dropdown-list">',
        i = n.FE.COMMANDS.videoAlign.options;
      for (var t in i) i.hasOwnProperty(t) && (r += '<li><a class="fr-command fr-title" data-cmd="videoAlign" data-param1="' + t + '" title="' + this.language.translate(i[t]) + '">' + this.icon.create("align-" + t) + "<\/a><\/li>");
      return r + "<\/ul>"
    },
    callback: function(n, t) {
      this.video.align(t)
    },
    refresh: function(n) {
      this.video.refreshAlign(n)
    },
    refreshOnShow: function(n, t) {
      this.video.refreshAlignOnShow(n, t)
    }
  });
  n.FE.DefineIcon("videoRemove", {
    NAME: "trash"
  });
  n.FE.RegisterCommand("videoRemove", {
    title: "Remove",
    callback: function() {
      this.video.remove()
    }
  });
  n.FE.DefineIcon("videoSize", {
    NAME: "arrows-alt"
  });
  n.FE.RegisterCommand("videoSize", {
    undo: !1,
    focus: !1,
    title: "Change Size",
    callback: function() {
      this.video.showSizePopup()
    }
  });
  n.FE.DefineIcon("videoBack", {
    NAME: "arrow-left"
  });
  n.FE.RegisterCommand("videoBack", {
    title: "Back",
    undo: !1,
    focus: !1,
    back: !0,
    callback: function() {
      this.video.back()
    },
    refresh: function(n) {
      var t = this.video.get();
      t || this.opts.toolbarInline ? (n.removeClass("fr-hidden"), n.next(".fr-separator").removeClass("fr-hidden")) : (n.addClass("fr-hidden"), n.next(".fr-separator").addClass("fr-hidden"))
    }
  });
  n.FE.RegisterCommand("videoSetSize", {
    undo: !0,
    focus: !1,
    callback: function() {
      this.video.setSize()
    }
  })
});
